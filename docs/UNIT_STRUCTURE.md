# ระบบจัดการโครงสร้างส่วนงาน (Unit Structure Management)

## ภาพรวม
ระบบจัดการโครงสร้างส่วนงานเป็นส่วนหนึ่งของระบบ Court Marshal Connect ที่ใช้สำหรับจัดการโครงสร้างบุคลากรและลำดับขั้นในองค์กร

## คุณสมบัติหลัก

### 1. โครงสร้างลำดับชั้น
- **ผู้อำนวยการศูนย์ (Director)**: สามารถมีได้เพียงคนเดียวในระบบ
- **หัวหน้าส่วน (Supervisor)**: แต่ละส่วนงานสามารถมีได้เพียงคนเดียว และมีลำดับอาวุโส = 1 เสมอ
- **เจ้าหน้าที่ (Member)**: สมาชิกในส่วนงาน มีลำดับอาวุโสตั้งแต่ 2 เป็นต้นไป

### 2. ระบบหมายเลขส่วนงาน
- รูปแบบ: 2 ตัวอักษร + 2 ตัวเลข (เช่น cs01, ad02)
- ใช้สำหรับจัดกลุ่มและระบุส่วนงาน

### 3. ลำดับอาวุโส (Seniority Order)
- ใช้กำหนดลำดับในการปฏิบัติงานแทน
- หัวหน้าส่วนมีลำดับ 1 เสมอ
- เจ้าหน้าที่มีลำดับ 2, 3, 4... ตามลำดับอาวุโส

## โครงสร้างฐานข้อมูล

### ตาราง `unit_structure`
```sql
- id: Primary Key (AUTO_INCREMENT)
- position_number: เลขตำแหน่งจากตาราง officers (FOREIGN KEY)
- unit_name: ชื่อส่วนงาน
- unit_number: หมายเลขส่วนงาน (รูปแบบ: XX##)
- role: บทบาท (member/supervisor/director)
- seniority_order: ลำดับอาวุโส (1, 2, 3...)
- created_at: วันที่สร้าง
- updated_at: วันที่แก้ไขล่าสุด
```

### ข้อจำกัด (Constraints)
1. `position_number` ต้องไม่ซ้ำ (UNIQUE)
2. `unit_number + seniority_order` ต้องไม่ซ้ำในส่วนงานเดียวกัน
3. `unit_number` ต้องเป็นรูปแบบ XX## (2 ตัวอักษร + 2 ตัวเลข)
4. `seniority_order` ต้องมากกว่า 0
5. `director` มีได้เพียงคนเดียวในระบบ
6. `supervisor` มีได้เพียงคนเดียวต่อส่วนงาน
7. `supervisor` ต้องมี `seniority_order = 1` เสมอ

## API Endpoints

### 1. GET /api/unit_structure?action=get_all_unit_structures
ดึงข้อมูลโครงสร้างส่วนงานทั้งหมดพร้อมข้อมูลเจ้าหน้าที่

### 2. GET /api/unit_structure?action=get_available_officers
ดึงรายชื่อเจ้าหน้าที่ที่ยังไม่ได้อยู่ในโครงสร้างส่วนงาน

### 3. GET /api/unit_structure?action=get_unit_hierarchy
ดึงโครงสร้างลำดับชั้นที่จัดกลุ่มตามบทบาทและส่วนงาน

### 4. POST /api/unit_structure
สร้าง/แก้ไข/ลบข้อมูลโครงสร้างส่วนงาน

#### Actions:
- `create_unit_structure`: สร้างโครงสร้างใหม่
- `update_unit_structure`: แก้ไขโครงสร้าง
- `delete_unit_structure`: ลบโครงสร้าง
- `check_role_availability`: ตรวจสอบความพร้อมของบทบาท

## การใช้งานหน้าเว็บ

### 1. แสดงผลแบบโครงสร้าง (Hierarchy View)
- แสดงผู้อำนวยการด้านบน
- แสดงส่วนงานต่างๆ ที่สามารถขยาย/ย่อได้
- แสดงหัวหน้าส่วนและสมาชิกในแต่ละส่วนงาน
- ใช้สีที่แตกต่างกันสำหรับแต่ละบทบาท

### 2. แสดงผลแบบรายการ (List View)
- แสดงข้อมูลทั้งหมดในรูปแบบตาราง
- มีการกรองข้อมูลตามบทบาท, ส่วนงาน
- มีการค้นหาข้อมูล

### 3. การเพิ่ม/แก้ไขข้อมูล
- Modal สำหรับเพิ่ม/แก้ไขข้อมูล
- ตรวจสอบข้อมูลก่อนบันทึก
- แสดงคำเตือนสำหรับข้อจำกัดต่างๆ

## ตัวอย่างการใช้งาน

### 1. เพิ่มผู้อำนวยการศูนย์
```javascript
{
  "action": "create_unit_structure",
  "position_number": "001",
  "unit_name": "ศูนย์รักษาความปลอดภัย",
  "unit_number": "dir1",
  "role": "director",
  "seniority_order": 1
}
```

### 2. เพิ่มหัวหน้าส่วน
```javascript
{
  "action": "create_unit_structure",
  "position_number": "002",
  "unit_name": "ส่วนรักษาความปลอดภัยกลางวัน",
  "unit_number": "cs01",
  "role": "supervisor",
  "seniority_order": 1
}
```

### 3. เพิ่มเจ้าหน้าที่
```javascript
{
  "action": "create_unit_structure",
  "position_number": "003",
  "unit_name": "ส่วนรักษาความปลอดภัยกลางวัน",
  "unit_number": "cs01",
  "role": "member",
  "seniority_order": 2
}
```

## การติดตั้งและใช้งาน

### 1. สร้างตารางฐานข้อมูล
```bash
mysql -u username -p database_name < database/unit_structure.sql
```

### 2. Upload API ไฟล์
- อัปโหลดไฟล์ `api/unit_structure.js` ไปยังเซิร์ฟเวอร์
- ตรวจสอบการตั้งค่าฐานข้อมูลในไฟล์

### 3. เพิ่มเส้นทางในแอปพลิเคชัน
- เพิ่ม Route ใน App.js
- เพิ่มลิงก์นำทางใน AppLayout.js
- อัปเดต config.js สำหรับ API endpoint

## คำแนะนำการใช้งาน

### 1. การกำหนดลำดับอาวุโส
- หัวหน้าส่วนควรมีลำดับ 1 เสมอ
- เจ้าหน้าที่ควรมีลำดับต่อเนื่องกัน (2, 3, 4...)
- หลีกเลี่ยงการมีช่องว่างในลำดับ

### 2. การตั้งชื่อส่วนงาน
- ใช้ชื่อที่สื่อความหมายชัดเจน
- หลีกเลี่ยงชื่อที่ยาวเกินไป

### 3. การกำหนดหมายเลขส่วนงาน
- ใช้ตัวอักษรแรกเป็นตัวย่อของส่วนงาน
- ใช้ตัวเลขสำหรับจำแนกประเภทหรือลำดับ
- ตัวอย่าง: cs01 (Court Security 01), ad01 (Administration 01)

## การแก้ไขปัญหา

### 1. ข้อผิดพลาดทั่วไป
- ตรวจสอบว่า position_number มีอยู่ในตาราง officers
- ตรวจสอบรูปแบบ unit_number
- ตรวจสอบข้อจำกัดของบทบาท

### 2. ปัญหาการเชื่อมต่อ API
- ตรวจสอบ endpoint URL ใน config.js
- ตรวจสอบการตั้งค่า CORS
- ตรวจสอบ log ของเซิร์ฟเวอร์

### 3. ปัญหาฐานข้อมูล
- ตรวจสอบการเชื่อมต่อฐานข้อมูล
- ตรวจสอบ Foreign Key Constraints
- ตรวจสอบ Triggers และ Constraints
