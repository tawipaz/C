{"ast":null,"code":"import _objectSpread from\"C:/Users/LENOVO/Documents/GitHub/court-marshal-connect/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState,useMemo,useCallback,memo}from\"react\";import{Search,Filter,Users,Phone,Mail,Calendar,Award,Building2,UserCheck,UserX,TrendingUp,PieChart,BarChart3,Download,RefreshCw,Eye,Grid3X3,List,X,AlertCircle,CheckCircle2,Clock,Briefcase,GraduationCap,Edit2,Save,MapPin,Building,Crown,FileText}from\"lucide-react\";import{CONFIG}from'../config';import DonutChart from'../components/DonutChart';import LineChart from'../components/LineChart';// StatCard Component\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const StatCard=/*#__PURE__*/memo(_ref=>{let{title,value,icon:Icon,color=\"blue\",trend,subtitle}=_ref;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-\".concat(color,\"-100 rounded-xl flex items-center justify-center\"),children:/*#__PURE__*/_jsx(Icon,{className:\"w-6 h-6 text-\".concat(color,\"-600\")})}),trend&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-green-600 text-sm\",children:[/*#__PURE__*/_jsx(TrendingUp,{className:\"w-4 h-4 mr-1\"}),/*#__PURE__*/_jsxs(\"span\",{children:[trend,\"%\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-slate-900 mb-1\",children:value}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-slate-600\",children:title}),subtitle&&/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-slate-500 mt-1\",children:subtitle})]});});// Table Chart Component (สำหรับแสดงข้อมูลตำแหน่งแบบตาราง)\nconst TableChart=/*#__PURE__*/memo(_ref2=>{let{title,data,colors=[]}=_ref2;const total=useMemo(()=>data.reduce((sum,d)=>sum+d.value,0),[data]);return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-slate-900\",children:total}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-slate-500\",children:\"\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid gap-2\",children:data.slice(0,8).map((item,index)=>{const percentage=(item.value/total*100).toFixed(1);const color=colors[index%colors.length]||'#6366f1';return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-3 bg-slate-50 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3 flex-1 min-w-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 rounded-sm flex-shrink-0\",style:{backgroundColor:color}}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-slate-700 font-medium truncate\",title:item.label,children:item.label})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 text-right\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-bold text-slate-900\",children:item.value}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-slate-500\",children:[percentage,\"%\"]})]})]},\"\".concat(item.label,\"-\").concat(index));})})]})]});});// Function สำหรับตัดคำยาว\nconst truncatePosition=position=>{if(!position)return'';const removePatterns=['เจ้าพนักงานตำรวจศาล','ตำรวจศาล','ตำรวจ','พนักงาน'];let result=position;for(const pattern of removePatterns){result=result.replace(new RegExp(pattern,'gi'),'');}return result.trim()||position;};// Function สำหรับตัดคำ \"ศาล\" ออกจากสังกัด\nconst truncateAffiliation=affiliation=>{if(!affiliation)return'';const lower=affiliation.toLowerCase();// Only remove the leading word 'ศาล' for affiliations that describe\n// 'ในสังกัดสำนักยุติธรรมประจำภาค' (or variants). Do not strip 'ศาล'\n// from other court names like 'ศาลสูง' or 'ศาลชำนาญพิเศษ'.\nif(lower.includes('ในสังกัดสำนักยุติธรรมประจำภาค')||lower.includes('ในสังกัดสำนักยุติธรรม')){return affiliation.replace(/^ศาล\\s*/i,'').trim()||affiliation;}// Otherwise return affiliation unchanged\nreturn affiliation;};// --- NEW: Proportional Treemap Chart Component ---\n// --- NEW: Proportional Treemap Chart Component (MODIFIED FOR LOGARITHMIC SCALE) ---\nconst TreemapChart=/*#__PURE__*/memo(_ref3=>{let{title,data,colors=[]}=_ref3;// --- ส่วนที่แก้ไข: คำนวณ total จากค่าจริงก่อนแปลงสเกล ---\nconst originalTotal=useMemo(()=>data.reduce((sum,d)=>sum+d.value,0),[data]);// --- ส่วนที่แก้ไข: สร้างข้อมูลชุดใหม่ที่มีการปรับสเกลด้วย Math.log1p ---\n// Math.log1p(x) จะคำนวณ log(1+x) ช่วยให้ค่าที่น้อยๆ มีขนาดใหญ่ขึ้นเมื่อเทียบกับค่ามากๆ\nconst scaledData=useMemo(()=>data.map(item=>_objectSpread(_objectSpread({},item),{},{scaledValue:Math.log1p(item.value)})),[data]);const generateTreemapLayout=useCallback((items,width,height)=>{let rects=[];const layoutRow=(rowItems,x,y,w,h)=>{if(!rowItems.length)return;// --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\nconst totalValue=rowItems.reduce((sum,i)=>sum+i.scaledValue,0);if(totalValue===0)return;let offset=0;const isHorizontal=w>h;for(const item of rowItems){// --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\nconst percentage=item.scaledValue/totalValue;if(isHorizontal){const rectWidth=w*percentage;rects.push({x:x+offset,y,width:rectWidth,height:h,item});offset+=rectWidth;}else{const rectHeight=h*percentage;rects.push({x,y:y+offset,width:w,height:rectHeight,item});offset+=rectHeight;}}};const squarify=(items,x,y,w,h)=>{if(!items.length)return;if(items.length<=4){layoutRow(items,x,y,w,h);return;}// --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\nconst halfValue=items.reduce((sum,i)=>sum+i.scaledValue,0)/2;let runningTotal=0;let splitIndex=0;for(let i=0;i<items.length;i++){// --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\nrunningTotal+=items[i].scaledValue;if(runningTotal>=halfValue){splitIndex=i+1;break;}}splitIndex=Math.max(1,splitIndex);const groupA=items.slice(0,splitIndex);const groupB=items.slice(splitIndex);const groupATotal=groupA.reduce((sum,i)=>sum+i.scaledValue,0);const totalValue=groupATotal+groupB.reduce((sum,i)=>sum+i.scaledValue,0);if(totalValue===0)return;if(w>h){const groupAWidth=w*(groupATotal/totalValue);squarify(groupA,x,y,groupAWidth,h);squarify(groupB,x+groupAWidth,y,w-groupAWidth,h);}else{const groupAHeight=h*(groupATotal/totalValue);squarify(groupA,x,y,w,groupAHeight);squarify(groupB,x,y+groupAHeight,w,h-groupAHeight);}};squarify(items,0,0,1000,1000);// Use a relative base for layout\nreturn rects;},[]);// --- ส่วนที่แก้ไข: ส่ง scaledData เข้าไปคำนวณ layout ---\nconst layout=useMemo(()=>generateTreemapLayout(scaledData),[scaledData,generateTreemapLayout]);if(!data.length||originalTotal===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 h-full\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-500\",children:\"\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E41\\u0E2A\\u0E14\\u0E07\\u0E01\\u0E23\\u0E32\\u0E1F\"})})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 flex flex-col h-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-slate-900\",children:originalTotal}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-slate-500\",children:\"\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"relative w-full flex-1\",children:layout.map(rect=>{const itemIndex=scaledData.findIndex(d=>d.label===rect.item.label);const color=colors[itemIndex%colors.length];// --- ส่วนที่แก้ไข: คำนวณ % จากค่าจริง ---\nconst percentage=originalTotal>0?(rect.item.value/originalTotal*100).toFixed(1):0;const valueText=\"\".concat(rect.item.value,\" (\").concat(percentage,\"%)\");const fontSize=Math.min(rect.width/10,rect.height/5,16);const textShadowStyle={textShadow:'0px 1px 3px rgba(0, 0, 0, 0.6)'};return/*#__PURE__*/_jsxs(\"div\",{className:\"absolute border-2 border-white rounded-md flex flex-col items-center justify-center p-1 overflow-hidden text-center\",style:{left:\"\".concat(rect.x/10,\"%\"),top:\"\".concat(rect.y/10,\"%\"),width:\"\".concat(rect.width/10,\"%\"),height:\"\".concat(rect.height/10,\"%\"),backgroundColor:color,transition:'all 0.4s ease-in-out'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-white font-bold\",style:_objectSpread({fontSize:\"\".concat(fontSize,\"px\")},textShadowStyle),children:valueText}),/*#__PURE__*/_jsx(\"div\",{className:\"text-white opacity-90 leading-tight\",style:_objectSpread({fontSize:\"\".concat(Math.max(fontSize*0.7,10),\"px\")},textShadowStyle),children:rect.item.label})]},rect.item.label);})})]});});// Pie Chart Component - ปรับปรุงให้สวยงาม\nconst PieChartComponent=/*#__PURE__*/memo(_ref4=>{let{title,data,colors=[]}=_ref4;const total=useMemo(()=>data.reduce((sum,d)=>sum+d.value,0),[data]);if(!data.length||total===0){return/*#__PURE__*/_jsx(\"div\",{className:\"h-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-500\",children:\"\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E41\\u0E2A\\u0E14\\u0E07\\u0E01\\u0E23\\u0E32\\u0E1F\"})})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"h-full flex flex-col\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center mb-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-xl font-bold text-slate-900\",children:[\"\\u0E08\\u0E33\\u0E19\\u0E27\\u0E19 \",total,\" \\u0E04\\u0E19\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 flex flex-col items-center justify-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"relative w-80 h-80 mb-8\",children:/*#__PURE__*/_jsx(\"svg\",{width:\"320\",height:\"320\",viewBox:\"0 0 320 320\",className:\"w-full h-full\",children:data.map((item,index)=>{const percentage=item.value/total;const angle=percentage*360;const prevPercentage=data.slice(0,index).reduce((sum,d)=>sum+d.value,0)/total;const startAngle=prevPercentage*360-90;const endAngle=startAngle+angle;// Pie chart - เป็นวงกลมเต็ม ไม่ใช่โดนัท\nconst radius=140;const startX=160+radius*Math.cos(startAngle*Math.PI/180);const startY=160+radius*Math.sin(startAngle*Math.PI/180);const endX=160+radius*Math.cos(endAngle*Math.PI/180);const endY=160+radius*Math.sin(endAngle*Math.PI/180);const largeArcFlag=angle>180?1:0;const pathData=['M',160,160,// เริ่มที่จุดกึ่งกลาง\n'L',startX,startY,'A',radius,radius,0,largeArcFlag,1,endX,endY,'Z'].join(' ');const pieColors=['#8b5cf6','#ec4899','#06b6d4','#10b981','#f59e0b','#ef4444','#84cc16','#6366f1','#f97316','#14b8a6'];const color=pieColors[index%pieColors.length];// คำนวณตำแหน่งสำหรับแสดง percentage\nconst midAngle=startAngle+angle/2;const labelRadius=120;const labelX=160+labelRadius*Math.cos(midAngle*Math.PI/180);const labelY=160+labelRadius*Math.sin(midAngle*Math.PI/180);const percentageText=\"\".concat((percentage*100).toFixed(1),\"%\");return/*#__PURE__*/_jsxs(\"g\",{children:[/*#__PURE__*/_jsx(\"path\",{d:pathData,fill:color,stroke:\"white\",strokeWidth:\"3\",className:\"hover:opacity-80 transition-opacity duration-200\"}),percentage>0.05&&/*#__PURE__*/_jsx(\"text\",{x:labelX,y:labelY,textAnchor:\"middle\",dominantBaseline:\"middle\",fill:\"white\",fontSize:\"14\",fontWeight:\"bold\",stroke:\"#1e293b\",strokeWidth:\"1\",paintOrder:\"stroke\",children:percentageText})]},\"pie-\".concat(index));})})}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full\",children:/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2\",children:data.map((item,index)=>{const percentage=(item.value/total*100).toFixed(0);const pieColors=['#8b5cf6','#ec4899','#06b6d4','#10b981','#f59e0b','#ef4444','#84cc16','#6366f1','#f97316','#14b8a6'];const color=pieColors[index%pieColors.length];return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 min-w-0 flex-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 rounded-full flex-shrink-0\",style:{backgroundColor:color}}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-slate-700\",children:[truncateAffiliation(item.label),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-slate-900\",children:item.value}),\" \\u0E04\\u0E19\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm font-bold text-slate-900 ml-2\",children:[percentage,\"%\"]})]},\"legend-\".concat(item.label,\"-\").concat(index));})})})]})]});});// Horizontal Bar Chart Component\nconst HorizontalBarChart=/*#__PURE__*/memo(_ref5=>{let{title,data,colors=[],maxHeight='320px'}=_ref5;const getSortOrder=label=>{const regionMatch=label.match(/ภาค\\s*(\\d+)/);if(regionMatch)return parseInt(regionMatch[1]);const customOrder=['ศาลชั้นต้นในเขตกรุงเทพมหานคร','ศูนย์รักษาความปลอดภัย','ศาลชำนาญพิเศษ','ศาลสูง'];const index=customOrder.findIndex(item=>label.includes(item));if(index!==-1)return 100+index;return 999;};const sortedData=useMemo(()=>[...data].sort((a,b)=>getSortOrder(a.label)-getSortOrder(b.label)),[data]);const maxValue=useMemo(()=>{if(!sortedData||sortedData.length===0)return 0;return Math.max(...sortedData.map(d=>d.value));},[sortedData]);if(!sortedData.length||maxValue===0){return/*#__PURE__*/_jsx(\"div\",{className:\"h-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-500\",children:\"\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E41\\u0E2A\\u0E14\\u0E07\\u0E01\\u0E23\\u0E32\\u0E1F\"})})});}return/*#__PURE__*/_jsx(\"div\",{className:\"h-full\",children:/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2 h-full overflow-y-auto\",children:sortedData.map((item,index)=>{const barWidth=item.value/maxValue*100;const color=colors[index%colors.length]||'#8b5cf6';return/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-3 gap-2 items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-span-1 text-sm text-slate-700 font-medium text-left truncate\",title:item.label,children:item.label}),/*#__PURE__*/_jsx(\"div\",{className:\"col-span-2 w-full bg-slate-100 rounded-full h-7 relative\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-7 rounded-full transition-all duration-700 flex items-center justify-end pr-3\",style:{width:\"\".concat(barWidth,\"%\"),backgroundColor:color,minWidth:'36px'},children:/*#__PURE__*/_jsx(\"span\",{className:\"text-white text-sm font-bold\",children:item.value})})})]},\"\".concat(item.label,\"-\").concat(index));})})});});// SummaryCards Component - แทนที่กราฟโดนัท\nconst SummaryCards=/*#__PURE__*/memo(_ref6=>{var _sortedData$,_sortedData$2;let{data,colors=[]}=_ref6;const total=useMemo(()=>data.reduce((sum,d)=>sum+d.value,0),[data]);const sortedData=useMemo(()=>[...data].sort((a,b)=>b.value-a.value),[data]);if(!data.length||total===0){return/*#__PURE__*/_jsx(\"div\",{className:\"h-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-500\",children:\"\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E41\\u0E2A\\u0E14\\u0E07\\u0E1C\\u0E25\"})})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"h-full overflow-y-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-xl\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold\",children:total}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm opacity-90\",children:\"\\u0E23\\u0E27\\u0E21\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold\",children:((_sortedData$=sortedData[0])===null||_sortedData$===void 0?void 0:_sortedData$.value)||0}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm opacity-90\",children:[\"\\u0E2A\\u0E39\\u0E07\\u0E2A\\u0E38\\u0E14: \",((_sortedData$2=sortedData[0])===null||_sortedData$2===void 0?void 0:_sortedData$2.label)||'ไม่มีข้อมูล']})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3\",children:sortedData.map((item,index)=>{const percentage=(item.value/total*100).toFixed(1);const color=colors[index%colors.length]||'#8b5cf6';return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-r from-slate-50 to-slate-100 border border-slate-200 rounded-lg p-4 hover:shadow-md transition-all duration-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 rounded-full\",style:{backgroundColor:color}}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-slate-800\",children:item.label})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-slate-900\",children:item.value}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-slate-500\",children:[percentage,\"%\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full bg-slate-200 rounded-full h-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-2 rounded-full transition-all duration-700\",style:{width:\"\".concat(percentage,\"%\"),backgroundColor:color}})})]},\"\".concat(item.label,\"-\").concat(index));})})]});});// (moved into the PersonnelPage component to avoid calling hooks at top level)\n// EditableCard Component (restored minimal implementation)\nconst EditableCard=/*#__PURE__*/memo(_ref7=>{let{title,value,icon:Icon,color=\"blue\",isEditing,onEdit,onChange,isAdmin}=_ref7;const[localValue,setLocalValue]=useState(value);useEffect(()=>{setLocalValue(value);},[value]);const handleChange=e=>{const newValue=parseInt(e.target.value)||0;setLocalValue(newValue);onChange(newValue);};return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-\".concat(color,\"-100 rounded-xl flex items-center justify-center\"),children:Icon&&/*#__PURE__*/_jsx(Icon,{className:\"w-6 h-6 text-\".concat(color,\"-600\")})}),isAdmin&&/*#__PURE__*/_jsx(\"button\",{onClick:onEdit,className:\"text-slate-400 hover:text-slate-600 transition-colors\",children:isEditing?/*#__PURE__*/_jsx(Save,{className:\"w-5 h-5\"}):/*#__PURE__*/_jsx(Edit2,{className:\"w-5 h-5\"})})]}),isEditing?/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:localValue,onChange:handleChange,className:\"w-full text-3xl font-bold text-slate-900 mb-1 bg-slate-50 border border-slate-200 rounded px-2 py-1\",min:\"0\"}):/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-slate-900 mb-1\",children:localValue}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-slate-600\",children:title})]});});// PersonnelDetailModal (minimal)\nconst PersonnelDetailModal=/*#__PURE__*/memo(_ref8=>{let{person,isOpen,onClose}=_ref8;if(!isOpen||!person)return null;// Calculate age from birth date\nconst calculateAge=dob=>{if(!dob)return'ไม่ระบุ';try{const birthDate=new Date(dob);const today=new Date();let age=today.getFullYear()-birthDate.getFullYear();const monthDiff=today.getMonth()-birthDate.getMonth();if(monthDiff<0||monthDiff===0&&today.getDate()<birthDate.getDate()){age--;}return\"\".concat(age,\" \\u0E1B\\u0E35\");}catch(error){return'ไม่ระบุ';}};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-50 overflow-y-auto bg-black/60 hide-scrollbar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex min-h-screen items-start justify-center p-3 sm:p-6 md:p-10\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative bg-gradient-to-br from-white via-slate-50 to-indigo-50 rounded-2xl sm:rounded-3xl shadow-2xl max-w-3xl w-full p-4 sm:p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between mb-6 pb-4 border-b border-slate-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 sm:w-16 sm:h-16 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-lg sm:text-xl font-bold shadow-lg\",children:(person.firstname||'N')[0]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-lg sm:text-xl font-bold text-slate-900\",children:[person.prefix,\" \",person.firstname,\" \",person.lastname]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-slate-600\",children:person.position||'ไม่ระบุตำแหน่ง'})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"p-2 text-slate-400 hover:text-slate-600 hover:bg-white/80 rounded-lg transition-all duration-200\",children:/*#__PURE__*/_jsx(X,{className:\"w-5 h-5\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-br from-white to-blue-50 rounded-xl p-4 sm:p-5 shadow-lg border border-slate-200/50\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-base sm:text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Phone,{className:\"w-5 h-5 text-blue-600\"}),\"\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E15\\u0E34\\u0E14\\u0E15\\u0E48\\u0E2D\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\",children:[/*#__PURE__*/_jsx(Phone,{className:\"w-4 h-4 text-slate-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-slate-700\",children:person.phone||'ไม่ระบุ'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\",children:[/*#__PURE__*/_jsx(Mail,{className:\"w-4 h-4 text-slate-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-slate-700\",children:person.email||'ไม่ระบุ'})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-br from-white to-green-50 rounded-xl p-4 sm:p-5 shadow-lg border border-slate-200/50\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-base sm:text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Building,{className:\"w-5 h-5 text-green-600\"}),\"\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E01\\u0E32\\u0E23\\u0E17\\u0E33\\u0E07\\u0E32\\u0E19\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\",children:[/*#__PURE__*/_jsx(Building2,{className:\"w-4 h-4 text-slate-500\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-slate-700\",children:\"\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-slate-600\",children:person.affiliation||'ไม่ระบุ'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-4 h-4 text-slate-500\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-slate-700\",children:\"\\u0E2B\\u0E19\\u0E48\\u0E27\\u0E22\\u0E07\\u0E32\\u0E19\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-slate-600\",children:person.deph||'ไม่ระบุ'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\",children:[/*#__PURE__*/_jsx(Crown,{className:\"w-4 h-4 text-slate-500\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-slate-700\",children:\"\\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-slate-600\",children:person.position||'ไม่ระบุ'})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-2 bg-gradient-to-br from-white to-purple-50 rounded-xl p-4 sm:p-5 shadow-lg border border-slate-200/50\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-base sm:text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(FileText,{className:\"w-5 h-5 text-purple-600\"}),\"\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E40\\u0E1E\\u0E34\\u0E48\\u0E21\\u0E40\\u0E15\\u0E34\\u0E21\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 gap-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-slate-700\",children:\"\\u0E2D\\u0E32\\u0E22\\u0E38\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-slate-600 p-2 bg-white/70 rounded-lg\",children:calculateAge(person.dob)})]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t border-slate-200\",children:[person.phone&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>window.open(\"tel:\".concat(person.phone),'_self'),className:\"flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5\",children:[/*#__PURE__*/_jsx(Phone,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium\",children:\"\\u0E42\\u0E17\\u0E23\\u0E2B\\u0E32\"})]}),person.email&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>window.open(\"mailto:\".concat(person.email),'_self'),className:\"flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5\",children:[/*#__PURE__*/_jsx(Mail,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium\",children:\"\\u0E2A\\u0E48\\u0E07\\u0E2D\\u0E35\\u0E40\\u0E21\\u0E25\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-slate-500 to-slate-600 text-white rounded-lg hover:from-slate-600 hover:to-slate-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 sm:ml-auto\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium\",children:\"\\u0E1B\\u0E34\\u0E14\"})})]})]})})});});// SearchModal (enhanced with department filtering and game-card style)\n// Small visual card for a person used in search results (game-card style)\nconst PersonCard=/*#__PURE__*/memo(_ref9=>{let{person,onView,onCall,onMail}=_ref9;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-br from-white via-blue-50 to-indigo-100 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 p-4 sm:p-6 border border-indigo-200 hover:border-indigo-300 transform hover:scale-105\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm sm:text-base font-bold text-slate-900 mb-1\",children:[person.prefix,\" \",person.firstname,\" \",person.lastname]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs sm:text-sm text-indigo-600 font-medium\",children:person.position||'ไม่ระบุตำแหน่ง'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-xs sm:text-sm text-slate-600\",children:[/*#__PURE__*/_jsx(Building2,{className:\"w-4 h-4 text-indigo-500 flex-shrink-0\"}),/*#__PURE__*/_jsx(\"span\",{className:\"truncate\",children:person.affiliation||'ไม่ระบุสังกัด'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-xs sm:text-sm text-slate-600\",children:[/*#__PURE__*/_jsx(Briefcase,{className:\"w-4 h-4 text-purple-500 flex-shrink-0\"}),/*#__PURE__*/_jsx(\"span\",{className:\"truncate\",children:person.deph||'ไม่ระบุหน่วยงาน'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onView(person),className:\"w-full px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-xl text-sm font-medium flex items-center justify-center gap-2 transition-all duration-200 shadow-md hover:shadow-lg\",children:[/*#__PURE__*/_jsx(Eye,{className:\"w-4 h-4\"}),\"\\u0E14\\u0E39\\u0E23\\u0E32\\u0E22\\u0E25\\u0E30\\u0E40\\u0E2D\\u0E35\\u0E22\\u0E14\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[person.phone&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onCall(person.phone),className:\"flex-1 p-2 rounded-xl bg-green-100 hover:bg-green-200 text-green-600 transition-colors shadow-sm flex items-center justify-center gap-1\",title:\"\\u0E42\\u0E17\\u0E23\",children:[/*#__PURE__*/_jsx(Phone,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"\\u0E42\\u0E17\\u0E23\"})]}),person.email&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onMail(person.email),className:\"flex-1 p-2 rounded-xl bg-blue-100 hover:bg-blue-200 text-blue-600 transition-colors shadow-sm flex items-center justify-center gap-1\",title:\"\\u0E2D\\u0E35\\u0E40\\u0E21\\u0E25\",children:[/*#__PURE__*/_jsx(Mail,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"\\u0E2D\\u0E35\\u0E40\\u0E21\\u0E25\"})]})]})]})]});});const SearchModal=/*#__PURE__*/memo(_ref0=>{let{isOpen,onClose,personnelData=[],stats={},onViewPerson=()=>{},onExport=()=>{},user}=_ref0;const[query,setQuery]=useState('');const[filterAff,setFilterAff]=useState('');const[filterDept,setFilterDept]=useState('');const[filterPos,setFilterPos]=useState('');// Get unique affiliations\nconst affiliations=useMemo(()=>{const setAff=new Set();personnelData.forEach(p=>setAff.add(p.affiliation||'ไม่ระบุ'));return Array.from(setAff).sort();},[personnelData]);// Get departments based on selected affiliation\nconst departments=useMemo(()=>{const relevantPersonnel=filterAff?personnelData.filter(p=>(p.affiliation||'ไม่ระบุ')===filterAff):personnelData;const setDept=new Set();relevantPersonnel.forEach(p=>setDept.add(p.deph||'ไม่ระบุ'));return Array.from(setDept).sort();},[personnelData,filterAff]);// Get positions\nconst positions=useMemo(()=>{const s=new Set();personnelData.forEach(p=>s.add(p.position||'ไม่ระบุ'));return Array.from(s).sort();},[personnelData]);// Reset department when affiliation changes\nuseEffect(()=>{if(filterAff){setFilterDept('');}},[filterAff]);if(!isOpen)return null;const results=personnelData.filter(p=>{const hay=\"\".concat(p.firstname,\" \").concat(p.lastname,\" \").concat(p.position||'',\" \").concat(p.affiliation||'',\" \").concat(p.deph||'').toLowerCase();if(query&&!hay.includes(query.toLowerCase()))return false;if(filterAff&&(p.affiliation||'ไม่ระบุ')!==filterAff)return false;if(filterDept&&(p.deph||'ไม่ระบุ')!==filterDept)return false;if(filterPos&&(p.position||'ไม่ระบุ')!==filterPos)return false;return true;});const handleCall=tel=>window.open(\"tel:\".concat(tel),'_self');const handleMail=email=>window.open(\"mailto:\".concat(email),'_self');const clearFilters=()=>{setFilterAff('');setFilterDept('');setFilterPos('');setQuery('');};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-50 overflow-y-auto bg-black/60 hide-scrollbar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex min-h-screen items-start justify-center p-3 sm:p-6 md:p-10\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative bg-white rounded-2xl sm:rounded-3xl shadow-2xl max-w-6xl w-full p-4 sm:p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4 sm:mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg sm:text-xl font-bold text-slate-900\",children:\"\\uD83D\\uDD0D \\u0E04\\u0E49\\u0E19\\u0E2B\\u0E32\\u0E1A\\u0E38\\u0E04\\u0E25\\u0E32\\u0E01\\u0E23\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors\",children:/*#__PURE__*/_jsx(X,{className:\"w-5 h-5\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6\",children:[/*#__PURE__*/_jsx(\"input\",{value:query,onChange:e=>setQuery(e.target.value),className:\"w-full p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm\",placeholder:\"\\uD83D\\uDD0D \\u0E04\\u0E49\\u0E19\\u0E2B\\u0E32\\u0E0A\\u0E37\\u0E48\\u0E2D, \\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07...\"}),/*#__PURE__*/_jsxs(\"select\",{value:filterAff,onChange:e=>setFilterAff(e.target.value),className:\"p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\uD83C\\uDFE2 \\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14 (\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14)\"}),affiliations.map(a=>/*#__PURE__*/_jsx(\"option\",{value:a,children:a},a))]}),/*#__PURE__*/_jsxs(\"select\",{value:filterDept,onChange:e=>setFilterDept(e.target.value),className:\"p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm\",disabled:!filterAff,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\uD83C\\uDFDB\\uFE0F \\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14 (\\u0E2B\\u0E19\\u0E48\\u0E27\\u0E22\\u0E07\\u0E32\\u0E19)\"}),departments.map(d=>/*#__PURE__*/_jsx(\"option\",{value:d,children:d},d))]}),/*#__PURE__*/_jsxs(\"select\",{value:filterPos,onChange:e=>setFilterPos(e.target.value),className:\"p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\uD83D\\uDC64 \\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14 (\\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07)\"}),positions.map(p=>/*#__PURE__*/_jsx(\"option\",{value:p,children:p},p))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-slate-600 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-4 h-4 text-indigo-500\"}),\"\\u0E1E\\u0E1A \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-indigo-600\",children:results.length}),\" \\u0E23\\u0E32\\u0E22\\u0E01\\u0E32\\u0E23\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:clearFilters,className:\"text-sm text-slate-600 px-3 py-1 rounded-lg bg-slate-100 hover:bg-slate-200 transition-colors\",children:\"\\uD83D\\uDDD1\\uFE0F \\u0E25\\u0E49\\u0E32\\u0E07\\u0E15\\u0E31\\u0E27\\u0E01\\u0E23\\u0E2D\\u0E07\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onExport(results),className:\"text-sm px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Download,{className:\"w-4 h-4\"}),\"\\u0E2A\\u0E48\\u0E07\\u0E2D\\u0E2D\\u0E01\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 max-h-[60vh] overflow-y-auto hide-scrollbar\",children:[results.map((p,i)=>/*#__PURE__*/_jsx(PersonCard,{person:p,onView:onViewPerson,onCall:handleCall,onMail:handleMail},\"\".concat(p.phone||i,\"-\").concat(i))),results.length===0&&/*#__PURE__*/_jsxs(\"div\",{className:\"col-span-full text-center text-slate-500 py-12\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-16 h-16 text-slate-300 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-slate-600 mb-2\",children:\"\\u0E44\\u0E21\\u0E48\\u0E1E\\u0E1A\\u0E1C\\u0E25\\u0E25\\u0E31\\u0E1E\\u0E18\\u0E4C\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:\"\\u0E25\\u0E2D\\u0E07\\u0E40\\u0E1B\\u0E25\\u0E35\\u0E48\\u0E22\\u0E19\\u0E04\\u0E33\\u0E04\\u0E49\\u0E19\\u0E2B\\u0E32\\u0E2B\\u0E23\\u0E37\\u0E2D\\u0E15\\u0E31\\u0E27\\u0E01\\u0E23\\u0E2D\\u0E07\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\"})]})]})]})})});});export default function PersonnelPage(_ref1){let{user}=_ref1;const[loading,setLoading]=useState(true);const[refreshing,setRefreshing]=useState(false);const[error,setError]=useState(\"\");const[personnelData,setPersonnelData]=useState([]);const[selectedPerson,setSelectedPerson]=useState(null);const[showDetail,setShowDetail]=useState(false);const[showSearchModal,setShowSearchModal]=useState(false);const[quota,setQuota]=useState(0);const[vacancy,setVacancy]=useState(0);const[isEditingQuota,setIsEditingQuota]=useState(false);const[isEditingVacancy,setIsEditingVacancy]=useState(false);const[generalStatsData,setGeneralStatsData]=useState({});const[selectedChart,setSelectedChart]=useState(\"position\");// Default chart type\nconst[selectedAffiliation,setSelectedAffiliation]=useState(\"\");// For department filtering\nconst[filters,setFilters]=useState({affiliation:\"\",department:\"\",ageRange:\"\",gender:\"\"});const logAdminActivity=useCallback((action,details)=>{if(!user)return;fetch(CONFIG.ADMIN_API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'log_activity',log_action:action,log_details:details||null,user_id:user.id,username:user.username})}).catch(error=>console.error('Failed to log activity:',error));},[user]);// ฟังก์ชันดึงข้อมูลจาก general_stats API\nconst fetchGeneralStats=useCallback(async()=>{try{const response=await fetch(CONFIG.GENERAL_STATS_API);if(!response.ok)throw new Error(\"HTTP error! status: \".concat(response.status));const result=await response.json();if(result.success&&Array.isArray(result.data)){const statsMap={};result.data.forEach(item=>{statsMap[item.name]=item.value;});setGeneralStatsData(statsMap);// ตั้งค่า quota และ vacancy จากข้อมูล API\nsetQuota(statsMap.quota||0);setVacancy(statsMap.vacancy||0);}}catch(error){console.error('Error fetching general stats:',error);// ใช้ค่าเริ่มต้นในกรณีที่ดึงข้อมูลไม่ได้\nsetQuota(100);setVacancy(20);}},[]);// ฟังก์ชันอัพเดทค่าใน general_stats\nconst updateGeneralStat=useCallback(async(name,value)=>{try{const response=await fetch(\"\".concat(CONFIG.GENERAL_STATS_API,\"/value/\").concat(name),{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify({value:parseInt(value)})});if(!response.ok){// ถ้ายังไม่มีข้อมูล ให้สร้างใหม่\nif(response.status===404){const createResponse=await fetch(CONFIG.GENERAL_STATS_API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name:name,value:parseInt(value),description:name==='quota'?'กรอบอัตรากำลังทั้งหมด':'จำนวนตำแหน่งว่าง'})});if(!createResponse.ok){throw new Error('Failed to create new stat');}}else{throw new Error('Failed to update stat');}}// อัพเดทข้อมูลใน state\nsetGeneralStatsData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:parseInt(value)}));}catch(error){console.error(\"Error updating \".concat(name,\":\"),error);alert(\"\\u0E40\\u0E01\\u0E34\\u0E14\\u0E02\\u0E49\\u0E2D\\u0E1C\\u0E34\\u0E14\\u0E1E\\u0E25\\u0E32\\u0E14\\u0E43\\u0E19\\u0E01\\u0E32\\u0E23\\u0E1A\\u0E31\\u0E19\\u0E17\\u0E36\\u0E01 \".concat(name==='quota'?'กรอบอัตรา':'ตำแหน่งว่าง'));}},[]);const fetchPersonnelData=useCallback(async()=>{try{const apiUrl=CONFIG.OFFICERS_API;const response=await fetch(apiUrl);if(!response.ok)throw new Error(\"HTTP error! status: \".concat(response.status));const text=await response.text();if(!text)throw new Error('Empty response from server');const result=JSON.parse(text);const data=result.success&&Array.isArray(result.data)?result.data:[];const formattedData=data.map(person=>({phone:person.phone||'',prefix:person.prefix||'',firstname:person.firstname||'',lastname:person.lastname||'',position:person.position||'',affiliation:person.affiliation||'',deph:person.department||'',generation:person.generation||'',email:person.email||'',dob:person.dob||'',lineUserId:person.lineUserId||'',role:person.role||'member'}));setPersonnelData(formattedData);setError(\"\");}catch(error){setError(\"\\u26A0\\uFE0F \".concat(error.message));setPersonnelData([]);}},[]);useEffect(()=>{fetchPersonnelData();fetchGeneralStats();// เพิ่มการดึงข้อมูล general stats\n},[fetchPersonnelData,fetchGeneralStats]);const handleRefresh=()=>{setRefreshing(true);Promise.all([fetchPersonnelData(),fetchGeneralStats()]).finally(()=>setRefreshing(false));};const handleViewPerson=person=>{// If user opened from search, close search modal first so detail appears on top\nsetShowSearchModal(false);setSelectedPerson(person);setShowDetail(true);};const exportToCSV=data=>{// Implement CSV export logic here\n};const affiliationAbbreviations={\"ศูนย์รักษาความปลอดภัย\":\"ส่วนกลาง\",\"ศาลชั้นต้นในกรุงเทพมหานคร\":\"กทม.\"};const filteredAffiliationData=useMemo(()=>{return personnelData.reduce((acc,person)=>{let affiliation=(person.affiliation||'').trim();if(!affiliation)affiliation='ไม่ระบุ';const lower=affiliation.toLowerCase();// Normalize known patterns using targeted rules\nlet normalized=affiliation;// If it's the regional office pattern that contains สำนักศาลยุติธรรมประจำภาค\n// we want to convert it to: 'ภาค <n>' when a number exists, otherwise 'ภาค'\nif(lower.includes('สำนักศาลยุติธรรมประจำภาค')||lower.includes('สำนักยุติธรรมประจำภาค')||lower.includes('ในสังกัดสำนักศาลยุติธรรมประจำภาค')||lower.includes('ศาลในสังกัดสำนักศาลยุติธรรมประจำภาค')){// Try to extract explicit 'ภาค <number>' first\nconst matchRegion=affiliation.match(/ภาค\\s*(\\d{1,3})/i);if(matchRegion&&matchRegion[1]){normalized=\"\\u0E20\\u0E32\\u0E04 \".concat(matchRegion[1]);}else{// Fallback: find any trailing number in the string (e.g., '... ประจำภาค 4')\nconst trailingNum=affiliation.match(/(\\d{1,3})\\s*$/);if(trailingNum&&trailingNum[1]){normalized=\"\\u0E20\\u0E32\\u0E04 \".concat(trailingNum[1]);}else{// Last-resort: any first number in the string\nconst anyNum=affiliation.match(/(\\d{1,3})/);normalized=anyNum&&anyNum[1]?\"\\u0E20\\u0E32\\u0E04 \".concat(anyNum[1]):'ภาค';}}}else if(lower.includes('ศูนย์รักษาความปลอดภัย')){normalized='ส่วนกลาง';}else if(lower.includes('กรุงเทพ')||lower.includes('กรุงเทพมหานคร')||lower.includes('ศาลชั้นต้นในกรุงเทพมหานคร')){normalized='กทม.';}else{// fallback to any exact mapping we defined, otherwise keep original\nnormalized=affiliationAbbreviations[affiliation]||affiliation;}acc[normalized]=(acc[normalized]||0)+1;return acc;},{});},[personnelData]);const chartData=useMemo(()=>{const entries=Object.entries(filteredAffiliationData).map(_ref10=>{let[label,value]=_ref10;return{label,value};});const getOrderKey=label=>{if(!label)return 9999;const l=String(label).trim();// Match 'ภาค' followed by number e.g. 'ภาค 1' or 'ภาค1'\nconst m=l.match(/ภาค\\s*(\\d{1,3})/);if(m&&m[1]){// Put ภาค N in order 0.. (keep N small)\nconst num=parseInt(m[1],10);return num;// 1..9 -> 1..9 (smaller is earlier)\n}// If label is exactly 'ภาค' (no number), put after numbered ภาค\nif(/^ภาค$/i.test(l))return 999;// Specific named orders after ภาค group\nif(l==='กทม.'||l.toLowerCase()==='กทม.')return 1000;if(l==='ส่วนกลาง'||l.toLowerCase()==='ส่วนกลาง')return 1001;if(l.includes('ศาลสูง'))return 1002;// handle both spellings 'ชำนาญ' and 'ชำนัญ'\nif(l.includes('ชำนาญ')||l.includes('ชำนัญ')||l.includes('ชำนัญพิเศษ')||l.includes('ชำนาญพิเศษ'))return 1003;// Default: place after known groups but preserve alphabetical order by returning a high key plus name\nreturn 5000+l.charCodeAt(0);};entries.sort((a,b)=>{const ka=getOrderKey(a.label);const kb=getOrderKey(b.label);if(ka===kb){// fallback alphabetical\nreturn String(a.label).localeCompare(String(b.label));}return ka-kb;});return entries;},[filteredAffiliationData]);const stats=useMemo(()=>{const newStats={total:personnelData.length,connected:personnelData.filter(p=>p.lineUserId).length,byPosition:{},byAffiliation:{},byDepartment:{},byGeneration:{}};personnelData.forEach(person=>{const position=person.position||'ไม่ระบุ';newStats.byPosition[position]=(newStats.byPosition[position]||0)+1;const affiliation=person.affiliation||'ไม่ระบุ';newStats.byAffiliation[affiliation]=(newStats.byAffiliation[affiliation]||0)+1;const department=person.deph||'ไม่ระบุตำแหน่ง';newStats.byDepartment[department]=(newStats.byDepartment[department]||0)+1;const generation=person.generation?String(person.generation).trim():'ไม่ระบุตำแหน่ง';newStats.byGeneration[generation]=(newStats.byGeneration[generation]||0)+1;});return newStats;},[personnelData]);const chartColors=[\"#FF6384\",\"#36A2EB\",\"#FFCE56\",\"#4BC0C0\",\"#9966FF\",\"#FF9F40\",\"#FFCD56\",\"#C9CBCF\"];// Helper: build chart data for different types (inside component)\nconst getChartData=useCallback(type=>{if(type==='affiliation')return chartData;// already normalized affiliation entries\nif(type==='position'){// build from stats.byPosition\nconst entries=Object.entries(stats.byPosition||{}).map(_ref11=>{let[label,value]=_ref11;return{label,value};});// sort by value desc\nentries.sort((a,b)=>b.value-a.value);return entries;}if(type==='department'){// build from deph field - filter by selected affiliation if any\nconst groups={};const filteredData=selectedAffiliation?personnelData.filter(p=>(p.affiliation||'ไม่ระบุ')===selectedAffiliation):personnelData;filteredData.forEach(p=>{const dept=p.deph||'ไม่ระบุ';groups[dept]=(groups[dept]||0)+1;});return Object.entries(groups).map(_ref12=>{let[label,value]=_ref12;return{label,value};}).sort((a,b)=>b.value-a.value);}if(type==='age'){// derive age groups from dob (basic)\nconst groups={'<30':0,'30-39':0,'40-49':0,'50-59':0,'60+':0};const now=new Date();personnelData.forEach(p=>{if(!p.dob)return;const m=String(p.dob).match(/(\\d{4})/);if(!m)return;const year=parseInt(m[1],10);if(isNaN(year))return;const age=now.getFullYear()-year;if(age<30)groups['<30']++;else if(age<40)groups['30-39']++;else if(age<50)groups['40-49']++;else if(age<60)groups['50-59']++;else groups['60+']++;});return Object.entries(groups).map(_ref13=>{let[label,value]=_ref13;return{label,value};});}if(type==='gender'){// no gender field in data - return empty to show no data\nconst genders=(personnelData||[]).reduce((acc,p)=>{const g=(p.gender||'').trim();if(!g)return acc;acc[g]=(acc[g]||0)+1;return acc;},{});return Object.entries(genders).map(_ref14=>{let[label,value]=_ref14;return{label,value};});}return[];},[chartData,stats,personnelData,selectedAffiliation]);// Add selectedAffiliation dependency\n// Helper function to get chart title\nconst getChartTitle=chartType=>{switch(chartType){case\"position\":return\"ตำแหน่ง\";case\"affiliation\":return\"สัดส่วนแต่ละสังกัด\";case\"department\":return selectedAffiliation?\"\\u0E2B\\u0E19\\u0E48\\u0E27\\u0E22\\u0E07\\u0E32\\u0E19\\u0E43\\u0E19\".concat(selectedAffiliation):\"หน่วยงาน (เลือกสังกัดก่อน)\";case\"gender\":return\"เพศ\";case\"age\":return\"ช่วงอายุ\";default:return\"ข้อมูลบุคลากร\";}};const renderChart=()=>{switch(selectedChart){case\"position\":return/*#__PURE__*/_jsx(HorizontalBarChart,{data:getChartData('position'),colors:chartColors,title:\"\\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07\",maxHeight:\"800px\"});case\"affiliation\":return/*#__PURE__*/_jsx(HorizontalBarChart,{data:getChartData('affiliation'),colors:chartColors,title:\"\\u0E2A\\u0E31\\u0E14\\u0E2A\\u0E48\\u0E27\\u0E19\\u0E41\\u0E15\\u0E48\\u0E25\\u0E30\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\",maxHeight:\"800px\"});case\"department\":return/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:!selectedAffiliation?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(Building2,{className:\"w-16 h-16 text-slate-300 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-slate-600 mb-2\",children:\"\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\\u0E01\\u0E48\\u0E2D\\u0E19\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-slate-500 mb-4\",children:\"\\u0E01\\u0E23\\u0E38\\u0E13\\u0E32\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\\u0E40\\u0E1E\\u0E37\\u0E48\\u0E2D\\u0E14\\u0E39\\u0E2B\\u0E19\\u0E48\\u0E27\\u0E22\\u0E07\\u0E32\\u0E19\\u0E43\\u0E19\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\\u0E19\\u0E31\\u0E49\\u0E19\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedAffiliation,onChange:e=>setSelectedAffiliation(e.target.value),className:\"p-2 border border-slate-300 rounded-lg\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\"}),Array.from(new Set(personnelData.map(p=>p.affiliation||'ไม่ระบุ'))).sort().map(aff=>/*#__PURE__*/_jsx(\"option\",{value:aff,children:aff},aff))]})]}):/*#__PURE__*/_jsx(HorizontalBarChart,{data:getChartData('department'),colors:chartColors,title:\"\\u0E2B\\u0E19\\u0E48\\u0E27\\u0E22\\u0E07\\u0E32\\u0E19\\u0E43\\u0E19\".concat(selectedAffiliation),maxHeight:\"320px\"})});case\"gender\":return/*#__PURE__*/_jsx(PieChartComponent,{data:getChartData('gender'),colors:chartColors,title:\"\\u0E40\\u0E1E\\u0E28\"});case\"age\":return/*#__PURE__*/_jsx(HorizontalBarChart,{data:getChartData('age'),colors:chartColors,title:\"\\u0E0A\\u0E48\\u0E27\\u0E07\\u0E2D\\u0E32\\u0E22\\u0E38\",maxHeight:\"240px\"});default:return/*#__PURE__*/_jsx(\"p\",{children:\"\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E41\\u0E2A\\u0E14\\u0E07\\u0E1C\\u0E25\"});}};return/*#__PURE__*/_jsxs(\"div\",{className:\"w-full min-h-full p-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-xl sm:text-2xl font-bold text-slate-800\",children:\"\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E1A\\u0E38\\u0E04\\u0E25\\u0E32\\u0E01\\u0E23\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowSearchModal(true),className:\"flex items-center space-x-2 px-3 sm:px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow text-sm transition-colors\",children:[/*#__PURE__*/_jsx(Search,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0E04\\u0E49\\u0E19\\u0E2B\\u0E32\\u0E1A\\u0E38\\u0E04\\u0E25\\u0E32\\u0E01\\u0E23\"})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8\",children:[/*#__PURE__*/_jsx(EditableCard,{title:\"\\u0E01\\u0E23\\u0E2D\\u0E1A\\u0E2D\\u0E31\\u0E15\\u0E23\\u0E32\",value:quota,icon:Briefcase,color:\"blue\",isEditing:isEditingQuota,onEdit:async()=>{if(isEditingQuota){// บันทึกข้อมูลเมื่อเสร็จสิ้นการแก้ไข\nawait updateGeneralStat('quota',quota);logAdminActivity('update_quota',\"Updated quota to \".concat(quota));}setIsEditingQuota(!isEditingQuota);},onChange:value=>setQuota(value),isAdmin:(user===null||user===void 0?void 0:user.role)==='admin'}),/*#__PURE__*/_jsx(EditableCard,{title:\"\\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07\\u0E27\\u0E48\\u0E32\\u0E07\",value:vacancy,icon:UserX,color:\"red\",isEditing:isEditingVacancy,onEdit:async()=>{if(isEditingVacancy){// บันทึกข้อมูลเมื่อเสร็จสิ้นการแก้ไข\nawait updateGeneralStat('vacancy',vacancy);logAdminActivity('update_vacancy',\"Updated vacancy to \".concat(vacancy));}setIsEditingVacancy(!isEditingVacancy);},onChange:value=>setVacancy(value),isAdmin:(user===null||user===void 0?void 0:user.role)==='admin'}),/*#__PURE__*/_jsx(StatCard,{title:\"\\u0E1A\\u0E38\\u0E04\\u0E25\\u0E32\\u0E01\\u0E23\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\",value:stats.total,icon:Users,color:\"green\",subtitle:\"\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\\u0E43\\u0E19\\u0E23\\u0E30\\u0E1A\\u0E1A\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap items-center gap-2 sm:gap-4 mb-4 sm:mb-6\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedChart(\"position\"),className:\"px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors \".concat(selectedChart===\"position\"?\"bg-indigo-600 text-white\":\"bg-gray-200 text-gray-800 hover:bg-gray-300\"),children:\"\\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedChart(\"affiliation\"),className:\"px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors \".concat(selectedChart===\"affiliation\"?\"bg-indigo-600 text-white\":\"bg-gray-200 text-gray-800 hover:bg-gray-300\"),children:\"\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setSelectedChart(\"department\");if(!selectedAffiliation){// Auto-select first affiliation if none selected\nconst affiliations=Array.from(new Set(personnelData.map(p=>p.affiliation||'ไม่ระบุ'))).sort();if(affiliations.length>0){setSelectedAffiliation(affiliations[0]);}}},className:\"px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors \".concat(selectedChart===\"department\"?\"bg-indigo-600 text-white\":\"bg-gray-200 text-gray-800 hover:bg-gray-300\"),children:\"\\u0E2B\\u0E19\\u0E48\\u0E27\\u0E22\\u0E07\\u0E32\\u0E19\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedChart(\"gender\"),className:\"px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors \".concat(selectedChart===\"gender\"?\"bg-indigo-600 text-white\":\"bg-gray-200 text-gray-800 hover:bg-gray-300\"),children:\"\\u0E40\\u0E1E\\u0E28\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedChart(\"age\"),className:\"px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors \".concat(selectedChart===\"age\"?\"bg-indigo-600 text-white\":\"bg-gray-200 text-gray-800 hover:bg-gray-300\"),children:\"\\u0E0A\\u0E48\\u0E27\\u0E07\\u0E2D\\u0E32\\u0E22\\u0E38\"}),selectedChart===\"department\"&&/*#__PURE__*/_jsxs(\"select\",{value:selectedAffiliation,onChange:e=>setSelectedAffiliation(e.target.value),className:\"ml-2 p-2 border border-slate-300 rounded-lg text-sm bg-white\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\"}),Array.from(new Set(personnelData.map(p=>p.affiliation||'ไม่ระบุ'))).sort().map(aff=>/*#__PURE__*/_jsx(\"option\",{value:aff,children:aff},aff))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 min-h-[600px]\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-base sm:text-lg font-semibold text-slate-800 mb-4\",children:\"\\u0E01\\u0E23\\u0E32\\u0E1F\\u0E41\\u0E17\\u0E48\\u0E07\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-[520px]\",children:renderChart()})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 min-h-[600px]\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-base sm:text-lg font-semibold text-slate-800 mb-4\",children:\"\\u0E01\\u0E23\\u0E32\\u0E1F\\u0E27\\u0E07\\u0E01\\u0E25\\u0E21\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-[520px]\",children:/*#__PURE__*/_jsx(PieChartComponent,{data:getChartData(selectedChart),colors:chartColors,title:getChartTitle(selectedChart)})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 h-[600px]\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-base sm:text-lg font-semibold text-slate-800 mb-4\",children:\"\\u0E2A\\u0E23\\u0E38\\u0E1B\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\"}),/*#__PURE__*/_jsx(SummaryCards,{data:getChartData(selectedChart),colors:chartColors,title:getChartTitle(selectedChart)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 min-h-[600px]\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-base sm:text-lg font-semibold text-slate-800 mb-4\",children:\"\\u0E01\\u0E23\\u0E32\\u0E1F\\u0E40\\u0E2A\\u0E49\\u0E19\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-[520px]\",children:/*#__PURE__*/_jsx(LineChart,{data:getChartData(selectedChart),colors:chartColors,title:getChartTitle(selectedChart)})})]})]}),/*#__PURE__*/_jsx(PersonnelDetailModal,{person:selectedPerson,isOpen:showDetail,onClose:()=>setShowDetail(false)}),/*#__PURE__*/_jsx(SearchModal,{isOpen:showSearchModal,onClose:()=>setShowSearchModal(false),personnelData:personnelData,stats:stats,onViewPerson:handleViewPerson,onExport:exportToCSV,user:user})]});}","map":{"version":3,"names":["React","useEffect","useState","useMemo","useCallback","memo","Search","Filter","Users","Phone","Mail","Calendar","Award","Building2","UserCheck","UserX","TrendingUp","PieChart","BarChart3","Download","RefreshCw","Eye","Grid3X3","List","X","AlertCircle","CheckCircle2","Clock","Briefcase","GraduationCap","Edit2","Save","MapPin","Building","Crown","FileText","CONFIG","DonutChart","LineChart","jsx","_jsx","jsxs","_jsxs","StatCard","_ref","title","value","icon","Icon","color","trend","subtitle","className","children","concat","TableChart","_ref2","data","colors","total","reduce","sum","d","slice","map","item","index","percentage","toFixed","length","style","backgroundColor","label","truncatePosition","position","removePatterns","result","pattern","replace","RegExp","trim","truncateAffiliation","affiliation","lower","toLowerCase","includes","TreemapChart","_ref3","originalTotal","scaledData","_objectSpread","scaledValue","Math","log1p","generateTreemapLayout","items","width","height","rects","layoutRow","rowItems","x","y","w","h","totalValue","i","offset","isHorizontal","rectWidth","push","rectHeight","squarify","halfValue","runningTotal","splitIndex","max","groupA","groupB","groupATotal","groupAWidth","groupAHeight","layout","rect","itemIndex","findIndex","valueText","fontSize","min","textShadowStyle","textShadow","left","top","transition","PieChartComponent","_ref4","viewBox","angle","prevPercentage","startAngle","endAngle","radius","startX","cos","PI","startY","sin","endX","endY","largeArcFlag","pathData","join","pieColors","midAngle","labelRadius","labelX","labelY","percentageText","fill","stroke","strokeWidth","textAnchor","dominantBaseline","fontWeight","paintOrder","HorizontalBarChart","_ref5","maxHeight","getSortOrder","regionMatch","match","parseInt","customOrder","sortedData","sort","a","b","maxValue","barWidth","minWidth","SummaryCards","_ref6","_sortedData$","_sortedData$2","EditableCard","_ref7","isEditing","onEdit","onChange","isAdmin","localValue","setLocalValue","handleChange","e","newValue","target","onClick","type","PersonnelDetailModal","_ref8","person","isOpen","onClose","calculateAge","dob","birthDate","Date","today","age","getFullYear","monthDiff","getMonth","getDate","error","firstname","prefix","lastname","phone","email","deph","window","open","PersonCard","_ref9","onView","onCall","onMail","SearchModal","_ref0","personnelData","stats","onViewPerson","onExport","user","query","setQuery","filterAff","setFilterAff","filterDept","setFilterDept","filterPos","setFilterPos","affiliations","setAff","Set","forEach","p","add","Array","from","departments","relevantPersonnel","filter","setDept","positions","s","results","hay","handleCall","tel","handleMail","clearFilters","placeholder","disabled","PersonnelPage","_ref1","loading","setLoading","refreshing","setRefreshing","setError","setPersonnelData","selectedPerson","setSelectedPerson","showDetail","setShowDetail","showSearchModal","setShowSearchModal","quota","setQuota","vacancy","setVacancy","isEditingQuota","setIsEditingQuota","isEditingVacancy","setIsEditingVacancy","generalStatsData","setGeneralStatsData","selectedChart","setSelectedChart","selectedAffiliation","setSelectedAffiliation","filters","setFilters","department","ageRange","gender","logAdminActivity","action","details","fetch","ADMIN_API","method","headers","body","JSON","stringify","log_action","log_details","user_id","id","username","catch","console","fetchGeneralStats","response","GENERAL_STATS_API","ok","Error","status","json","success","isArray","statsMap","name","updateGeneralStat","createResponse","description","prev","alert","fetchPersonnelData","apiUrl","OFFICERS_API","text","parse","formattedData","generation","lineUserId","role","message","handleRefresh","Promise","all","finally","handleViewPerson","exportToCSV","affiliationAbbreviations","filteredAffiliationData","acc","normalized","matchRegion","trailingNum","anyNum","chartData","entries","Object","_ref10","getOrderKey","l","String","m","num","test","charCodeAt","ka","kb","localeCompare","newStats","connected","byPosition","byAffiliation","byDepartment","byGeneration","chartColors","getChartData","_ref11","groups","filteredData","dept","_ref12","now","year","isNaN","_ref13","genders","g","_ref14","getChartTitle","chartType","renderChart","aff"],"sources":["C:/Users/LENOVO/Documents/GitHub/court-marshal-connect/src/pages/PersonnelPage.js"],"sourcesContent":["import React, { useEffect, useState, useMemo, useCallback, memo } from \"react\";\r\nimport { \r\n  Search, \r\n  Filter, \r\n  Users, \r\n  Phone, \r\n  Mail, \r\n  Calendar,\r\n  Award,\r\n  Building2,\r\n  UserCheck,\r\n  UserX,\r\n  TrendingUp,\r\n  PieChart,\r\n  BarChart3,\r\n  Download,\r\n  RefreshCw,\r\n  Eye,\r\n  Grid3X3,\r\n  List,\r\n  X,\r\n  AlertCircle,\r\n  CheckCircle2,\r\n  Clock,\r\n  Briefcase,\r\n  GraduationCap,\r\n  Edit2,\r\n  Save,\r\n  MapPin,\r\n  Building,\r\n  Crown,\r\n  FileText\r\n} from \"lucide-react\";\r\nimport { CONFIG } from '../config';\r\nimport DonutChart from '../components/DonutChart';\r\nimport LineChart from '../components/LineChart';\r\n\r\n// StatCard Component\r\nconst StatCard = memo(({ title, value, icon: Icon, color = \"blue\", trend, subtitle }) => (\r\n  <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\r\n    <div className=\"flex items-center justify-between mb-2\">\r\n      <div className={`w-12 h-12 bg-${color}-100 rounded-xl flex items-center justify-center`}>\r\n        <Icon className={`w-6 h-6 text-${color}-600`} />\r\n      </div>\r\n      {trend && (\r\n        <div className=\"flex items-center text-green-600 text-sm\">\r\n          <TrendingUp className=\"w-4 h-4 mr-1\" />\r\n          <span>{trend}%</span>\r\n        </div>\r\n      )}\r\n    </div>\r\n    <div className=\"text-3xl font-bold text-slate-900 mb-1\">{value}</div>\r\n    <div className=\"text-sm text-slate-600\">{title}</div>\r\n    {subtitle && (\r\n      <div className=\"text-xs text-slate-500 mt-1\">{subtitle}</div>\r\n    )}\r\n  </div>\r\n));\r\n\r\n// Table Chart Component (สำหรับแสดงข้อมูลตำแหน่งแบบตาราง)\r\nconst TableChart = memo(({ title, data, colors = [] }) => {\r\n  const total = useMemo(() => data.reduce((sum, d) => sum + d.value, 0), [data]);\r\n  \r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\r\n      <h3 className=\"text-lg font-semibold text-slate-900 mb-4 flex items-center\">\r\n        <BarChart3 className=\"w-5 h-5 mr-2 text-slate-400\" />\r\n        {title}\r\n      </h3>\r\n      <div className=\"space-y-3\">\r\n        <div className=\"text-center mb-4\">\r\n          <div className=\"text-2xl font-bold text-slate-900\">{total}</div>\r\n          <div className=\"text-sm text-slate-500\">ทั้งหมด</div>\r\n        </div>\r\n        \r\n        <div className=\"grid gap-2\">\r\n          {data.slice(0, 8).map((item, index) => {\r\n            const percentage = ((item.value / total) * 100).toFixed(1);\r\n            const color = colors[index % colors.length] || '#6366f1';\r\n            \r\n            return (\r\n              <div key={`${item.label}-${index}`} className=\"flex items-center justify-between p-3 bg-slate-50 rounded-lg\">\r\n                <div className=\"flex items-center space-x-3 flex-1 min-w-0\">\r\n                  <div \r\n                    className=\"w-4 h-4 rounded-sm flex-shrink-0\"\r\n                    style={{ backgroundColor: color }}\r\n                  />\r\n                  <span className=\"text-sm text-slate-700 font-medium truncate\" title={item.label}>\r\n                    {item.label}\r\n                  </span>\r\n                </div>\r\n                <div className=\"flex items-center space-x-2 text-right\">\r\n                  <div className=\"text-sm font-bold text-slate-900\">{item.value}</div>\r\n                  <div className=\"text-xs text-slate-500\">{percentage}%</div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// Function สำหรับตัดคำยาว\r\nconst truncatePosition = (position) => {\r\n  if (!position) return '';\r\n  \r\n  const removePatterns = [\r\n    'เจ้าพนักงานตำรวจศาล',\r\n    'ตำรวจศาล',\r\n    'ตำรวจ',\r\n    'พนักงาน'\r\n  ];\r\n  \r\n  let result = position;\r\n  for (const pattern of removePatterns) {\r\n    result = result.replace(new RegExp(pattern, 'gi'), '');\r\n  }\r\n  \r\n  return result.trim() || position;\r\n};\r\n\r\n// Function สำหรับตัดคำ \"ศาล\" ออกจากสังกัด\r\nconst truncateAffiliation = (affiliation) => {\r\n  if (!affiliation) return '';\r\n  const lower = affiliation.toLowerCase();\r\n\r\n  // Only remove the leading word 'ศาล' for affiliations that describe\r\n  // 'ในสังกัดสำนักยุติธรรมประจำภาค' (or variants). Do not strip 'ศาล'\r\n  // from other court names like 'ศาลสูง' or 'ศาลชำนาญพิเศษ'.\r\n  if (lower.includes('ในสังกัดสำนักยุติธรรมประจำภาค') || lower.includes('ในสังกัดสำนักยุติธรรม')) {\r\n    return affiliation.replace(/^ศาล\\s*/i, '').trim() || affiliation;\r\n  }\r\n\r\n  // Otherwise return affiliation unchanged\r\n  return affiliation;\r\n};\r\n\r\n// --- NEW: Proportional Treemap Chart Component ---\r\n// --- NEW: Proportional Treemap Chart Component (MODIFIED FOR LOGARITHMIC SCALE) ---\r\nconst TreemapChart = memo(({ title, data, colors = [] }) => {\r\n  // --- ส่วนที่แก้ไข: คำนวณ total จากค่าจริงก่อนแปลงสเกล ---\r\n  const originalTotal = useMemo(() => data.reduce((sum, d) => sum + d.value, 0), [data]);\r\n\r\n  // --- ส่วนที่แก้ไข: สร้างข้อมูลชุดใหม่ที่มีการปรับสเกลด้วย Math.log1p ---\r\n  // Math.log1p(x) จะคำนวณ log(1+x) ช่วยให้ค่าที่น้อยๆ มีขนาดใหญ่ขึ้นเมื่อเทียบกับค่ามากๆ\r\n  const scaledData = useMemo(() => data.map(item => ({\r\n    ...item,\r\n    scaledValue: Math.log1p(item.value) \r\n  })), [data]);\r\n\r\n  const generateTreemapLayout = useCallback((items, width, height) => {\r\n    let rects = [];\r\n    const layoutRow = (rowItems, x, y, w, h) => {\r\n      if (!rowItems.length) return;\r\n      // --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\r\n      const totalValue = rowItems.reduce((sum, i) => sum + i.scaledValue, 0);\r\n      if (totalValue === 0) return;\r\n      let offset = 0;\r\n      const isHorizontal = w > h;\r\n      for (const item of rowItems) {\r\n        // --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\r\n        const percentage = item.scaledValue / totalValue;\r\n        if (isHorizontal) {\r\n          const rectWidth = w * percentage;\r\n          rects.push({ x: x + offset, y, width: rectWidth, height: h, item });\r\n          offset += rectWidth;\r\n        } else {\r\n          const rectHeight = h * percentage;\r\n          rects.push({ x, y: y + offset, width: w, height: rectHeight, item });\r\n          offset += rectHeight;\r\n        }\r\n      }\r\n    };\r\n    const squarify = (items, x, y, w, h) => {\r\n      if (!items.length) return;\r\n      if (items.length <= 4) {\r\n        layoutRow(items, x, y, w, h);\r\n        return;\r\n      }\r\n      // --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\r\n      const halfValue = items.reduce((sum, i) => sum + i.scaledValue, 0) / 2;\r\n      let runningTotal = 0;\r\n      let splitIndex = 0;\r\n      for (let i = 0; i < items.length; i++) {\r\n        // --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\r\n        runningTotal += items[i].scaledValue;\r\n        if (runningTotal >= halfValue) {\r\n          splitIndex = i + 1;\r\n          break;\r\n        }\r\n      }\r\n      splitIndex = Math.max(1, splitIndex);\r\n      const groupA = items.slice(0, splitIndex);\r\n      const groupB = items.slice(splitIndex);\r\n      const groupATotal = groupA.reduce((sum, i) => sum + i.scaledValue, 0);\r\n      const totalValue = groupATotal + (groupB.reduce((sum, i) => sum + i.scaledValue, 0));\r\n\r\n      if (totalValue === 0) return;\r\n      if (w > h) {\r\n        const groupAWidth = w * (groupATotal / totalValue);\r\n        squarify(groupA, x, y, groupAWidth, h);\r\n        squarify(groupB, x + groupAWidth, y, w - groupAWidth, h);\r\n      } else {\r\n        const groupAHeight = h * (groupATotal / totalValue);\r\n        squarify(groupA, x, y, w, groupAHeight);\r\n        squarify(groupB, x, y + groupAHeight, w, h - groupAHeight);\r\n      }\r\n    };\r\n    squarify(items, 0, 0, 1000, 1000); // Use a relative base for layout\r\n    return rects;\r\n  }, []);\r\n\r\n  // --- ส่วนที่แก้ไข: ส่ง scaledData เข้าไปคำนวณ layout ---\r\n  const layout = useMemo(() => generateTreemapLayout(scaledData), [scaledData, generateTreemapLayout]);\r\n\r\n  if (!data.length || originalTotal === 0) {\r\n    return (\r\n      <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 h-full\">\r\n        <h3 className=\"text-lg font-semibold text-slate-900 mb-4 flex items-center\"><BarChart3 className=\"w-5 h-5 mr-2 text-slate-400\" />{title}</h3>\r\n        <div className=\"text-center py-8\"><p className=\"text-slate-500\">ไม่มีข้อมูลสำหรับแสดงกราฟ</p></div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 flex flex-col h-full\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h3 className=\"text-lg font-semibold text-slate-900 flex items-center\">\r\n          <BarChart3 className=\"w-5 h-5 mr-2 text-slate-400\" />{title}\r\n        </h3>\r\n        <div className=\"text-right\">\r\n          {/* --- ส่วนที่แก้ไข: แสดงผลรวมจากค่าจริง --- */}\r\n          <div className=\"text-lg font-bold text-slate-900\">{originalTotal}</div>\r\n          <div className=\"text-xs text-slate-500\">ทั้งหมด</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"relative w-full flex-1\">\r\n        {layout.map((rect) => {\r\n          const itemIndex = scaledData.findIndex(d => d.label === rect.item.label);\r\n          const color = colors[itemIndex % colors.length];\r\n          \r\n          // --- ส่วนที่แก้ไข: คำนวณ % จากค่าจริง ---\r\n          const percentage = originalTotal > 0 ? ((rect.item.value / originalTotal) * 100).toFixed(1) : 0;\r\n          const valueText = `${rect.item.value} (${percentage}%)`;\r\n          const fontSize = Math.min(rect.width / 10, rect.height / 5, 16);\r\n          const textShadowStyle = { textShadow: '0px 1px 3px rgba(0, 0, 0, 0.6)' };\r\n\r\n          return (\r\n            <div\r\n              key={rect.item.label}\r\n              className=\"absolute border-2 border-white rounded-md flex flex-col items-center justify-center p-1 overflow-hidden text-center\"\r\n              style={{\r\n                left: `${rect.x / 10}%`, top: `${rect.y / 10}%`, width: `${rect.width / 10}%`, height: `${rect.height / 10}%`,\r\n                backgroundColor: color, transition: 'all 0.4s ease-in-out'\r\n              }}\r\n            >\r\n              <div className=\"text-white font-bold\" style={{ fontSize: `${fontSize}px`, ...textShadowStyle }}>\r\n                {valueText}\r\n              </div>\r\n              <div className=\"text-white opacity-90 leading-tight\" style={{ fontSize: `${Math.max(fontSize * 0.7, 10)}px`, ...textShadowStyle }}>\r\n                {rect.item.label}\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// Pie Chart Component - ปรับปรุงให้สวยงาม\r\nconst PieChartComponent = memo(({ title, data, colors = [] }) => {\r\n  const total = useMemo(() => data.reduce((sum, d) => sum + d.value, 0), [data]);\r\n  \r\n  if (!data.length || total === 0) {\r\n    return (\r\n      <div className=\"h-full flex items-center justify-center\">\r\n        <div className=\"text-center py-8\">\r\n          <p className=\"text-slate-500\">ไม่มีข้อมูลสำหรับแสดงกราฟ</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <div className=\"h-full flex flex-col\">\r\n      <div className=\"flex items-center justify-center mb-6\">\r\n        <div className=\"text-xl font-bold text-slate-900\">จำนวน {total} คน</div>\r\n      </div>\r\n      \r\n      <div className=\"flex-1 flex flex-col items-center justify-center\">\r\n        {/* Pie Chart - ขยายขนาดให้ใหญ่ขึ้น */}\r\n        <div className=\"relative w-80 h-80 mb-8\">\r\n          <svg width=\"320\" height=\"320\" viewBox=\"0 0 320 320\" className=\"w-full h-full\">\r\n            {data.map((item, index) => {\r\n              const percentage = item.value / total;\r\n              const angle = percentage * 360;\r\n              \r\n              const prevPercentage = data.slice(0, index).reduce((sum, d) => sum + d.value, 0) / total;\r\n              const startAngle = prevPercentage * 360 - 90;\r\n              const endAngle = startAngle + angle;\r\n              \r\n              // Pie chart - เป็นวงกลมเต็ม ไม่ใช่โดนัท\r\n              const radius = 140;\r\n              \r\n              const startX = 160 + radius * Math.cos((startAngle * Math.PI) / 180);\r\n              const startY = 160 + radius * Math.sin((startAngle * Math.PI) / 180);\r\n              const endX = 160 + radius * Math.cos((endAngle * Math.PI) / 180);\r\n              const endY = 160 + radius * Math.sin((endAngle * Math.PI) / 180);\r\n              \r\n              const largeArcFlag = angle > 180 ? 1 : 0;\r\n              \r\n              const pathData = [\r\n                'M', 160, 160, // เริ่มที่จุดกึ่งกลาง\r\n                'L', startX, startY,\r\n                'A', radius, radius, 0, largeArcFlag, 1, endX, endY,\r\n                'Z'\r\n              ].join(' ');\r\n              \r\n              const pieColors = [\r\n                '#8b5cf6', '#ec4899', '#06b6d4', '#10b981', '#f59e0b', \r\n                '#ef4444', '#84cc16', '#6366f1', '#f97316', '#14b8a6'\r\n              ];\r\n              const color = pieColors[index % pieColors.length];\r\n              \r\n              // คำนวณตำแหน่งสำหรับแสดง percentage\r\n              const midAngle = startAngle + (angle / 2);\r\n              const labelRadius = 120;\r\n              const labelX = 160 + labelRadius * Math.cos((midAngle * Math.PI) / 180);\r\n              const labelY = 160 + labelRadius * Math.sin((midAngle * Math.PI) / 180);\r\n              const percentageText = `${(percentage * 100).toFixed(1)}%`;\r\n              \r\n              return (\r\n                <g key={`pie-${index}`}>\r\n                  <path\r\n                    d={pathData}\r\n                    fill={color}\r\n                    stroke=\"white\"\r\n                    strokeWidth=\"3\"\r\n                    className=\"hover:opacity-80 transition-opacity duration-200\"\r\n                  />\r\n                  {/* แสดง percentage */}\r\n                  {percentage > 0.05 && (\r\n                    <text\r\n                      x={labelX}\r\n                      y={labelY}\r\n                      textAnchor=\"middle\"\r\n                      dominantBaseline=\"middle\"\r\n                      fill=\"white\"\r\n                      fontSize=\"14\"\r\n                      fontWeight=\"bold\"\r\n                      stroke=\"#1e293b\"\r\n                      strokeWidth=\"1\"\r\n                      paintOrder=\"stroke\"\r\n                    >\r\n                      {percentageText}\r\n                    </text>\r\n                  )}\r\n                </g>\r\n              );\r\n            })}\r\n          </svg>\r\n        </div>\r\n        \r\n        {/* Legend */}\r\n        <div className=\"w-full\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2\">\r\n            {data.map((item, index) => {\r\n              const percentage = ((item.value / total) * 100).toFixed(0);\r\n              const pieColors = [\r\n                '#8b5cf6', '#ec4899', '#06b6d4', '#10b981', '#f59e0b', \r\n                '#ef4444', '#84cc16', '#6366f1', '#f97316', '#14b8a6'\r\n              ];\r\n              const color = pieColors[index % pieColors.length];\r\n              \r\n              return (\r\n                <div key={`legend-${item.label}-${index}`} className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center space-x-2 min-w-0 flex-1\">\r\n                    <div \r\n                      className=\"w-4 h-4 rounded-full flex-shrink-0\"\r\n                      style={{ backgroundColor: color }}\r\n                    />\r\n                    <span className=\"text-sm text-slate-700\">\r\n                      {truncateAffiliation(item.label)} <span className=\"font-bold text-slate-900\">{item.value}</span> คน\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"text-sm font-bold text-slate-900 ml-2\">{percentage}%</div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// Horizontal Bar Chart Component\r\nconst HorizontalBarChart = memo(({ title, data, colors = [], maxHeight = '320px' }) => {\r\n  \r\n  const getSortOrder = (label) => {\r\n    const regionMatch = label.match(/ภาค\\s*(\\d+)/);\r\n    if (regionMatch) return parseInt(regionMatch[1]);\r\n    const customOrder = ['ศาลชั้นต้นในเขตกรุงเทพมหานคร', 'ศูนย์รักษาความปลอดภัย', 'ศาลชำนาญพิเศษ', 'ศาลสูง'];\r\n    const index = customOrder.findIndex(item => label.includes(item));\r\n    if (index !== -1) return 100 + index;\r\n    return 999;\r\n  };\r\n\r\n  const sortedData = useMemo(() => \r\n    [...data].sort((a, b) => getSortOrder(a.label) - getSortOrder(b.label)), \r\n    [data]\r\n  );\r\n  \r\n  const maxValue = useMemo(() => {\r\n    if (!sortedData || sortedData.length === 0) return 0;\r\n    return Math.max(...sortedData.map(d => d.value));\r\n  }, [sortedData]);\r\n\r\n  if (!sortedData.length || maxValue === 0) {\r\n    return (\r\n      <div className=\"h-full flex items-center justify-center\">\r\n        <div className=\"text-center py-8\">\r\n          <p className=\"text-slate-500\">ไม่มีข้อมูลสำหรับแสดงกราฟ</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"h-full\">\r\n      <div className=\"space-y-2 h-full overflow-y-auto\">\r\n        {sortedData.map((item, index) => {\r\n          const barWidth = (item.value / maxValue) * 100;\r\n          const color = colors[index % colors.length] || '#8b5cf6';\r\n          \r\n          return (\r\n            <div key={`${item.label}-${index}`} className=\"grid grid-cols-3 gap-2 items-center\">\r\n              {/* Left Column for Full Label (CHANGED to text-left) */}\r\n              <div className=\"col-span-1 text-sm text-slate-700 font-medium text-left truncate\" title={item.label}>\r\n                {item.label}\r\n              </div>\r\n              \r\n              {/* Right Column for Bar */}\r\n              <div className=\"col-span-2 w-full bg-slate-100 rounded-full h-7 relative\">\r\n                <div\r\n                  className=\"h-7 rounded-full transition-all duration-700 flex items-center justify-end pr-3\"\r\n                  style={{\r\n                    width: `${barWidth}%`, backgroundColor: color, minWidth: '36px'\r\n                  }}\r\n                >\r\n                   <span className=\"text-white text-sm font-bold\">{item.value}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// SummaryCards Component - แทนที่กราฟโดนัท\r\nconst SummaryCards = memo(({ data, colors = [] }) => {\r\n  const total = useMemo(() => data.reduce((sum, d) => sum + d.value, 0), [data]);\r\n  const sortedData = useMemo(() => \r\n    [...data].sort((a, b) => b.value - a.value), [data]\r\n  );\r\n\r\n  if (!data.length || total === 0) {\r\n    return (\r\n      <div className=\"h-full flex items-center justify-center\">\r\n        <div className=\"text-center py-8\">\r\n          <p className=\"text-slate-500\">ไม่มีข้อมูลสำหรับแสดงผล</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"h-full overflow-y-auto\">\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6\">\r\n        {/* สรุปรวม */}\r\n        <div className=\"bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-xl\">\r\n          <div className=\"text-2xl font-bold\">{total}</div>\r\n          <div className=\"text-sm opacity-90\">รวมทั้งหมด</div>\r\n        </div>\r\n        \r\n        {/* ข้อมูลสูงสุด */}\r\n        <div className=\"bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl\">\r\n          <div className=\"text-2xl font-bold\">{sortedData[0]?.value || 0}</div>\r\n          <div className=\"text-sm opacity-90\">สูงสุด: {sortedData[0]?.label || 'ไม่มีข้อมูล'}</div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* รายการข้อมูลแบบการ์ด */}\r\n      <div className=\"space-y-3\">\r\n        {sortedData.map((item, index) => {\r\n          const percentage = ((item.value / total) * 100).toFixed(1);\r\n          const color = colors[index % colors.length] || '#8b5cf6';\r\n          \r\n          return (\r\n            <div \r\n              key={`${item.label}-${index}`} \r\n              className=\"bg-gradient-to-r from-slate-50 to-slate-100 border border-slate-200 rounded-lg p-4 hover:shadow-md transition-all duration-200\"\r\n            >\r\n              <div className=\"flex items-center justify-between mb-2\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div \r\n                    className=\"w-4 h-4 rounded-full\" \r\n                    style={{ backgroundColor: color }}\r\n                  />\r\n                  <span className=\"font-medium text-slate-800\">{item.label}</span>\r\n                </div>\r\n                <div className=\"text-right\">\r\n                  <div className=\"text-lg font-bold text-slate-900\">{item.value}</div>\r\n                  <div className=\"text-xs text-slate-500\">{percentage}%</div>\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Progress bar */}\r\n              <div className=\"w-full bg-slate-200 rounded-full h-2\">\r\n                <div \r\n                  className=\"h-2 rounded-full transition-all duration-700\" \r\n                  style={{ \r\n                    width: `${percentage}%`, \r\n                    backgroundColor: color \r\n                  }}\r\n                />\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// (moved into the PersonnelPage component to avoid calling hooks at top level)\r\n\r\n// EditableCard Component (restored minimal implementation)\r\nconst EditableCard = memo(({ title, value, icon: Icon, color = \"blue\", isEditing, onEdit, onChange, isAdmin }) => {\r\n  const [localValue, setLocalValue] = useState(value);\r\n\r\n  useEffect(() => {\r\n    setLocalValue(value);\r\n  }, [value]);\r\n\r\n  const handleChange = (e) => {\r\n    const newValue = parseInt(e.target.value) || 0;\r\n    setLocalValue(newValue);\r\n    onChange(newValue);\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\r\n      <div className=\"flex items-center justify-between mb-2\">\r\n        <div className={`w-12 h-12 bg-${color}-100 rounded-xl flex items-center justify-center`}>\r\n          {Icon && <Icon className={`w-6 h-6 text-${color}-600`} />}\r\n        </div>\r\n        {isAdmin && (\r\n          <button\r\n            onClick={onEdit}\r\n            className=\"text-slate-400 hover:text-slate-600 transition-colors\"\r\n          >\r\n            {isEditing ? <Save className=\"w-5 h-5\" /> : <Edit2 className=\"w-5 h-5\" />}\r\n          </button>\r\n        )}\r\n      </div>\r\n      {isEditing ? (\r\n        <input\r\n          type=\"number\"\r\n          value={localValue}\r\n          onChange={handleChange}\r\n          className=\"w-full text-3xl font-bold text-slate-900 mb-1 bg-slate-50 border border-slate-200 rounded px-2 py-1\"\r\n          min=\"0\"\r\n        />\r\n      ) : (\r\n        <div className=\"text-3xl font-bold text-slate-900 mb-1\">{localValue}</div>\r\n      )}\r\n      <div className=\"text-sm text-slate-600\">{title}</div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// PersonnelDetailModal (minimal)\r\nconst PersonnelDetailModal = memo(({ person, isOpen, onClose }) => {\r\n  if (!isOpen || !person) return null;\r\n\r\n  // Calculate age from birth date\r\n  const calculateAge = (dob) => {\r\n    if (!dob) return 'ไม่ระบุ';\r\n    try {\r\n      const birthDate = new Date(dob);\r\n      const today = new Date();\r\n      let age = today.getFullYear() - birthDate.getFullYear();\r\n      const monthDiff = today.getMonth() - birthDate.getMonth();\r\n      \r\n      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {\r\n        age--;\r\n      }\r\n      \r\n      return `${age} ปี`;\r\n    } catch (error) {\r\n      return 'ไม่ระบุ';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 overflow-y-auto bg-black/60 hide-scrollbar\">\r\n      <div className=\"flex min-h-screen items-start justify-center p-3 sm:p-6 md:p-10\">\r\n        <div className=\"relative bg-gradient-to-br from-white via-slate-50 to-indigo-50 rounded-2xl sm:rounded-3xl shadow-2xl max-w-3xl w-full p-4 sm:p-6\">\r\n          {/* Header with game-card style */}\r\n          <div className=\"flex items-start justify-between mb-6 pb-4 border-b border-slate-200\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"w-12 h-12 sm:w-16 sm:h-16 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-lg sm:text-xl font-bold shadow-lg\">\r\n                {(person.firstname || 'N')[0]}\r\n              </div>\r\n              <div>\r\n                <h2 className=\"text-lg sm:text-xl font-bold text-slate-900\">\r\n                  {person.prefix} {person.firstname} {person.lastname}\r\n                </h2>\r\n                <p className=\"text-sm text-slate-600\">{person.position || 'ไม่ระบุตำแหน่ง'}</p>\r\n              </div>\r\n            </div>\r\n            <button \r\n              onClick={onClose} \r\n              className=\"p-2 text-slate-400 hover:text-slate-600 hover:bg-white/80 rounded-lg transition-all duration-200\"\r\n            >\r\n              <X className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Content Cards */}\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6\">\r\n            {/* Contact Information Card */}\r\n            <div className=\"bg-gradient-to-br from-white to-blue-50 rounded-xl p-4 sm:p-5 shadow-lg border border-slate-200/50\">\r\n              <h3 className=\"text-base sm:text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2\">\r\n                <Phone className=\"w-5 h-5 text-blue-600\" />\r\n                ข้อมูลติดต่อ\r\n              </h3>\r\n              <div className=\"space-y-3\">\r\n                <div className=\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\">\r\n                  <Phone className=\"w-4 h-4 text-slate-500\" />\r\n                  <span className=\"text-sm text-slate-700\">{person.phone || 'ไม่ระบุ'}</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\">\r\n                  <Mail className=\"w-4 h-4 text-slate-500\" />\r\n                  <span className=\"text-sm text-slate-700\">{person.email || 'ไม่ระบุ'}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Work Information Card */}\r\n            <div className=\"bg-gradient-to-br from-white to-green-50 rounded-xl p-4 sm:p-5 shadow-lg border border-slate-200/50\">\r\n              <h3 className=\"text-base sm:text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2\">\r\n                <Building className=\"w-5 h-5 text-green-600\" />\r\n                ข้อมูลการทำงาน\r\n              </h3>\r\n              <div className=\"space-y-3\">\r\n                <div className=\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\">\r\n                  <Building2 className=\"w-4 h-4 text-slate-500\" />\r\n                  <div className=\"text-sm\">\r\n                    <div className=\"font-medium text-slate-700\">สังกัด</div>\r\n                    <div className=\"text-slate-600\">{person.affiliation || 'ไม่ระบุ'}</div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\">\r\n                  <Users className=\"w-4 h-4 text-slate-500\" />\r\n                  <div className=\"text-sm\">\r\n                    <div className=\"font-medium text-slate-700\">หน่วยงาน</div>\r\n                    <div className=\"text-slate-600\">{person.deph || 'ไม่ระบุ'}</div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\">\r\n                  <Crown className=\"w-4 h-4 text-slate-500\" />\r\n                  <div className=\"text-sm\">\r\n                    <div className=\"font-medium text-slate-700\">ตำแหน่ง</div>\r\n                    <div className=\"text-slate-600\">{person.position || 'ไม่ระบุ'}</div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Additional Information Card */}\r\n            <div className=\"lg:col-span-2 bg-gradient-to-br from-white to-purple-50 rounded-xl p-4 sm:p-5 shadow-lg border border-slate-200/50\">\r\n              <h3 className=\"text-base sm:text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2\">\r\n                <FileText className=\"w-5 h-5 text-purple-600\" />\r\n                ข้อมูลเพิ่มเติม\r\n              </h3>\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"text-sm font-medium text-slate-700\">อายุ</div>\r\n                  <div className=\"text-sm text-slate-600 p-2 bg-white/70 rounded-lg\">\r\n                    {calculateAge(person.dob)}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Action Buttons */}\r\n          <div className=\"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t border-slate-200\">\r\n            {person.phone && (\r\n              <button \r\n                onClick={() => window.open(`tel:${person.phone}`, '_self')} \r\n                className=\"flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5\"\r\n              >\r\n                <Phone className=\"w-4 h-4\" />\r\n                <span className=\"text-sm font-medium\">โทรหา</span>\r\n              </button>\r\n            )}\r\n            {person.email && (\r\n              <button \r\n                onClick={() => window.open(`mailto:${person.email}`, '_self')} \r\n                className=\"flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5\"\r\n              >\r\n                <Mail className=\"w-4 h-4\" />\r\n                <span className=\"text-sm font-medium\">ส่งอีเมล</span>\r\n              </button>\r\n            )}\r\n            <button \r\n              onClick={onClose} \r\n              className=\"flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-slate-500 to-slate-600 text-white rounded-lg hover:from-slate-600 hover:to-slate-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 sm:ml-auto\"\r\n            >\r\n              <span className=\"text-sm font-medium\">ปิด</span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// SearchModal (enhanced with department filtering and game-card style)\r\n// Small visual card for a person used in search results (game-card style)\r\nconst PersonCard = memo(({ person, onView, onCall, onMail }) => {\r\n  return (\r\n    <div className=\"bg-gradient-to-br from-white via-blue-50 to-indigo-100 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 p-4 sm:p-6 border border-indigo-200 hover:border-indigo-300 transform hover:scale-105\">\r\n      {/* Header with name and position */}\r\n      <div className=\"mb-4\">\r\n        <div className=\"text-sm sm:text-base font-bold text-slate-900 mb-1\">\r\n          {person.prefix} {person.firstname} {person.lastname}\r\n        </div>\r\n        <div className=\"text-xs sm:text-sm text-indigo-600 font-medium\">\r\n          {person.position || 'ไม่ระบุตำแหน่ง'}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Info section */}\r\n      <div className=\"space-y-2 mb-4\">\r\n        <div className=\"flex items-center gap-2 text-xs sm:text-sm text-slate-600\">\r\n          <Building2 className=\"w-4 h-4 text-indigo-500 flex-shrink-0\" />\r\n          <span className=\"truncate\">{person.affiliation || 'ไม่ระบุสังกัด'}</span>\r\n        </div>\r\n        <div className=\"flex items-center gap-2 text-xs sm:text-sm text-slate-600\">\r\n          <Briefcase className=\"w-4 h-4 text-purple-500 flex-shrink-0\" />\r\n          <span className=\"truncate\">{person.deph || 'ไม่ระบุหน่วยงาน'}</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Action buttons */}\r\n      <div className=\"space-y-2\">\r\n        <button \r\n          onClick={() => onView(person)} \r\n          className=\"w-full px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-xl text-sm font-medium flex items-center justify-center gap-2 transition-all duration-200 shadow-md hover:shadow-lg\"\r\n        >\r\n          <Eye className=\"w-4 h-4\" /> \r\n          ดูรายละเอียด\r\n        </button>\r\n        \r\n        {/* Contact buttons */}\r\n        <div className=\"flex items-center gap-2\">\r\n          {person.phone && (\r\n            <button \r\n              onClick={() => onCall(person.phone)} \r\n              className=\"flex-1 p-2 rounded-xl bg-green-100 hover:bg-green-200 text-green-600 transition-colors shadow-sm flex items-center justify-center gap-1\" \r\n              title=\"โทร\"\r\n            >\r\n              <Phone className=\"w-4 h-4\" />\r\n              <span className=\"text-xs\">โทร</span>\r\n            </button>\r\n          )}\r\n          {person.email && (\r\n            <button \r\n              onClick={() => onMail(person.email)} \r\n              className=\"flex-1 p-2 rounded-xl bg-blue-100 hover:bg-blue-200 text-blue-600 transition-colors shadow-sm flex items-center justify-center gap-1\" \r\n              title=\"อีเมล\"\r\n            >\r\n              <Mail className=\"w-4 h-4\" />\r\n              <span className=\"text-xs\">อีเมล</span>\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nconst SearchModal = memo(({ isOpen, onClose, personnelData = [], stats = {}, onViewPerson = () => {}, onExport = () => {}, user }) => {\r\n  const [query, setQuery] = useState('');\r\n  const [filterAff, setFilterAff] = useState('');\r\n  const [filterDept, setFilterDept] = useState('');\r\n  const [filterPos, setFilterPos] = useState('');\r\n\r\n  // Get unique affiliations\r\n  const affiliations = useMemo(() => {\r\n    const setAff = new Set();\r\n    personnelData.forEach(p => setAff.add(p.affiliation || 'ไม่ระบุ'));\r\n    return Array.from(setAff).sort();\r\n  }, [personnelData]);\r\n\r\n  // Get departments based on selected affiliation\r\n  const departments = useMemo(() => {\r\n    const relevantPersonnel = filterAff \r\n      ? personnelData.filter(p => (p.affiliation || 'ไม่ระบุ') === filterAff)\r\n      : personnelData;\r\n    \r\n    const setDept = new Set();\r\n    relevantPersonnel.forEach(p => setDept.add(p.deph || 'ไม่ระบุ'));\r\n    return Array.from(setDept).sort();\r\n  }, [personnelData, filterAff]);\r\n\r\n  // Get positions\r\n  const positions = useMemo(() => {\r\n    const s = new Set();\r\n    personnelData.forEach(p => s.add(p.position || 'ไม่ระบุ'));\r\n    return Array.from(s).sort();\r\n  }, [personnelData]);\r\n\r\n  // Reset department when affiliation changes\r\n  useEffect(() => {\r\n    if (filterAff) {\r\n      setFilterDept('');\r\n    }\r\n  }, [filterAff]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const results = personnelData.filter(p => {\r\n    const hay = `${p.firstname} ${p.lastname} ${p.position || ''} ${p.affiliation || ''} ${p.deph || ''}`.toLowerCase();\r\n    if (query && !hay.includes(query.toLowerCase())) return false;\r\n    if (filterAff && (p.affiliation || 'ไม่ระบุ') !== filterAff) return false;\r\n    if (filterDept && (p.deph || 'ไม่ระบุ') !== filterDept) return false;\r\n    if (filterPos && (p.position || 'ไม่ระบุ') !== filterPos) return false;\r\n    return true;\r\n  });\r\n\r\n  const handleCall = (tel) => window.open(`tel:${tel}`, '_self');\r\n  const handleMail = (email) => window.open(`mailto:${email}`, '_self');\r\n\r\n  const clearFilters = () => { \r\n    setFilterAff(''); \r\n    setFilterDept(''); \r\n    setFilterPos(''); \r\n    setQuery(''); \r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 overflow-y-auto bg-black/60 hide-scrollbar\">\r\n      <div className=\"flex min-h-screen items-start justify-center p-3 sm:p-6 md:p-10\">\r\n        <div className=\"relative bg-white rounded-2xl sm:rounded-3xl shadow-2xl max-w-6xl w-full p-4 sm:p-6\">\r\n          <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\r\n            <h2 className=\"text-lg sm:text-xl font-bold text-slate-900\">🔍 ค้นหาบุคลากร</h2>\r\n            <button \r\n              onClick={onClose} \r\n              className=\"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors\"\r\n            >\r\n              <X className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Enhanced Search Filters */}\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6\">\r\n            <input \r\n              value={query} \r\n              onChange={(e) => setQuery(e.target.value)} \r\n              className=\"w-full p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm\" \r\n              placeholder=\"🔍 ค้นหาชื่อ, ตำแหน่ง...\" \r\n            />\r\n            \r\n            <select \r\n              value={filterAff} \r\n              onChange={(e) => setFilterAff(e.target.value)} \r\n              className=\"p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm\"\r\n            >\r\n              <option value=\"\">🏢 ทั้งหมด (สังกัด)</option>\r\n              {affiliations.map(a => <option key={a} value={a}>{a}</option>)}\r\n            </select>\r\n            \r\n            <select \r\n              value={filterDept} \r\n              onChange={(e) => setFilterDept(e.target.value)} \r\n              className=\"p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm\"\r\n              disabled={!filterAff}\r\n            >\r\n              <option value=\"\">🏛️ ทั้งหมด (หน่วยงาน)</option>\r\n              {departments.map(d => <option key={d} value={d}>{d}</option>)}\r\n            </select>\r\n            \r\n            <select \r\n              value={filterPos} \r\n              onChange={(e) => setFilterPos(e.target.value)} \r\n              className=\"p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm\"\r\n            >\r\n              <option value=\"\">👤 ทั้งหมด (ตำแหน่ง)</option>\r\n              {positions.map(p => <option key={p} value={p}>{p}</option>)}\r\n            </select>\r\n          </div>\r\n\r\n          {/* Results header and actions */}\r\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-3\">\r\n            <div className=\"text-sm text-slate-600 flex items-center gap-2\">\r\n              <Users className=\"w-4 h-4 text-indigo-500\" />\r\n              พบ <span className=\"font-bold text-indigo-600\">{results.length}</span> รายการ\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <button \r\n                onClick={clearFilters} \r\n                className=\"text-sm text-slate-600 px-3 py-1 rounded-lg bg-slate-100 hover:bg-slate-200 transition-colors\"\r\n              >\r\n                🗑️ ล้างตัวกรอง\r\n              </button>\r\n              <button \r\n                onClick={() => onExport(results)} \r\n                className=\"text-sm px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-1\"\r\n              >\r\n                <Download className=\"w-4 h-4\" />\r\n                ส่งออก\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Results grid */}\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 max-h-[60vh] overflow-y-auto hide-scrollbar\">\r\n            {results.map((p, i) => (\r\n              <PersonCard \r\n                key={`${p.phone || i}-${i}`} \r\n                person={p} \r\n                onView={onViewPerson} \r\n                onCall={handleCall} \r\n                onMail={handleMail} \r\n              />\r\n            ))}\r\n            {results.length === 0 && (\r\n              <div className=\"col-span-full text-center text-slate-500 py-12\">\r\n                <Users className=\"w-16 h-16 text-slate-300 mx-auto mb-4\" />\r\n                <h3 className=\"text-lg font-semibold text-slate-600 mb-2\">ไม่พบผลลัพธ์</h3>\r\n                <p className=\"text-sm\">ลองเปลี่ยนคำค้นหาหรือตัวกรองข้อมูล</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default function PersonnelPage({ user }) {\r\n  const [loading, setLoading] = useState(true);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [personnelData, setPersonnelData] = useState([]);\r\n  const [selectedPerson, setSelectedPerson] = useState(null);\r\n  const [showDetail, setShowDetail] = useState(false);\r\n  const [showSearchModal, setShowSearchModal] = useState(false);\r\n\r\n  const [quota, setQuota] = useState(0);\r\n  const [vacancy, setVacancy] = useState(0);\r\n  const [isEditingQuota, setIsEditingQuota] = useState(false);\r\n  const [isEditingVacancy, setIsEditingVacancy] = useState(false);\r\n  const [generalStatsData, setGeneralStatsData] = useState({});\r\n\r\n  const [selectedChart, setSelectedChart] = useState(\"position\"); // Default chart type\r\n  const [selectedAffiliation, setSelectedAffiliation] = useState(\"\"); // For department filtering\r\n  const [filters, setFilters] = useState({\r\n    affiliation: \"\",\r\n    department: \"\",\r\n    ageRange: \"\",\r\n    gender: \"\",\r\n  });\r\n\r\n  const logAdminActivity = useCallback((action, details) => {\r\n    if (!user) return;\r\n    fetch(CONFIG.ADMIN_API, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        action: 'log_activity',\r\n        log_action: action,\r\n        log_details: details || null,\r\n        user_id: user.id,\r\n        username: user.username,\r\n      }),\r\n    }).catch((error) => console.error('Failed to log activity:', error));\r\n  }, [user]);\r\n\r\n  // ฟังก์ชันดึงข้อมูลจาก general_stats API\r\n  const fetchGeneralStats = useCallback(async () => {\r\n    try {\r\n      const response = await fetch(CONFIG.GENERAL_STATS_API);\r\n      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\r\n      const result = await response.json();\r\n      \r\n      if (result.success && Array.isArray(result.data)) {\r\n        const statsMap = {};\r\n        result.data.forEach(item => {\r\n          statsMap[item.name] = item.value;\r\n        });\r\n        setGeneralStatsData(statsMap);\r\n        \r\n        // ตั้งค่า quota และ vacancy จากข้อมูล API\r\n        setQuota(statsMap.quota || 0);\r\n        setVacancy(statsMap.vacancy || 0);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching general stats:', error);\r\n      // ใช้ค่าเริ่มต้นในกรณีที่ดึงข้อมูลไม่ได้\r\n      setQuota(100);\r\n      setVacancy(20);\r\n    }\r\n  }, []);\r\n\r\n  // ฟังก์ชันอัพเดทค่าใน general_stats\r\n  const updateGeneralStat = useCallback(async (name, value) => {\r\n    try {\r\n      const response = await fetch(`${CONFIG.GENERAL_STATS_API}/value/${name}`, {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ value: parseInt(value) })\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        // ถ้ายังไม่มีข้อมูล ให้สร้างใหม่\r\n        if (response.status === 404) {\r\n          const createResponse = await fetch(CONFIG.GENERAL_STATS_API, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ \r\n              name: name, \r\n              value: parseInt(value),\r\n              description: name === 'quota' ? 'กรอบอัตรากำลังทั้งหมด' : 'จำนวนตำแหน่งว่าง'\r\n            })\r\n          });\r\n          \r\n          if (!createResponse.ok) {\r\n            throw new Error('Failed to create new stat');\r\n          }\r\n        } else {\r\n          throw new Error('Failed to update stat');\r\n        }\r\n      }\r\n      \r\n      // อัพเดทข้อมูลใน state\r\n      setGeneralStatsData(prev => ({\r\n        ...prev,\r\n        [name]: parseInt(value)\r\n      }));\r\n      \r\n    } catch (error) {\r\n      console.error(`Error updating ${name}:`, error);\r\n      alert(`เกิดข้อผิดพลาดในการบันทึก ${name === 'quota' ? 'กรอบอัตรา' : 'ตำแหน่งว่าง'}`);\r\n    }\r\n  }, []);\r\n\r\n  const fetchPersonnelData = useCallback(async () => {\r\n    try {\r\n      const apiUrl = CONFIG.OFFICERS_API;\r\n      const response = await fetch(apiUrl);\r\n      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\r\n      const text = await response.text();\r\n      if (!text) throw new Error('Empty response from server');\r\n      const result = JSON.parse(text);\r\n      const data = result.success && Array.isArray(result.data) ? result.data : [];\r\n      const formattedData = data.map((person) => ({\r\n        phone: person.phone || '',\r\n        prefix: person.prefix || '',\r\n        firstname: person.firstname || '',\r\n        lastname: person.lastname || '',\r\n        position: person.position || '',\r\n        affiliation: person.affiliation || '',\r\n        deph: person.department || '',\r\n        generation: person.generation || '',\r\n        email: person.email || '',\r\n        dob: person.dob || '',\r\n        lineUserId: person.lineUserId || '',\r\n        role: person.role || 'member',\r\n      }));\r\n      setPersonnelData(formattedData);\r\n      setError(\"\");\r\n    } catch (error) {\r\n      setError(`⚠️ ${error.message}`);\r\n      setPersonnelData([]);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchPersonnelData();\r\n    fetchGeneralStats(); // เพิ่มการดึงข้อมูล general stats\r\n  }, [fetchPersonnelData, fetchGeneralStats]);\r\n\r\n  const handleRefresh = () => {\r\n    setRefreshing(true);\r\n    Promise.all([\r\n      fetchPersonnelData(),\r\n      fetchGeneralStats()\r\n    ]).finally(() => setRefreshing(false));\r\n  };\r\n\r\n  const handleViewPerson = (person) => {\r\n  // If user opened from search, close search modal first so detail appears on top\r\n  setShowSearchModal(false);\r\n  setSelectedPerson(person);\r\n  setShowDetail(true);\r\n  };\r\n\r\n  const exportToCSV = (data) => {\r\n    // Implement CSV export logic here\r\n  };\r\n\r\n  const affiliationAbbreviations = {\r\n    \"ศูนย์รักษาความปลอดภัย\": \"ส่วนกลาง\",\r\n    \"ศาลชั้นต้นในกรุงเทพมหานคร\": \"กทม.\",\r\n  };\r\n\r\n  const filteredAffiliationData = useMemo(() => {\r\n    return personnelData.reduce((acc, person) => {\r\n      let affiliation = (person.affiliation || '').trim();\r\n      if (!affiliation) affiliation = 'ไม่ระบุ';\r\n\r\n      const lower = affiliation.toLowerCase();\r\n\r\n      // Normalize known patterns using targeted rules\r\n      let normalized = affiliation;\r\n\r\n      // If it's the regional office pattern that contains สำนักศาลยุติธรรมประจำภาค\r\n      // we want to convert it to: 'ภาค <n>' when a number exists, otherwise 'ภาค'\r\n      if (\r\n        lower.includes('สำนักศาลยุติธรรมประจำภาค') ||\r\n        lower.includes('สำนักยุติธรรมประจำภาค') ||\r\n        lower.includes('ในสังกัดสำนักศาลยุติธรรมประจำภาค') ||\r\n        lower.includes('ศาลในสังกัดสำนักศาลยุติธรรมประจำภาค')\r\n      ) {\r\n        // Try to extract explicit 'ภาค <number>' first\r\n        const matchRegion = affiliation.match(/ภาค\\s*(\\d{1,3})/i);\r\n        if (matchRegion && matchRegion[1]) {\r\n          normalized = `ภาค ${matchRegion[1]}`;\r\n        } else {\r\n          // Fallback: find any trailing number in the string (e.g., '... ประจำภาค 4')\r\n          const trailingNum = affiliation.match(/(\\d{1,3})\\s*$/);\r\n          if (trailingNum && trailingNum[1]) {\r\n            normalized = `ภาค ${trailingNum[1]}`;\r\n          } else {\r\n            // Last-resort: any first number in the string\r\n            const anyNum = affiliation.match(/(\\d{1,3})/);\r\n            normalized = anyNum && anyNum[1] ? `ภาค ${anyNum[1]}` : 'ภาค';\r\n          }\r\n        }\r\n      } else if (lower.includes('ศูนย์รักษาความปลอดภัย')) {\r\n        normalized = 'ส่วนกลาง';\r\n      } else if (lower.includes('กรุงเทพ') || lower.includes('กรุงเทพมหานคร') || lower.includes('ศาลชั้นต้นในกรุงเทพมหานคร')) {\r\n        normalized = 'กทม.';\r\n      } else {\r\n        // fallback to any exact mapping we defined, otherwise keep original\r\n        normalized = affiliationAbbreviations[affiliation] || affiliation;\r\n      }\r\n\r\n      acc[normalized] = (acc[normalized] || 0) + 1;\r\n      return acc;\r\n    }, {});\r\n  }, [personnelData]);\r\n\r\n  const chartData = useMemo(() => {\r\n    const entries = Object.entries(filteredAffiliationData).map(([label, value]) => ({ label, value }));\r\n\r\n    const getOrderKey = (label) => {\r\n      if (!label) return 9999;\r\n      const l = String(label).trim();\r\n\r\n      // Match 'ภาค' followed by number e.g. 'ภาค 1' or 'ภาค1'\r\n      const m = l.match(/ภาค\\s*(\\d{1,3})/);\r\n      if (m && m[1]) {\r\n        // Put ภาค N in order 0.. (keep N small)\r\n        const num = parseInt(m[1], 10);\r\n        return num; // 1..9 -> 1..9 (smaller is earlier)\r\n      }\r\n\r\n      // If label is exactly 'ภาค' (no number), put after numbered ภาค\r\n      if (/^ภาค$/i.test(l)) return 999;\r\n\r\n      // Specific named orders after ภาค group\r\n      if (l === 'กทม.' || l.toLowerCase() === 'กทม.') return 1000;\r\n      if (l === 'ส่วนกลาง' || l.toLowerCase() === 'ส่วนกลาง') return 1001;\r\n      if (l.includes('ศาลสูง')) return 1002;\r\n      // handle both spellings 'ชำนาญ' and 'ชำนัญ'\r\n      if (l.includes('ชำนาญ') || l.includes('ชำนัญ') || l.includes('ชำนัญพิเศษ') || l.includes('ชำนาญพิเศษ')) return 1003;\r\n\r\n      // Default: place after known groups but preserve alphabetical order by returning a high key plus name\r\n      return 5000 + l.charCodeAt(0);\r\n    };\r\n\r\n    entries.sort((a, b) => {\r\n      const ka = getOrderKey(a.label);\r\n      const kb = getOrderKey(b.label);\r\n      if (ka === kb) {\r\n        // fallback alphabetical\r\n        return String(a.label).localeCompare(String(b.label));\r\n      }\r\n      return ka - kb;\r\n    });\r\n\r\n    return entries;\r\n  }, [filteredAffiliationData]);\r\n\r\n  const stats = useMemo(() => {\r\n    const newStats = {\r\n      total: personnelData.length,\r\n      connected: personnelData.filter((p) => p.lineUserId).length,\r\n      byPosition: {},\r\n      byAffiliation: {},\r\n      byDepartment: {},\r\n      byGeneration: {},\r\n    };\r\n    personnelData.forEach((person) => {\r\n      const position = person.position || 'ไม่ระบุ';\r\n      newStats.byPosition[position] = (newStats.byPosition[position] || 0) + 1;\r\n      const affiliation = person.affiliation || 'ไม่ระบุ';\r\n      newStats.byAffiliation[affiliation] = (newStats.byAffiliation[affiliation] || 0) + 1;\r\n      const department = person.deph || 'ไม่ระบุตำแหน่ง';\r\n      newStats.byDepartment[department] = (newStats.byDepartment[department] || 0) + 1;\r\n      const generation = person.generation ? String(person.generation).trim() : 'ไม่ระบุตำแหน่ง';\r\n      newStats.byGeneration[generation] = (newStats.byGeneration[generation] || 0) + 1;\r\n    });\r\n    return newStats;\r\n  }, [personnelData]);\r\n\r\n  const chartColors = [\r\n    \"#FF6384\", \"#36A2EB\", \"#FFCE56\", \"#4BC0C0\", \"#9966FF\", \"#FF9F40\", \"#FFCD56\", \"#C9CBCF\"\r\n  ];\r\n\r\n  // Helper: build chart data for different types (inside component)\r\n  const getChartData = useCallback((type) => {\r\n    if (type === 'affiliation') return chartData; // already normalized affiliation entries\r\n\r\n    if (type === 'position') {\r\n      // build from stats.byPosition\r\n      const entries = Object.entries(stats.byPosition || {}).map(([label, value]) => ({ label, value }));\r\n      // sort by value desc\r\n      entries.sort((a, b) => b.value - a.value);\r\n      return entries;\r\n    }\r\n\r\n    if (type === 'department') {\r\n      // build from deph field - filter by selected affiliation if any\r\n      const groups = {};\r\n      const filteredData = selectedAffiliation \r\n        ? personnelData.filter(p => (p.affiliation || 'ไม่ระบุ') === selectedAffiliation)\r\n        : personnelData;\r\n        \r\n      filteredData.forEach(p => {\r\n        const dept = p.deph || 'ไม่ระบุ';\r\n        groups[dept] = (groups[dept] || 0) + 1;\r\n      });\r\n      return Object.entries(groups).map(([label, value]) => ({ label, value })).sort((a, b) => b.value - a.value);\r\n    }\r\n\r\n    if (type === 'age') {\r\n      // derive age groups from dob (basic)\r\n      const groups = { '<30': 0, '30-39': 0, '40-49': 0, '50-59': 0, '60+': 0 };\r\n      const now = new Date();\r\n      personnelData.forEach(p => {\r\n        if (!p.dob) return;\r\n        const m = String(p.dob).match(/(\\d{4})/);\r\n        if (!m) return;\r\n        const year = parseInt(m[1], 10);\r\n        if (isNaN(year)) return;\r\n        const age = now.getFullYear() - year;\r\n        if (age < 30) groups['<30']++;\r\n        else if (age < 40) groups['30-39']++;\r\n        else if (age < 50) groups['40-49']++;\r\n        else if (age < 60) groups['50-59']++;\r\n        else groups['60+']++;\r\n      });\r\n      return Object.entries(groups).map(([label, value]) => ({ label, value }));\r\n    }\r\n\r\n    if (type === 'gender') {\r\n      // no gender field in data - return empty to show no data\r\n      const genders = (personnelData || []).reduce((acc, p) => {\r\n        const g = (p.gender || '').trim();\r\n        if (!g) return acc;\r\n        acc[g] = (acc[g] || 0) + 1;\r\n        return acc;\r\n      }, {});\r\n      return Object.entries(genders).map(([label, value]) => ({ label, value }));\r\n    }\r\n\r\n    return [];\r\n  }, [chartData, stats, personnelData, selectedAffiliation]); // Add selectedAffiliation dependency\r\n\r\n  // Helper function to get chart title\r\n  const getChartTitle = (chartType) => {\r\n    switch (chartType) {\r\n      case \"position\":\r\n        return \"ตำแหน่ง\";\r\n      case \"affiliation\":\r\n        return \"สัดส่วนแต่ละสังกัด\";\r\n      case \"department\":\r\n        return selectedAffiliation \r\n          ? `หน่วยงานใน${selectedAffiliation}`\r\n          : \"หน่วยงาน (เลือกสังกัดก่อน)\";\r\n      case \"gender\":\r\n        return \"เพศ\";\r\n      case \"age\":\r\n        return \"ช่วงอายุ\";\r\n      default:\r\n        return \"ข้อมูลบุคลากร\";\r\n    }\r\n  };\r\n\r\n  const renderChart = () => {\r\n    switch (selectedChart) {\r\n      case \"position\":\r\n        return (\r\n          <HorizontalBarChart\r\n            data={getChartData('position')}\r\n            colors={chartColors}\r\n            title=\"ตำแหน่ง\"\r\n            maxHeight=\"800px\"\r\n          />\r\n        );\r\n      case \"affiliation\":\r\n        return (\r\n          <HorizontalBarChart\r\n            data={getChartData('affiliation')}\r\n            colors={chartColors}\r\n            title=\"สัดส่วนแต่ละสังกัด\"\r\n            maxHeight=\"800px\"\r\n          />\r\n        );\r\n      case \"department\":\r\n        return (\r\n          <div className=\"space-y-4\">\r\n            {!selectedAffiliation ? (\r\n              <div className=\"text-center py-8\">\r\n                <Building2 className=\"w-16 h-16 text-slate-300 mx-auto mb-4\" />\r\n                <h3 className=\"text-lg font-semibold text-slate-600 mb-2\">เลือกสังกัดก่อน</h3>\r\n                <p className=\"text-sm text-slate-500 mb-4\">กรุณาเลือกสังกัดเพื่อดูหน่วยงานในสังกัดนั้น</p>\r\n                <select \r\n                  value={selectedAffiliation}\r\n                  onChange={(e) => setSelectedAffiliation(e.target.value)}\r\n                  className=\"p-2 border border-slate-300 rounded-lg\"\r\n                >\r\n                  <option value=\"\">เลือกสังกัด</option>\r\n                  {Array.from(new Set(personnelData.map(p => p.affiliation || 'ไม่ระบุ'))).sort().map(aff => (\r\n                    <option key={aff} value={aff}>{aff}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n            ) : (\r\n              <HorizontalBarChart\r\n                data={getChartData('department')}\r\n                colors={chartColors}\r\n                title={`หน่วยงานใน${selectedAffiliation}`}\r\n                maxHeight=\"320px\"\r\n              />\r\n            )}\r\n          </div>\r\n        );\r\n      case \"gender\":\r\n        return (\r\n          <PieChartComponent\r\n            data={getChartData('gender')}\r\n            colors={chartColors}\r\n            title=\"เพศ\"\r\n          />\r\n        );\r\n      case \"age\":\r\n        return (\r\n          <HorizontalBarChart\r\n            data={getChartData('age')}\r\n            colors={chartColors}\r\n            title=\"ช่วงอายุ\"\r\n            maxHeight=\"240px\"\r\n          />\r\n        );\r\n      default:\r\n        return <p>ไม่มีข้อมูลสำหรับแสดงผล</p>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full min-h-full p-6\">\r\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <h1 className=\"text-xl sm:text-2xl font-bold text-slate-800\">ข้อมูลบุคลากร</h1>\r\n          <button\r\n            onClick={() => setShowSearchModal(true)}\r\n            className=\"flex items-center space-x-2 px-3 sm:px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow text-sm transition-colors\"\r\n          >\r\n            <Search className=\"w-4 h-4\" />\r\n            <span>ค้นหาบุคลากร</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8\">\r\n        <EditableCard\r\n          title=\"กรอบอัตรา\"\r\n          value={quota}\r\n          icon={Briefcase}\r\n          color=\"blue\"\r\n          isEditing={isEditingQuota}\r\n          onEdit={async () => {\r\n            if (isEditingQuota) {\r\n              // บันทึกข้อมูลเมื่อเสร็จสิ้นการแก้ไข\r\n              await updateGeneralStat('quota', quota);\r\n              logAdminActivity('update_quota', `Updated quota to ${quota}`);\r\n            }\r\n            setIsEditingQuota(!isEditingQuota);\r\n          }}\r\n          onChange={(value) => setQuota(value)}\r\n          isAdmin={user?.role === 'admin'}\r\n        />\r\n        <EditableCard\r\n          title=\"ตำแหน่งว่าง\"\r\n          value={vacancy}\r\n          icon={UserX}\r\n          color=\"red\"\r\n          isEditing={isEditingVacancy}\r\n          onEdit={async () => {\r\n            if (isEditingVacancy) {\r\n              // บันทึกข้อมูลเมื่อเสร็จสิ้นการแก้ไข\r\n              await updateGeneralStat('vacancy', vacancy);\r\n              logAdminActivity('update_vacancy', `Updated vacancy to ${vacancy}`);\r\n            }\r\n            setIsEditingVacancy(!isEditingVacancy);\r\n          }}\r\n          onChange={(value) => setVacancy(value)}\r\n          isAdmin={user?.role === 'admin'}\r\n        />\r\n        <StatCard\r\n          title=\"บุคลากรทั้งหมด\"\r\n          value={stats.total}\r\n          icon={Users}\r\n          color=\"green\"\r\n          subtitle=\"ทั้งหมดในระบบ\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"flex flex-wrap items-center gap-2 sm:gap-4 mb-4 sm:mb-6\">\r\n        <button\r\n          onClick={() => setSelectedChart(\"position\")}\r\n          className={`px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors ${selectedChart === \"position\" ? \"bg-indigo-600 text-white\" : \"bg-gray-200 text-gray-800 hover:bg-gray-300\"}`}\r\n        >\r\n          ตำแหน่ง\r\n        </button>\r\n        <button\r\n          onClick={() => setSelectedChart(\"affiliation\")}\r\n          className={`px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors ${selectedChart === \"affiliation\" ? \"bg-indigo-600 text-white\" : \"bg-gray-200 text-gray-800 hover:bg-gray-300\"}`}\r\n        >\r\n          สังกัด\r\n        </button>\r\n        <button\r\n          onClick={() => {\r\n            setSelectedChart(\"department\");\r\n            if (!selectedAffiliation) {\r\n              // Auto-select first affiliation if none selected\r\n              const affiliations = Array.from(new Set(personnelData.map(p => p.affiliation || 'ไม่ระบุ'))).sort();\r\n              if (affiliations.length > 0) {\r\n                setSelectedAffiliation(affiliations[0]);\r\n              }\r\n            }\r\n          }}\r\n          className={`px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors ${selectedChart === \"department\" ? \"bg-indigo-600 text-white\" : \"bg-gray-200 text-gray-800 hover:bg-gray-300\"}`}\r\n        >\r\n          หน่วยงาน\r\n        </button>\r\n        <button\r\n          onClick={() => setSelectedChart(\"gender\")}\r\n          className={`px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors ${selectedChart === \"gender\" ? \"bg-indigo-600 text-white\" : \"bg-gray-200 text-gray-800 hover:bg-gray-300\"}`}\r\n        >\r\n          เพศ\r\n        </button>\r\n        <button\r\n          onClick={() => setSelectedChart(\"age\")}\r\n          className={`px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors ${selectedChart === \"age\" ? \"bg-indigo-600 text-white\" : \"bg-gray-200 text-gray-800 hover:bg-gray-300\"}`}\r\n        >\r\n          ช่วงอายุ\r\n        </button>\r\n        \r\n        {selectedChart === \"department\" && (\r\n          <select \r\n            value={selectedAffiliation}\r\n            onChange={(e) => setSelectedAffiliation(e.target.value)}\r\n            className=\"ml-2 p-2 border border-slate-300 rounded-lg text-sm bg-white\"\r\n          >\r\n            <option value=\"\">เลือกสังกัด</option>\r\n            {Array.from(new Set(personnelData.map(p => p.affiliation || 'ไม่ระบุ'))).sort().map(aff => (\r\n              <option key={aff} value={aff}>{aff}</option>\r\n            ))}\r\n          </select>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6\">\r\n        <div className=\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 min-h-[600px]\">\r\n          <h2 className=\"text-base sm:text-lg font-semibold text-slate-800 mb-4\">กราฟแท่ง</h2>\r\n          <div className=\"h-[520px]\">\r\n            {renderChart()}\r\n          </div>\r\n        </div>\r\n        <div className=\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 min-h-[600px]\">\r\n          <h2 className=\"text-base sm:text-lg font-semibold text-slate-800 mb-4\">กราฟวงกลม</h2>\r\n          <div className=\"h-[520px]\">\r\n            <PieChartComponent data={getChartData(selectedChart)} colors={chartColors} title={getChartTitle(selectedChart)} />\r\n          </div>\r\n        </div>\r\n        <div className=\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 h-[600px]\">\r\n          <h2 className=\"text-base sm:text-lg font-semibold text-slate-800 mb-4\">สรุปข้อมูล</h2>\r\n          <SummaryCards data={getChartData(selectedChart)} colors={chartColors} title={getChartTitle(selectedChart)} />\r\n        </div>\r\n        <div className=\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 min-h-[600px]\">\r\n          <h2 className=\"text-base sm:text-lg font-semibold text-slate-800 mb-4\">กราฟเส้น</h2>\r\n          <div className=\"h-[520px]\">\r\n            <LineChart data={getChartData(selectedChart)} colors={chartColors} title={getChartTitle(selectedChart)} />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <PersonnelDetailModal\r\n        person={selectedPerson}\r\n        isOpen={showDetail}\r\n        onClose={() => setShowDetail(false)}\r\n      />\r\n      <SearchModal\r\n        isOpen={showSearchModal}\r\n        onClose={() => setShowSearchModal(false)}\r\n        personnelData={personnelData}\r\n        stats={stats}\r\n        onViewPerson={handleViewPerson}\r\n        onExport={exportToCSV}\r\n        user={user}\r\n      />\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}