{"ast":null,"code":"import _objectSpread from\"C:/Users/LENOVO/Documents/GitHub/court-marshal-connect/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState,useMemo,useCallback,memo}from\"react\";import{Search,Filter,Users,Phone,Mail,Calendar,Award,Building2,UserCheck,UserX,TrendingUp,PieChart,BarChart3,Download,RefreshCw,Eye,Grid3X3,List,X,AlertCircle,CheckCircle2,Clock,Briefcase,GraduationCap,Edit2,Save}from\"lucide-react\";import{CONFIG}from'../config';import DonutChart from'../components/DonutChart';import LineChart from'../components/LineChart';// StatCard Component\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const StatCard=/*#__PURE__*/memo(_ref=>{let{title,value,icon:Icon,color=\"blue\",trend,subtitle}=_ref;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-\".concat(color,\"-100 rounded-xl flex items-center justify-center\"),children:/*#__PURE__*/_jsx(Icon,{className:\"w-6 h-6 text-\".concat(color,\"-600\")})}),trend&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-green-600 text-sm\",children:[/*#__PURE__*/_jsx(TrendingUp,{className:\"w-4 h-4 mr-1\"}),/*#__PURE__*/_jsxs(\"span\",{children:[trend,\"%\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-slate-900 mb-1\",children:value}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-slate-600\",children:title}),subtitle&&/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-slate-500 mt-1\",children:subtitle})]});});// Table Chart Component (สำหรับแสดงข้อมูลตำแหน่งแบบตาราง)\nconst TableChart=/*#__PURE__*/memo(_ref2=>{let{title,data,colors=[]}=_ref2;const total=useMemo(()=>data.reduce((sum,d)=>sum+d.value,0),[data]);return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-slate-900\",children:total}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-slate-500\",children:\"\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid gap-2\",children:data.slice(0,8).map((item,index)=>{const percentage=(item.value/total*100).toFixed(1);const color=colors[index%colors.length]||'#6366f1';return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-3 bg-slate-50 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3 flex-1 min-w-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 rounded-sm flex-shrink-0\",style:{backgroundColor:color}}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-slate-700 font-medium truncate\",title:item.label,children:item.label})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 text-right\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-bold text-slate-900\",children:item.value}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-slate-500\",children:[percentage,\"%\"]})]})]},\"\".concat(item.label,\"-\").concat(index));})})]})]});});// Function สำหรับตัดคำยาว\nconst truncatePosition=position=>{if(!position)return'';const removePatterns=['เจ้าพนักงานตำรวจศาล','ตำรวจศาล','ตำรวจ','พนักงาน'];let result=position;for(const pattern of removePatterns){result=result.replace(new RegExp(pattern,'gi'),'');}return result.trim()||position;};// Function สำหรับตัดคำ \"ศาล\" ออกจากสังกัด\nconst truncateAffiliation=affiliation=>{if(!affiliation)return'';const lower=affiliation.toLowerCase();// Only remove the leading word 'ศาล' for affiliations that describe\n// 'ในสังกัดสำนักยุติธรรมประจำภาค' (or variants). Do not strip 'ศาล'\n// from other court names like 'ศาลสูง' or 'ศาลชำนาญพิเศษ'.\nif(lower.includes('ในสังกัดสำนักยุติธรรมประจำภาค')||lower.includes('ในสังกัดสำนักยุติธรรม')){return affiliation.replace(/^ศาล\\s*/i,'').trim()||affiliation;}// Otherwise return affiliation unchanged\nreturn affiliation;};// --- NEW: Proportional Treemap Chart Component ---\n// --- NEW: Proportional Treemap Chart Component (MODIFIED FOR LOGARITHMIC SCALE) ---\nconst TreemapChart=/*#__PURE__*/memo(_ref3=>{let{title,data,colors=[]}=_ref3;// --- ส่วนที่แก้ไข: คำนวณ total จากค่าจริงก่อนแปลงสเกล ---\nconst originalTotal=useMemo(()=>data.reduce((sum,d)=>sum+d.value,0),[data]);// --- ส่วนที่แก้ไข: สร้างข้อมูลชุดใหม่ที่มีการปรับสเกลด้วย Math.log1p ---\n// Math.log1p(x) จะคำนวณ log(1+x) ช่วยให้ค่าที่น้อยๆ มีขนาดใหญ่ขึ้นเมื่อเทียบกับค่ามากๆ\nconst scaledData=useMemo(()=>data.map(item=>_objectSpread(_objectSpread({},item),{},{scaledValue:Math.log1p(item.value)})),[data]);const generateTreemapLayout=useCallback((items,width,height)=>{let rects=[];const layoutRow=(rowItems,x,y,w,h)=>{if(!rowItems.length)return;// --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\nconst totalValue=rowItems.reduce((sum,i)=>sum+i.scaledValue,0);if(totalValue===0)return;let offset=0;const isHorizontal=w>h;for(const item of rowItems){// --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\nconst percentage=item.scaledValue/totalValue;if(isHorizontal){const rectWidth=w*percentage;rects.push({x:x+offset,y,width:rectWidth,height:h,item});offset+=rectWidth;}else{const rectHeight=h*percentage;rects.push({x,y:y+offset,width:w,height:rectHeight,item});offset+=rectHeight;}}};const squarify=(items,x,y,w,h)=>{if(!items.length)return;if(items.length<=4){layoutRow(items,x,y,w,h);return;}// --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\nconst halfValue=items.reduce((sum,i)=>sum+i.scaledValue,0)/2;let runningTotal=0;let splitIndex=0;for(let i=0;i<items.length;i++){// --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\nrunningTotal+=items[i].scaledValue;if(runningTotal>=halfValue){splitIndex=i+1;break;}}splitIndex=Math.max(1,splitIndex);const groupA=items.slice(0,splitIndex);const groupB=items.slice(splitIndex);const groupATotal=groupA.reduce((sum,i)=>sum+i.scaledValue,0);const totalValue=groupATotal+groupB.reduce((sum,i)=>sum+i.scaledValue,0);if(totalValue===0)return;if(w>h){const groupAWidth=w*(groupATotal/totalValue);squarify(groupA,x,y,groupAWidth,h);squarify(groupB,x+groupAWidth,y,w-groupAWidth,h);}else{const groupAHeight=h*(groupATotal/totalValue);squarify(groupA,x,y,w,groupAHeight);squarify(groupB,x,y+groupAHeight,w,h-groupAHeight);}};squarify(items,0,0,1000,1000);// Use a relative base for layout\nreturn rects;},[]);// --- ส่วนที่แก้ไข: ส่ง scaledData เข้าไปคำนวณ layout ---\nconst layout=useMemo(()=>generateTreemapLayout(scaledData),[scaledData,generateTreemapLayout]);if(!data.length||originalTotal===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 h-full\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-500\",children:\"\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E41\\u0E2A\\u0E14\\u0E07\\u0E01\\u0E23\\u0E32\\u0E1F\"})})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 flex flex-col h-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-slate-900\",children:originalTotal}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-slate-500\",children:\"\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"relative w-full flex-1\",children:layout.map(rect=>{const itemIndex=scaledData.findIndex(d=>d.label===rect.item.label);const color=colors[itemIndex%colors.length];// --- ส่วนที่แก้ไข: คำนวณ % จากค่าจริง ---\nconst percentage=originalTotal>0?(rect.item.value/originalTotal*100).toFixed(1):0;const valueText=\"\".concat(rect.item.value,\" (\").concat(percentage,\"%)\");const fontSize=Math.min(rect.width/10,rect.height/5,16);const textShadowStyle={textShadow:'0px 1px 3px rgba(0, 0, 0, 0.6)'};return/*#__PURE__*/_jsxs(\"div\",{className:\"absolute border-2 border-white rounded-md flex flex-col items-center justify-center p-1 overflow-hidden text-center\",style:{left:\"\".concat(rect.x/10,\"%\"),top:\"\".concat(rect.y/10,\"%\"),width:\"\".concat(rect.width/10,\"%\"),height:\"\".concat(rect.height/10,\"%\"),backgroundColor:color,transition:'all 0.4s ease-in-out'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-white font-bold\",style:_objectSpread({fontSize:\"\".concat(fontSize,\"px\")},textShadowStyle),children:valueText}),/*#__PURE__*/_jsx(\"div\",{className:\"text-white opacity-90 leading-tight\",style:_objectSpread({fontSize:\"\".concat(Math.max(fontSize*0.7,10),\"px\")},textShadowStyle),children:rect.item.label})]},rect.item.label);})})]});});// Pie Chart Component - เปลี่ยนเป็น Donut Chart\nconst PieChartComponent=/*#__PURE__*/memo(_ref4=>{let{title,data,colors=[]}=_ref4;const total=useMemo(()=>data.reduce((sum,d)=>sum+d.value,0),[data]);if(!data.length||total===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(PieChart,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-500\",children:\"\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E41\\u0E2A\\u0E14\\u0E07\\u0E01\\u0E23\\u0E32\\u0E1F\"})})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 h-fit\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 flex items-center\",children:[/*#__PURE__*/_jsx(PieChart,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-right\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-lg font-bold text-slate-900\",children:[\"\\u0E08\\u0E33\\u0E19\\u0E27\\u0E19 \",total,\" \\u0E04\\u0E19\"]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"relative border border-slate-200 rounded-lg p-4 bg-slate-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"relative w-48 h-48\",children:/*#__PURE__*/_jsx(\"svg\",{width:\"192\",height:\"192\",viewBox:\"0 0 192 192\",className:\"w-full h-full\",children:data.map((item,index)=>{const percentage=item.value/total;const angle=percentage*360;const prevPercentage=data.slice(0,index).reduce((sum,d)=>sum+d.value,0)/total;const startAngle=prevPercentage*360-90;const endAngle=startAngle+angle;// Donut chart - outer radius 80, inner radius 45\nconst outerRadius=80;const innerRadius=45;const startXOuter=96+outerRadius*Math.cos(startAngle*Math.PI/180);const startYOuter=96+outerRadius*Math.sin(startAngle*Math.PI/180);const endXOuter=96+outerRadius*Math.cos(endAngle*Math.PI/180);const endYOuter=96+outerRadius*Math.sin(endAngle*Math.PI/180);const startXInner=96+innerRadius*Math.cos(endAngle*Math.PI/180);const startYInner=96+innerRadius*Math.sin(endAngle*Math.PI/180);const endXInner=96+innerRadius*Math.cos(startAngle*Math.PI/180);const endYInner=96+innerRadius*Math.sin(startAngle*Math.PI/180);const largeArcFlag=angle>180?1:0;const pathData=['M',startXOuter,startYOuter,'A',outerRadius,outerRadius,0,largeArcFlag,1,endXOuter,endYOuter,'L',startXInner,startYInner,'A',innerRadius,innerRadius,0,largeArcFlag,0,endXInner,endYInner,'Z'].join(' ');const pieColors=['#8b5cf6','#ec4899','#06b6d4','#10b981','#f59e0b','#ef4444','#84cc16','#6366f1','#f97316','#14b8a6'];const color=pieColors[index%pieColors.length];// คำนวณตำแหน่งสำหรับแสดง percentage\nconst midAngle=startAngle+angle/2;const labelRadius=90;const labelX=96+labelRadius*Math.cos(midAngle*Math.PI/180);const labelY=96+labelRadius*Math.sin(midAngle*Math.PI/180);const percentageText=\"\".concat((percentage*100).toFixed(1),\"%\");return/*#__PURE__*/_jsxs(\"g\",{children:[/*#__PURE__*/_jsx(\"path\",{d:pathData,fill:color,stroke:\"white\",strokeWidth:\"2\"}),percentage>0.05&&/*#__PURE__*/_jsx(\"text\",{x:labelX,y:labelY,textAnchor:\"middle\",dominantBaseline:\"middle\",fill:\"#1e293b\",fontSize:\"10\",fontWeight:\"bold\",stroke:\"white\",strokeWidth:\"2\",paintOrder:\"stroke\",children:percentageText})]},\"donut-\".concat(index));})})}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full mt-6\",children:/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2\",children:data.map((item,index)=>{const percentage=(item.value/total*100).toFixed(0);const pieColors=['#8b5cf6','#ec4899','#06b6d4','#10b981','#f59e0b','#ef4444','#84cc16','#6366f1','#f97316','#14b8a6'];const color=pieColors[index%pieColors.length];return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 min-w-0 flex-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-3 h-3 rounded-full flex-shrink-0\",style:{backgroundColor:color}}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-slate-700\",children:[truncateAffiliation(item.label),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-slate-900\",children:item.value}),\" \\u0E04\\u0E19\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm font-bold text-slate-900 ml-2\",children:[percentage,\"%\"]})]},\"legend-\".concat(item.label,\"-\").concat(index));})})})]})})]});});// Horizontal Bar Chart Component\nconst HorizontalBarChart=/*#__PURE__*/memo(_ref5=>{let{title,data,colors=[],maxHeight='320px'}=_ref5;const getSortOrder=label=>{const regionMatch=label.match(/ภาค\\s*(\\d+)/);if(regionMatch)return parseInt(regionMatch[1]);const customOrder=['ศาลชั้นต้นในเขตกรุงเทพมหานคร','ศูนย์รักษาความปลอดภัย','ศาลชำนาญพิเศษ','ศาลสูง'];const index=customOrder.findIndex(item=>label.includes(item));if(index!==-1)return 100+index;return 999;};const sortedData=useMemo(()=>[...data].sort((a,b)=>getSortOrder(a.label)-getSortOrder(b.label)),[data]);const maxValue=useMemo(()=>{if(!sortedData||sortedData.length===0)return 0;return Math.max(...sortedData.map(d=>d.value));},[sortedData]);if(!sortedData.length||maxValue===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-500\",children:\"\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E41\\u0E2A\\u0E14\\u0E07\\u0E01\\u0E23\\u0E32\\u0E1F\"})})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-4 shadow-sm border border-slate-200\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 mb-3 flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",style:{maxHeight,overflowY:'auto',paddingRight:8},children:sortedData.map((item,index)=>{const barWidth=item.value/maxValue*100;const color=colors[index%colors.length]||'#8b5cf6';return/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-3 gap-2 items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-span-1 text-sm text-slate-700 font-medium text-left truncate\",title:item.label,children:item.label}),/*#__PURE__*/_jsx(\"div\",{className:\"col-span-2 w-full bg-slate-100 rounded-full h-7 relative\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-7 rounded-full transition-all duration-700 flex items-center justify-end pr-3\",style:{width:\"\".concat(barWidth,\"%\"),backgroundColor:color,minWidth:'36px'},children:/*#__PURE__*/_jsx(\"span\",{className:\"text-white text-sm font-bold\",children:item.value})})})]},\"\".concat(item.label,\"-\").concat(index));})})]});});// (moved into the PersonnelPage component to avoid calling hooks at top level)\n// EditableCard Component (restored minimal implementation)\nconst EditableCard=/*#__PURE__*/memo(_ref6=>{let{title,value,icon:Icon,color=\"blue\",isEditing,onEdit,onChange,isAdmin}=_ref6;const[localValue,setLocalValue]=useState(value);useEffect(()=>{setLocalValue(value);},[value]);const handleChange=e=>{const newValue=parseInt(e.target.value)||0;setLocalValue(newValue);onChange(newValue);};return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-\".concat(color,\"-100 rounded-xl flex items-center justify-center\"),children:Icon&&/*#__PURE__*/_jsx(Icon,{className:\"w-6 h-6 text-\".concat(color,\"-600\")})}),isAdmin&&/*#__PURE__*/_jsx(\"button\",{onClick:onEdit,className:\"text-slate-400 hover:text-slate-600 transition-colors\",children:isEditing?/*#__PURE__*/_jsx(Save,{className:\"w-5 h-5\"}):/*#__PURE__*/_jsx(Edit2,{className:\"w-5 h-5\"})})]}),isEditing?/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:localValue,onChange:handleChange,className:\"w-full text-3xl font-bold text-slate-900 mb-1 bg-slate-50 border border-slate-200 rounded px-2 py-1\",min:\"0\"}):/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-slate-900 mb-1\",children:localValue}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-slate-600\",children:title})]});});// PersonnelDetailModal (minimal)\nconst PersonnelDetailModal=/*#__PURE__*/memo(_ref7=>{let{person,isOpen,onClose}=_ref7;if(!isOpen||!person)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-60 overflow-y-auto bg-black/40\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex min-h-screen items-center justify-center p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-16 h-16 rounded-full bg-slate-100 flex items-center justify-center text-xl font-bold text-slate-600\",children:[(person.firstname||'').charAt(0),(person.lastname||'').charAt(0)]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-lg font-semibold\",children:[person.prefix,\" \",person.firstname,\" \",person.lastname]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-slate-500\",children:[person.position||'-',\" \\u2022 \",person.affiliation||'-']})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[person.phone&&/*#__PURE__*/_jsxs(\"a\",{href:\"tel:\".concat(person.phone),className:\"flex items-center gap-2 px-3 py-1 bg-slate-100 rounded text-sm\",title:\"\\u0E42\\u0E17\\u0E23\",children:[/*#__PURE__*/_jsx(Phone,{className:\"w-4 h-4 text-slate-600\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0E42\\u0E17\\u0E23\"})]}),person.email&&/*#__PURE__*/_jsxs(\"a\",{href:\"mailto:\".concat(person.email),className:\"flex items-center gap-2 px-3 py-1 bg-slate-100 rounded text-sm\",title:\"\\u0E2D\\u0E35\\u0E40\\u0E21\\u0E25\",children:[/*#__PURE__*/_jsx(Mail,{className:\"w-4 h-4 text-slate-600\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0E2D\\u0E35\\u0E40\\u0E21\\u0E25\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"p-2 text-slate-400 hover:text-slate-600 rounded-lg\",\"aria-label\":\"\\u0E1B\\u0E34\\u0E14\",children:/*#__PURE__*/_jsx(X,{className:\"w-5 h-5\"})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u0E2B\\u0E19\\u0E48\\u0E27\\u0E22\\u0E07\\u0E32\\u0E19:\"}),\" \",person.deph||'-']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u0E40\\u0E1A\\u0E2D\\u0E23\\u0E4C\\u0E42\\u0E17\\u0E23\\u0E28\\u0E31\\u0E1E\\u0E17\\u0E4C:\"}),\" \",person.phone||'-']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u0E2D\\u0E35\\u0E40\\u0E21\\u0E25:\"}),\" \",person.email||'-']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u0E27\\u0E31\\u0E19\\u0E40\\u0E01\\u0E34\\u0E14:\"}),\" \",person.dob||'-']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Line ID:\"}),\" \",person.lineUserId||'-']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u0E1A\\u0E17\\u0E1A\\u0E32\\u0E17:\"}),\" \",person.role||'-']})]})]})})});});// SearchModal (minimal placeholder)\n// Small visual card for a person used in search results (minimal + icon)\nconst PersonCard=/*#__PURE__*/memo(_ref8=>{let{person,onView,onCall,onMail}=_ref8;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow p-3 flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-12 h-12 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center font-semibold text-lg\",children:[(person.firstname||'').charAt(0),(person.lastname||'').charAt(0)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"min-w-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm font-medium text-slate-900 truncate\",children:[person.prefix,\" \",person.firstname,\" \",person.lastname]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-slate-500 truncate flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Building2,{className:\"w-3 h-3 text-slate-400\"}),/*#__PURE__*/_jsx(\"span\",{children:person.affiliation||'-'}),/*#__PURE__*/_jsx(\"span\",{className:\"mx-1\",children:\"\\u2022\"}),/*#__PURE__*/_jsx(\"span\",{children:person.position||'-'})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[person.phone&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>onCall(person.phone),className:\"p-2 rounded-md bg-slate-50 hover:bg-slate-100 text-slate-600\",title:\"\\u0E42\\u0E17\\u0E23\",children:/*#__PURE__*/_jsx(Phone,{className:\"w-4 h-4\"})}),person.email&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>onMail(person.email),className:\"p-2 rounded-md bg-slate-50 hover:bg-slate-100 text-slate-600\",title:\"\\u0E2D\\u0E35\\u0E40\\u0E21\\u0E25\",children:/*#__PURE__*/_jsx(Mail,{className:\"w-4 h-4\"})}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onView(person),className:\"px-3 py-1 bg-indigo-600 text-white rounded-md text-sm flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Eye,{className:\"w-4 h-4\"}),\" \\u0E14\\u0E39\"]})]})]});});const SearchModal=/*#__PURE__*/memo(_ref9=>{let{isOpen,onClose,personnelData=[],stats={},onViewPerson=()=>{},onExport=()=>{},user}=_ref9;const[query,setQuery]=useState('');const[filterAff,setFilterAff]=useState('');const[filterPos,setFilterPos]=useState('');const affiliations=useMemo(()=>{const setAff=new Set();personnelData.forEach(p=>setAff.add(p.affiliation||'ไม่ระบุ'));return Array.from(setAff).sort();},[personnelData]);const positions=useMemo(()=>{const s=new Set();personnelData.forEach(p=>s.add(p.position||'ไม่ระบุ'));return Array.from(s).sort();},[personnelData]);if(!isOpen)return null;const results=personnelData.filter(p=>{const hay=\"\".concat(p.firstname,\" \").concat(p.lastname,\" \").concat(p.position||'',\" \").concat(p.affiliation||'').toLowerCase();if(!hay.includes(query.toLowerCase()))return false;if(filterAff&&(p.affiliation||'ไม่ระบุ')!==filterAff)return false;if(filterPos&&(p.position||'ไม่ระบุ')!==filterPos)return false;return true;});const handleCall=tel=>window.open(\"tel:\".concat(tel),'_self');const handleMail=email=>window.open(\"mailto:\".concat(email),'_self');const clearFilters=()=>{setFilterAff('');setFilterPos('');setQuery('');};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-50 overflow-y-auto bg-black/60\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex min-h-screen items-start justify-center p-4 sm:p-6 md:p-10\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative bg-white rounded-3xl shadow-2xl max-w-4xl w-full p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold\",children:\"\\u0E04\\u0E49\\u0E19\\u0E2B\\u0E32\\u0E1A\\u0E38\\u0E04\\u0E25\\u0E32\\u0E01\\u0E23\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"p-2 text-slate-400 hover:text-slate-600 rounded-lg\",children:/*#__PURE__*/_jsx(X,{className:\"w-5 h-5\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4\",children:[/*#__PURE__*/_jsx(\"input\",{value:query,onChange:e=>setQuery(e.target.value),className:\"w-full p-2 border rounded\",placeholder:\"\\u0E04\\u0E49\\u0E19\\u0E2B\\u0E32\\u0E0A\\u0E37\\u0E48\\u0E2D, \\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07, \\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14...\"}),/*#__PURE__*/_jsxs(\"select\",{value:filterAff,onChange:e=>setFilterAff(e.target.value),className:\"p-2 border rounded\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14 (\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14)\"}),affiliations.map(a=>/*#__PURE__*/_jsx(\"option\",{value:a,children:a},a))]}),/*#__PURE__*/_jsxs(\"select\",{value:filterPos,onChange:e=>setFilterPos(e.target.value),className:\"p-2 border rounded\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14 (\\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07)\"}),positions.map(p=>/*#__PURE__*/_jsx(\"option\",{value:p,children:p},p))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-slate-500\",children:[\"\\u0E1E\\u0E1A \",results.length,\" \\u0E23\\u0E32\\u0E22\\u0E01\\u0E32\\u0E23\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:clearFilters,className:\"text-sm text-slate-600 px-2 py-1 rounded bg-slate-50\",children:\"\\u0E25\\u0E49\\u0E32\\u0E07\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>onExport(results),className:\"text-sm px-3 py-1 bg-indigo-600 text-white rounded\",children:\"\\u0E2A\\u0E48\\u0E07\\u0E2D\\u0E2D\\u0E01\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3 max-h-72 overflow-y-auto\",children:[results.map((p,i)=>/*#__PURE__*/_jsx(PersonCard,{person:p,onView:onViewPerson,onCall:handleCall,onMail:handleMail},\"\".concat(p.phone||i,\"-\").concat(i))),results.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"text-center text-slate-500 py-8\",children:\"\\u0E44\\u0E21\\u0E48\\u0E1E\\u0E1A\\u0E1C\\u0E25\\u0E25\\u0E31\\u0E1E\\u0E18\\u0E4C\\u0E17\\u0E35\\u0E48\\u0E15\\u0E23\\u0E07\\u0E01\\u0E31\\u0E1A\\u0E04\\u0E33\\u0E04\\u0E49\\u0E19\"})]})]})})});});export default function PersonnelPage(_ref0){let{user}=_ref0;const[loading,setLoading]=useState(true);const[refreshing,setRefreshing]=useState(false);const[error,setError]=useState(\"\");const[personnelData,setPersonnelData]=useState([]);const[selectedPerson,setSelectedPerson]=useState(null);const[showDetail,setShowDetail]=useState(false);const[showSearchModal,setShowSearchModal]=useState(false);const[quota,setQuota]=useState(100);const[vacancy,setVacancy]=useState(20);const[isEditingQuota,setIsEditingQuota]=useState(false);const[isEditingVacancy,setIsEditingVacancy]=useState(false);const[selectedChart,setSelectedChart]=useState(\"position\");// Default chart type\nconst[filters,setFilters]=useState({affiliation:\"\",department:\"\",ageRange:\"\",gender:\"\"});const logAdminActivity=useCallback((action,details)=>{if(!user)return;fetch(CONFIG.ADMIN_API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'log_activity',log_action:action,log_details:details||null,user_id:user.id,username:user.username})}).catch(error=>console.error('Failed to log activity:',error));},[user]);const fetchPersonnelData=useCallback(async()=>{try{const apiUrl=CONFIG.OFFICERS_API;const response=await fetch(apiUrl);if(!response.ok)throw new Error(\"HTTP error! status: \".concat(response.status));const text=await response.text();if(!text)throw new Error('Empty response from server');const result=JSON.parse(text);const data=result.success&&Array.isArray(result.data)?result.data:[];const formattedData=data.map(person=>({phone:person.phone||'',prefix:person.prefix||'',firstname:person.firstname||'',lastname:person.lastname||'',position:person.position||'',affiliation:person.affiliation||'',deph:person.department||'',generation:person.generation||'',email:person.email||'',dob:person.dob||'',lineUserId:person.lineUserId||'',role:person.role||'member'}));setPersonnelData(formattedData);setError(\"\");}catch(error){setError(\"\\u26A0\\uFE0F \".concat(error.message));setPersonnelData([]);}},[]);useEffect(()=>{fetchPersonnelData();},[fetchPersonnelData]);const handleRefresh=()=>{setRefreshing(true);fetchPersonnelData().finally(()=>setRefreshing(false));};const handleViewPerson=person=>{// If user opened from search, close search modal first so detail appears on top\nsetShowSearchModal(false);setSelectedPerson(person);setShowDetail(true);};const exportToCSV=data=>{// Implement CSV export logic here\n};const affiliationAbbreviations={\"ศูนย์รักษาความปลอดภัย\":\"ส่วนกลาง\",\"ศาลชั้นต้นในกรุงเทพมหานคร\":\"กทม.\"};const filteredAffiliationData=useMemo(()=>{return personnelData.reduce((acc,person)=>{let affiliation=(person.affiliation||'').trim();if(!affiliation)affiliation='ไม่ระบุ';const lower=affiliation.toLowerCase();// Normalize known patterns using targeted rules\nlet normalized=affiliation;// If it's the regional office pattern that contains สำนักศาลยุติธรรมประจำภาค\n// we want to convert it to: 'ภาค <n>' when a number exists, otherwise 'ภาค'\nif(lower.includes('สำนักศาลยุติธรรมประจำภาค')||lower.includes('สำนักยุติธรรมประจำภาค')||lower.includes('ในสังกัดสำนักศาลยุติธรรมประจำภาค')||lower.includes('ศาลในสังกัดสำนักศาลยุติธรรมประจำภาค')){// Try to extract explicit 'ภาค <number>' first\nconst matchRegion=affiliation.match(/ภาค\\s*(\\d{1,3})/i);if(matchRegion&&matchRegion[1]){normalized=\"\\u0E20\\u0E32\\u0E04 \".concat(matchRegion[1]);}else{// Fallback: find any trailing number in the string (e.g., '... ประจำภาค 4')\nconst trailingNum=affiliation.match(/(\\d{1,3})\\s*$/);if(trailingNum&&trailingNum[1]){normalized=\"\\u0E20\\u0E32\\u0E04 \".concat(trailingNum[1]);}else{// Last-resort: any first number in the string\nconst anyNum=affiliation.match(/(\\d{1,3})/);normalized=anyNum&&anyNum[1]?\"\\u0E20\\u0E32\\u0E04 \".concat(anyNum[1]):'ภาค';}}}else if(lower.includes('ศูนย์รักษาความปลอดภัย')){normalized='ส่วนกลาง';}else if(lower.includes('กรุงเทพ')||lower.includes('กรุงเทพมหานคร')||lower.includes('ศาลชั้นต้นในกรุงเทพมหานคร')){normalized='กทม.';}else{// fallback to any exact mapping we defined, otherwise keep original\nnormalized=affiliationAbbreviations[affiliation]||affiliation;}acc[normalized]=(acc[normalized]||0)+1;return acc;},{});},[personnelData]);const chartData=useMemo(()=>{const entries=Object.entries(filteredAffiliationData).map(_ref1=>{let[label,value]=_ref1;return{label,value};});const getOrderKey=label=>{if(!label)return 9999;const l=String(label).trim();// Match 'ภาค' followed by number e.g. 'ภาค 1' or 'ภาค1'\nconst m=l.match(/ภาค\\s*(\\d{1,3})/);if(m&&m[1]){// Put ภาค N in order 0.. (keep N small)\nconst num=parseInt(m[1],10);return num;// 1..9 -> 1..9 (smaller is earlier)\n}// If label is exactly 'ภาค' (no number), put after numbered ภาค\nif(/^ภาค$/i.test(l))return 999;// Specific named orders after ภาค group\nif(l==='กทม.'||l.toLowerCase()==='กทม.')return 1000;if(l==='ส่วนกลาง'||l.toLowerCase()==='ส่วนกลาง')return 1001;if(l.includes('ศาลสูง'))return 1002;// handle both spellings 'ชำนาญ' and 'ชำนัญ'\nif(l.includes('ชำนาญ')||l.includes('ชำนัญ')||l.includes('ชำนัญพิเศษ')||l.includes('ชำนาญพิเศษ'))return 1003;// Default: place after known groups but preserve alphabetical order by returning a high key plus name\nreturn 5000+l.charCodeAt(0);};entries.sort((a,b)=>{const ka=getOrderKey(a.label);const kb=getOrderKey(b.label);if(ka===kb){// fallback alphabetical\nreturn String(a.label).localeCompare(String(b.label));}return ka-kb;});return entries;},[filteredAffiliationData]);const stats=useMemo(()=>{const newStats={total:personnelData.length,connected:personnelData.filter(p=>p.lineUserId).length,byPosition:{},byAffiliation:{},byDepartment:{},byGeneration:{}};personnelData.forEach(person=>{const position=person.position||'ไม่ระบุ';newStats.byPosition[position]=(newStats.byPosition[position]||0)+1;const affiliation=person.affiliation||'ไม่ระบุ';newStats.byAffiliation[affiliation]=(newStats.byAffiliation[affiliation]||0)+1;const department=person.deph||'ไม่ระบุตำแหน่ง';newStats.byDepartment[department]=(newStats.byDepartment[department]||0)+1;const generation=person.generation?String(person.generation).trim():'ไม่ระบุตำแหน่ง';newStats.byGeneration[generation]=(newStats.byGeneration[generation]||0)+1;});return newStats;},[personnelData]);useEffect(()=>{console.log(\"Personnel Data:\",personnelData);},[personnelData]);useEffect(()=>{console.log(\"Stats:\",stats);console.log(\"Chart Data:\",chartData);},[stats,chartData]);const chartColors=[\"#FF6384\",\"#36A2EB\",\"#FFCE56\",\"#4BC0C0\",\"#9966FF\",\"#FF9F40\",\"#FFCD56\",\"#C9CBCF\"];// Helper: build chart data for different types (inside component)\nconst getChartData=useCallback(type=>{if(type==='affiliation')return chartData;// already normalized affiliation entries\nif(type==='position'){// build from stats.byPosition\nconst entries=Object.entries(stats.byPosition||{}).map(_ref10=>{let[label,value]=_ref10;return{label,value};});// sort by value desc\nentries.sort((a,b)=>b.value-a.value);return entries;}if(type==='age'){// derive age groups from dob (basic)\nconst groups={'<30':0,'30-39':0,'40-49':0,'50-59':0,'60+':0};const now=new Date();personnelData.forEach(p=>{if(!p.dob)return;const m=String(p.dob).match(/(\\d{4})/);if(!m)return;const year=parseInt(m[1],10);if(isNaN(year))return;const age=now.getFullYear()-year;if(age<30)groups['<30']++;else if(age<40)groups['30-39']++;else if(age<50)groups['40-49']++;else if(age<60)groups['50-59']++;else groups['60+']++;});return Object.entries(groups).map(_ref11=>{let[label,value]=_ref11;return{label,value};});}if(type==='gender'){// no gender field in data - return empty to show no data\nconst genders=(personnelData||[]).reduce((acc,p)=>{const g=(p.gender||'').trim();if(!g)return acc;acc[g]=(acc[g]||0)+1;return acc;},{});return Object.entries(genders).map(_ref12=>{let[label,value]=_ref12;return{label,value};});}return[];},[chartData,stats,personnelData]);const renderChart=()=>{switch(selectedChart){case\"position\":return/*#__PURE__*/_jsx(HorizontalBarChart,{data:getChartData('position'),colors:chartColors,title:\"\\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07\",maxHeight:\"320px\"});case\"affiliation\":return/*#__PURE__*/_jsx(HorizontalBarChart,{data:getChartData('affiliation'),colors:chartColors,title:\"\\u0E2A\\u0E31\\u0E14\\u0E2A\\u0E48\\u0E27\\u0E19\\u0E41\\u0E15\\u0E48\\u0E25\\u0E30\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\",maxHeight:\"320px\"});case\"gender\":return/*#__PURE__*/_jsx(PieChartComponent,{data:getChartData('gender'),colors:chartColors,title:\"\\u0E40\\u0E1E\\u0E28\"});case\"age\":return/*#__PURE__*/_jsx(HorizontalBarChart,{data:getChartData('age'),colors:chartColors,title:\"\\u0E0A\\u0E48\\u0E27\\u0E07\\u0E2D\\u0E32\\u0E22\\u0E38\",maxHeight:\"240px\"});default:return/*#__PURE__*/_jsx(\"p\",{children:\"\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E41\\u0E2A\\u0E14\\u0E07\\u0E1C\\u0E25\"});}};return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-7xl mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-slate-800\",children:\"\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E1A\\u0E38\\u0E04\\u0E25\\u0E32\\u0E01\\u0E23\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-3\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowSearchModal(true),className:\"flex items-center space-x-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow\",children:[/*#__PURE__*/_jsx(Search,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0E04\\u0E49\\u0E19\\u0E2B\\u0E32\\u0E1A\\u0E38\\u0E04\\u0E25\\u0E32\\u0E01\\u0E23\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\",children:[/*#__PURE__*/_jsx(EditableCard,{title:\"\\u0E01\\u0E23\\u0E2D\\u0E1A\\u0E2D\\u0E31\\u0E15\\u0E23\\u0E32\",value:quota,icon:Briefcase,color:\"blue\",isEditing:isEditingQuota,onEdit:()=>setIsEditingQuota(!isEditingQuota),onChange:value=>setQuota(value),isAdmin:(user===null||user===void 0?void 0:user.role)==='admin'}),/*#__PURE__*/_jsx(EditableCard,{title:\"\\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07\\u0E27\\u0E48\\u0E32\\u0E07\",value:vacancy,icon:UserX,color:\"red\",isEditing:isEditingVacancy,onEdit:()=>setIsEditingVacancy(!isEditingVacancy),onChange:value=>setVacancy(value),isAdmin:(user===null||user===void 0?void 0:user.role)==='admin'}),/*#__PURE__*/_jsx(StatCard,{title:\"\\u0E1A\\u0E38\\u0E04\\u0E25\\u0E32\\u0E01\\u0E23\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\",value:stats.total,icon:Users,color:\"green\",subtitle:\"\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\\u0E43\\u0E19\\u0E23\\u0E30\\u0E1A\\u0E1A\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4 mb-6\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedChart(\"position\"),className:\"px-4 py-2 rounded-lg \".concat(selectedChart===\"position\"?\"bg-indigo-600 text-white\":\"bg-gray-200 text-gray-800\"),children:\"\\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedChart(\"affiliation\"),className:\"px-4 py-2 rounded-lg \".concat(selectedChart===\"affiliation\"?\"bg-indigo-600 text-white\":\"bg-gray-200 text-gray-800\"),children:\"\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedChart(\"gender\"),className:\"px-4 py-2 rounded-lg \".concat(selectedChart===\"gender\"?\"bg-indigo-600 text-white\":\"bg-gray-200 text-gray-800\"),children:\"\\u0E40\\u0E1E\\u0E28\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedChart(\"age\"),className:\"px-4 py-2 rounded-lg \".concat(selectedChart===\"age\"?\"bg-indigo-600 text-white\":\"bg-gray-200 text-gray-800\"),children:\"\\u0E0A\\u0E48\\u0E27\\u0E07\\u0E2D\\u0E32\\u0E22\\u0E38\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow border border-slate-200 p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-slate-800 mb-4\",children:\"\\u0E01\\u0E23\\u0E32\\u0E1F\\u0E41\\u0E17\\u0E48\\u0E07\"}),/*#__PURE__*/_jsx(HorizontalBarChart,{data:getChartData('affiliation'),colors:chartColors,title:\"\\u0E2A\\u0E31\\u0E14\\u0E2A\\u0E48\\u0E27\\u0E19\\u0E41\\u0E15\\u0E48\\u0E25\\u0E30\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\",maxHeight:\"500px\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow border border-slate-200 p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-slate-800 mb-4\",children:\"\\u0E01\\u0E23\\u0E32\\u0E1F\\u0E27\\u0E07\\u0E01\\u0E25\\u0E21\"}),/*#__PURE__*/_jsx(PieChartComponent,{data:getChartData('affiliation'),colors:chartColors,title:\"\\u0E2A\\u0E31\\u0E14\\u0E2A\\u0E48\\u0E27\\u0E19\\u0E41\\u0E15\\u0E48\\u0E25\\u0E30\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow border border-slate-200 p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-slate-800 mb-4\",children:\"\\u0E01\\u0E23\\u0E32\\u0E1F\\u0E42\\u0E14\\u0E19\\u0E31\\u0E17\"}),/*#__PURE__*/_jsx(DonutChart,{data:getChartData('affiliation'),colors:chartColors,title:\"\\u0E2A\\u0E31\\u0E14\\u0E2A\\u0E48\\u0E27\\u0E19\\u0E41\\u0E15\\u0E48\\u0E25\\u0E30\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow border border-slate-200 p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-slate-800 mb-4\",children:\"\\u0E01\\u0E23\\u0E32\\u0E1F\\u0E40\\u0E2A\\u0E49\\u0E19\"}),/*#__PURE__*/_jsx(LineChart,{data:getChartData('affiliation'),colors:chartColors,title:\"\\u0E2A\\u0E31\\u0E14\\u0E2A\\u0E48\\u0E27\\u0E19\\u0E41\\u0E15\\u0E48\\u0E25\\u0E30\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\"})]})]}),/*#__PURE__*/_jsx(PersonnelDetailModal,{person:selectedPerson,isOpen:showDetail,onClose:()=>setShowDetail(false)}),/*#__PURE__*/_jsx(SearchModal,{isOpen:showSearchModal,onClose:()=>setShowSearchModal(false),personnelData:personnelData,stats:stats,onViewPerson:handleViewPerson,onExport:exportToCSV,user:user})]});}","map":{"version":3,"names":["React","useEffect","useState","useMemo","useCallback","memo","Search","Filter","Users","Phone","Mail","Calendar","Award","Building2","UserCheck","UserX","TrendingUp","PieChart","BarChart3","Download","RefreshCw","Eye","Grid3X3","List","X","AlertCircle","CheckCircle2","Clock","Briefcase","GraduationCap","Edit2","Save","CONFIG","DonutChart","LineChart","jsx","_jsx","jsxs","_jsxs","StatCard","_ref","title","value","icon","Icon","color","trend","subtitle","className","children","concat","TableChart","_ref2","data","colors","total","reduce","sum","d","slice","map","item","index","percentage","toFixed","length","style","backgroundColor","label","truncatePosition","position","removePatterns","result","pattern","replace","RegExp","trim","truncateAffiliation","affiliation","lower","toLowerCase","includes","TreemapChart","_ref3","originalTotal","scaledData","_objectSpread","scaledValue","Math","log1p","generateTreemapLayout","items","width","height","rects","layoutRow","rowItems","x","y","w","h","totalValue","i","offset","isHorizontal","rectWidth","push","rectHeight","squarify","halfValue","runningTotal","splitIndex","max","groupA","groupB","groupATotal","groupAWidth","groupAHeight","layout","rect","itemIndex","findIndex","valueText","fontSize","min","textShadowStyle","textShadow","left","top","transition","PieChartComponent","_ref4","viewBox","angle","prevPercentage","startAngle","endAngle","outerRadius","innerRadius","startXOuter","cos","PI","startYOuter","sin","endXOuter","endYOuter","startXInner","startYInner","endXInner","endYInner","largeArcFlag","pathData","join","pieColors","midAngle","labelRadius","labelX","labelY","percentageText","fill","stroke","strokeWidth","textAnchor","dominantBaseline","fontWeight","paintOrder","HorizontalBarChart","_ref5","maxHeight","getSortOrder","regionMatch","match","parseInt","customOrder","sortedData","sort","a","b","maxValue","overflowY","paddingRight","barWidth","minWidth","EditableCard","_ref6","isEditing","onEdit","onChange","isAdmin","localValue","setLocalValue","handleChange","e","newValue","target","onClick","type","PersonnelDetailModal","_ref7","person","isOpen","onClose","firstname","charAt","lastname","prefix","phone","href","email","deph","dob","lineUserId","role","PersonCard","_ref8","onView","onCall","onMail","SearchModal","_ref9","personnelData","stats","onViewPerson","onExport","user","query","setQuery","filterAff","setFilterAff","filterPos","setFilterPos","affiliations","setAff","Set","forEach","p","add","Array","from","positions","s","results","filter","hay","handleCall","tel","window","open","handleMail","clearFilters","placeholder","PersonnelPage","_ref0","loading","setLoading","refreshing","setRefreshing","error","setError","setPersonnelData","selectedPerson","setSelectedPerson","showDetail","setShowDetail","showSearchModal","setShowSearchModal","quota","setQuota","vacancy","setVacancy","isEditingQuota","setIsEditingQuota","isEditingVacancy","setIsEditingVacancy","selectedChart","setSelectedChart","filters","setFilters","department","ageRange","gender","logAdminActivity","action","details","fetch","ADMIN_API","method","headers","body","JSON","stringify","log_action","log_details","user_id","id","username","catch","console","fetchPersonnelData","apiUrl","OFFICERS_API","response","ok","Error","status","text","parse","success","isArray","formattedData","generation","message","handleRefresh","finally","handleViewPerson","exportToCSV","affiliationAbbreviations","filteredAffiliationData","acc","normalized","matchRegion","trailingNum","anyNum","chartData","entries","Object","_ref1","getOrderKey","l","String","m","num","test","charCodeAt","ka","kb","localeCompare","newStats","connected","byPosition","byAffiliation","byDepartment","byGeneration","log","chartColors","getChartData","_ref10","groups","now","Date","year","isNaN","age","getFullYear","_ref11","genders","g","_ref12","renderChart"],"sources":["C:/Users/LENOVO/Documents/GitHub/court-marshal-connect/src/pages/PersonnelPage.js"],"sourcesContent":["import React, { useEffect, useState, useMemo, useCallback, memo } from \"react\";\r\nimport { \r\n  Search, \r\n  Filter, \r\n  Users, \r\n  Phone, \r\n  Mail, \r\n  Calendar,\r\n  Award,\r\n  Building2,\r\n  UserCheck,\r\n  UserX,\r\n  TrendingUp,\r\n  PieChart,\r\n  BarChart3,\r\n  Download,\r\n  RefreshCw,\r\n  Eye,\r\n  Grid3X3,\r\n  List,\r\n  X,\r\n  AlertCircle,\r\n  CheckCircle2,\r\n  Clock,\r\n  Briefcase,\r\n  GraduationCap,\r\n  Edit2,\r\n  Save\r\n} from \"lucide-react\";\r\nimport { CONFIG } from '../config';\r\nimport DonutChart from '../components/DonutChart';\r\nimport LineChart from '../components/LineChart';\r\n\r\n\r\n\r\n// StatCard Component\r\nconst StatCard = memo(({ title, value, icon: Icon, color = \"blue\", trend, subtitle }) => (\r\n  <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\r\n    <div className=\"flex items-center justify-between mb-2\">\r\n      <div className={`w-12 h-12 bg-${color}-100 rounded-xl flex items-center justify-center`}>\r\n        <Icon className={`w-6 h-6 text-${color}-600`} />\r\n      </div>\r\n      {trend && (\r\n        <div className=\"flex items-center text-green-600 text-sm\">\r\n          <TrendingUp className=\"w-4 h-4 mr-1\" />\r\n          <span>{trend}%</span>\r\n        </div>\r\n      )}\r\n    </div>\r\n    <div className=\"text-3xl font-bold text-slate-900 mb-1\">{value}</div>\r\n    <div className=\"text-sm text-slate-600\">{title}</div>\r\n    {subtitle && (\r\n      <div className=\"text-xs text-slate-500 mt-1\">{subtitle}</div>\r\n    )}\r\n  </div>\r\n));\r\n\r\n// Table Chart Component (สำหรับแสดงข้อมูลตำแหน่งแบบตาราง)\r\nconst TableChart = memo(({ title, data, colors = [] }) => {\r\n  const total = useMemo(() => data.reduce((sum, d) => sum + d.value, 0), [data]);\r\n  \r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\r\n      <h3 className=\"text-lg font-semibold text-slate-900 mb-4 flex items-center\">\r\n        <BarChart3 className=\"w-5 h-5 mr-2 text-slate-400\" />\r\n        {title}\r\n      </h3>\r\n      <div className=\"space-y-3\">\r\n        <div className=\"text-center mb-4\">\r\n          <div className=\"text-2xl font-bold text-slate-900\">{total}</div>\r\n          <div className=\"text-sm text-slate-500\">ทั้งหมด</div>\r\n        </div>\r\n        \r\n        <div className=\"grid gap-2\">\r\n          {data.slice(0, 8).map((item, index) => {\r\n            const percentage = ((item.value / total) * 100).toFixed(1);\r\n            const color = colors[index % colors.length] || '#6366f1';\r\n            \r\n            return (\r\n              <div key={`${item.label}-${index}`} className=\"flex items-center justify-between p-3 bg-slate-50 rounded-lg\">\r\n                <div className=\"flex items-center space-x-3 flex-1 min-w-0\">\r\n                  <div \r\n                    className=\"w-4 h-4 rounded-sm flex-shrink-0\"\r\n                    style={{ backgroundColor: color }}\r\n                  />\r\n                  <span className=\"text-sm text-slate-700 font-medium truncate\" title={item.label}>\r\n                    {item.label}\r\n                  </span>\r\n                </div>\r\n                <div className=\"flex items-center space-x-2 text-right\">\r\n                  <div className=\"text-sm font-bold text-slate-900\">{item.value}</div>\r\n                  <div className=\"text-xs text-slate-500\">{percentage}%</div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// Function สำหรับตัดคำยาว\r\nconst truncatePosition = (position) => {\r\n  if (!position) return '';\r\n  \r\n  const removePatterns = [\r\n    'เจ้าพนักงานตำรวจศาล',\r\n    'ตำรวจศาล',\r\n    'ตำรวจ',\r\n    'พนักงาน'\r\n  ];\r\n  \r\n  let result = position;\r\n  for (const pattern of removePatterns) {\r\n    result = result.replace(new RegExp(pattern, 'gi'), '');\r\n  }\r\n  \r\n  return result.trim() || position;\r\n};\r\n\r\n// Function สำหรับตัดคำ \"ศาล\" ออกจากสังกัด\r\nconst truncateAffiliation = (affiliation) => {\r\n  if (!affiliation) return '';\r\n  const lower = affiliation.toLowerCase();\r\n\r\n  // Only remove the leading word 'ศาล' for affiliations that describe\r\n  // 'ในสังกัดสำนักยุติธรรมประจำภาค' (or variants). Do not strip 'ศาล'\r\n  // from other court names like 'ศาลสูง' or 'ศาลชำนาญพิเศษ'.\r\n  if (lower.includes('ในสังกัดสำนักยุติธรรมประจำภาค') || lower.includes('ในสังกัดสำนักยุติธรรม')) {\r\n    return affiliation.replace(/^ศาล\\s*/i, '').trim() || affiliation;\r\n  }\r\n\r\n  // Otherwise return affiliation unchanged\r\n  return affiliation;\r\n};\r\n\r\n// --- NEW: Proportional Treemap Chart Component ---\r\n// --- NEW: Proportional Treemap Chart Component (MODIFIED FOR LOGARITHMIC SCALE) ---\r\nconst TreemapChart = memo(({ title, data, colors = [] }) => {\r\n  // --- ส่วนที่แก้ไข: คำนวณ total จากค่าจริงก่อนแปลงสเกล ---\r\n  const originalTotal = useMemo(() => data.reduce((sum, d) => sum + d.value, 0), [data]);\r\n\r\n  // --- ส่วนที่แก้ไข: สร้างข้อมูลชุดใหม่ที่มีการปรับสเกลด้วย Math.log1p ---\r\n  // Math.log1p(x) จะคำนวณ log(1+x) ช่วยให้ค่าที่น้อยๆ มีขนาดใหญ่ขึ้นเมื่อเทียบกับค่ามากๆ\r\n  const scaledData = useMemo(() => data.map(item => ({\r\n    ...item,\r\n    scaledValue: Math.log1p(item.value) \r\n  })), [data]);\r\n\r\n  const generateTreemapLayout = useCallback((items, width, height) => {\r\n    let rects = [];\r\n    const layoutRow = (rowItems, x, y, w, h) => {\r\n      if (!rowItems.length) return;\r\n      // --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\r\n      const totalValue = rowItems.reduce((sum, i) => sum + i.scaledValue, 0);\r\n      if (totalValue === 0) return;\r\n      let offset = 0;\r\n      const isHorizontal = w > h;\r\n      for (const item of rowItems) {\r\n        // --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\r\n        const percentage = item.scaledValue / totalValue;\r\n        if (isHorizontal) {\r\n          const rectWidth = w * percentage;\r\n          rects.push({ x: x + offset, y, width: rectWidth, height: h, item });\r\n          offset += rectWidth;\r\n        } else {\r\n          const rectHeight = h * percentage;\r\n          rects.push({ x, y: y + offset, width: w, height: rectHeight, item });\r\n          offset += rectHeight;\r\n        }\r\n      }\r\n    };\r\n    const squarify = (items, x, y, w, h) => {\r\n      if (!items.length) return;\r\n      if (items.length <= 4) {\r\n        layoutRow(items, x, y, w, h);\r\n        return;\r\n      }\r\n      // --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\r\n      const halfValue = items.reduce((sum, i) => sum + i.scaledValue, 0) / 2;\r\n      let runningTotal = 0;\r\n      let splitIndex = 0;\r\n      for (let i = 0; i < items.length; i++) {\r\n        // --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\r\n        runningTotal += items[i].scaledValue;\r\n        if (runningTotal >= halfValue) {\r\n          splitIndex = i + 1;\r\n          break;\r\n        }\r\n      }\r\n      splitIndex = Math.max(1, splitIndex);\r\n      const groupA = items.slice(0, splitIndex);\r\n      const groupB = items.slice(splitIndex);\r\n      const groupATotal = groupA.reduce((sum, i) => sum + i.scaledValue, 0);\r\n      const totalValue = groupATotal + (groupB.reduce((sum, i) => sum + i.scaledValue, 0));\r\n\r\n      if (totalValue === 0) return;\r\n      if (w > h) {\r\n        const groupAWidth = w * (groupATotal / totalValue);\r\n        squarify(groupA, x, y, groupAWidth, h);\r\n        squarify(groupB, x + groupAWidth, y, w - groupAWidth, h);\r\n      } else {\r\n        const groupAHeight = h * (groupATotal / totalValue);\r\n        squarify(groupA, x, y, w, groupAHeight);\r\n        squarify(groupB, x, y + groupAHeight, w, h - groupAHeight);\r\n      }\r\n    };\r\n    squarify(items, 0, 0, 1000, 1000); // Use a relative base for layout\r\n    return rects;\r\n  }, []);\r\n\r\n  // --- ส่วนที่แก้ไข: ส่ง scaledData เข้าไปคำนวณ layout ---\r\n  const layout = useMemo(() => generateTreemapLayout(scaledData), [scaledData, generateTreemapLayout]);\r\n\r\n  if (!data.length || originalTotal === 0) {\r\n    return (\r\n      <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 h-full\">\r\n        <h3 className=\"text-lg font-semibold text-slate-900 mb-4 flex items-center\"><BarChart3 className=\"w-5 h-5 mr-2 text-slate-400\" />{title}</h3>\r\n        <div className=\"text-center py-8\"><p className=\"text-slate-500\">ไม่มีข้อมูลสำหรับแสดงกราฟ</p></div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 flex flex-col h-full\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h3 className=\"text-lg font-semibold text-slate-900 flex items-center\">\r\n          <BarChart3 className=\"w-5 h-5 mr-2 text-slate-400\" />{title}\r\n        </h3>\r\n        <div className=\"text-right\">\r\n          {/* --- ส่วนที่แก้ไข: แสดงผลรวมจากค่าจริง --- */}\r\n          <div className=\"text-lg font-bold text-slate-900\">{originalTotal}</div>\r\n          <div className=\"text-xs text-slate-500\">ทั้งหมด</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"relative w-full flex-1\">\r\n        {layout.map((rect) => {\r\n          const itemIndex = scaledData.findIndex(d => d.label === rect.item.label);\r\n          const color = colors[itemIndex % colors.length];\r\n          \r\n          // --- ส่วนที่แก้ไข: คำนวณ % จากค่าจริง ---\r\n          const percentage = originalTotal > 0 ? ((rect.item.value / originalTotal) * 100).toFixed(1) : 0;\r\n          const valueText = `${rect.item.value} (${percentage}%)`;\r\n          const fontSize = Math.min(rect.width / 10, rect.height / 5, 16);\r\n          const textShadowStyle = { textShadow: '0px 1px 3px rgba(0, 0, 0, 0.6)' };\r\n\r\n          return (\r\n            <div\r\n              key={rect.item.label}\r\n              className=\"absolute border-2 border-white rounded-md flex flex-col items-center justify-center p-1 overflow-hidden text-center\"\r\n              style={{\r\n                left: `${rect.x / 10}%`, top: `${rect.y / 10}%`, width: `${rect.width / 10}%`, height: `${rect.height / 10}%`,\r\n                backgroundColor: color, transition: 'all 0.4s ease-in-out'\r\n              }}\r\n            >\r\n              <div className=\"text-white font-bold\" style={{ fontSize: `${fontSize}px`, ...textShadowStyle }}>\r\n                {valueText}\r\n              </div>\r\n              <div className=\"text-white opacity-90 leading-tight\" style={{ fontSize: `${Math.max(fontSize * 0.7, 10)}px`, ...textShadowStyle }}>\r\n                {rect.item.label}\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// Pie Chart Component - เปลี่ยนเป็น Donut Chart\r\nconst PieChartComponent = memo(({ title, data, colors = [] }) => {\r\n  const total = useMemo(() => data.reduce((sum, d) => sum + d.value, 0), [data]);\r\n  \r\n  if (!data.length || total === 0) {\r\n    return (\r\n      <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\r\n        <h3 className=\"text-lg font-semibold text-slate-900 mb-4 flex items-center\">\r\n          <PieChart className=\"w-5 h-5 mr-2 text-slate-400\" />\r\n          {title}\r\n        </h3>\r\n        <div className=\"text-center py-8\">\r\n          <p className=\"text-slate-500\">ไม่มีข้อมูลสำหรับแสดงกราฟ</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 h-fit\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h3 className=\"text-lg font-semibold text-slate-900 flex items-center\">\r\n          <PieChart className=\"w-5 h-5 mr-2 text-slate-400\" />\r\n          {title}\r\n        </h3>\r\n        <div className=\"text-right\">\r\n          <div className=\"text-lg font-bold text-slate-900\">จำนวน {total} คน</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"relative border border-slate-200 rounded-lg p-4 bg-slate-50\">\r\n        <div className=\"flex flex-col items-center\">\r\n          {/* Donut Chart */}\r\n          <div className=\"relative w-48 h-48\">\r\n            <svg width=\"192\" height=\"192\" viewBox=\"0 0 192 192\" className=\"w-full h-full\">\r\n              {data.map((item, index) => {\r\n                const percentage = item.value / total;\r\n                const angle = percentage * 360;\r\n                \r\n                const prevPercentage = data.slice(0, index).reduce((sum, d) => sum + d.value, 0) / total;\r\n                const startAngle = prevPercentage * 360 - 90;\r\n                const endAngle = startAngle + angle;\r\n                \r\n                // Donut chart - outer radius 80, inner radius 45\r\n                const outerRadius = 80;\r\n                const innerRadius = 45;\r\n                \r\n                const startXOuter = 96 + outerRadius * Math.cos((startAngle * Math.PI) / 180);\r\n                const startYOuter = 96 + outerRadius * Math.sin((startAngle * Math.PI) / 180);\r\n                const endXOuter = 96 + outerRadius * Math.cos((endAngle * Math.PI) / 180);\r\n                const endYOuter = 96 + outerRadius * Math.sin((endAngle * Math.PI) / 180);\r\n                \r\n                const startXInner = 96 + innerRadius * Math.cos((endAngle * Math.PI) / 180);\r\n                const startYInner = 96 + innerRadius * Math.sin((endAngle * Math.PI) / 180);\r\n                const endXInner = 96 + innerRadius * Math.cos((startAngle * Math.PI) / 180);\r\n                const endYInner = 96 + innerRadius * Math.sin((startAngle * Math.PI) / 180);\r\n                \r\n                const largeArcFlag = angle > 180 ? 1 : 0;\r\n                \r\n                const pathData = [\r\n                  'M', startXOuter, startYOuter,\r\n                  'A', outerRadius, outerRadius, 0, largeArcFlag, 1, endXOuter, endYOuter,\r\n                  'L', startXInner, startYInner,\r\n                  'A', innerRadius, innerRadius, 0, largeArcFlag, 0, endXInner, endYInner,\r\n                  'Z'\r\n                ].join(' ');\r\n                \r\n                const pieColors = [\r\n                  '#8b5cf6', '#ec4899', '#06b6d4', '#10b981', '#f59e0b', \r\n                  '#ef4444', '#84cc16', '#6366f1', '#f97316', '#14b8a6'\r\n                ];\r\n                const color = pieColors[index % pieColors.length];\r\n                \r\n                // คำนวณตำแหน่งสำหรับแสดง percentage\r\n                const midAngle = startAngle + (angle / 2);\r\n                const labelRadius = 90;\r\n                const labelX = 96 + labelRadius * Math.cos((midAngle * Math.PI) / 180);\r\n                const labelY = 96 + labelRadius * Math.sin((midAngle * Math.PI) / 180);\r\n                const percentageText = `${(percentage * 100).toFixed(1)}%`;\r\n                \r\n                return (\r\n                  <g key={`donut-${index}`}>\r\n                    <path\r\n                      d={pathData}\r\n                      fill={color}\r\n                      stroke=\"white\"\r\n                      strokeWidth=\"2\"\r\n                    />\r\n                    {/* แสดง percentage ที่ขอบวงกลม */}\r\n                    {percentage > 0.05 && (\r\n                      <text\r\n                        x={labelX}\r\n                        y={labelY}\r\n                        textAnchor=\"middle\"\r\n                        dominantBaseline=\"middle\"\r\n                        fill=\"#1e293b\"\r\n                        fontSize=\"10\"\r\n                        fontWeight=\"bold\"\r\n                        stroke=\"white\"\r\n                        strokeWidth=\"2\"\r\n                        paintOrder=\"stroke\"\r\n                      >\r\n                        {percentageText}\r\n                      </text>\r\n                    )}\r\n                  </g>\r\n                );\r\n              })}\r\n            </svg>\r\n          </div>\r\n          \r\n          {/* Legend */}\r\n          <div className=\"w-full mt-6\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2\">\r\n              {data.map((item, index) => {\r\n                const percentage = ((item.value / total) * 100).toFixed(0);\r\n                const pieColors = [\r\n                  '#8b5cf6', '#ec4899', '#06b6d4', '#10b981', '#f59e0b', \r\n                  '#ef4444', '#84cc16', '#6366f1', '#f97316', '#14b8a6'\r\n                ];\r\n                const color = pieColors[index % pieColors.length];\r\n                \r\n                return (\r\n                  <div key={`legend-${item.label}-${index}`} className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center space-x-2 min-w-0 flex-1\">\r\n                      <div \r\n                        className=\"w-3 h-3 rounded-full flex-shrink-0\"\r\n                        style={{ backgroundColor: color }}\r\n                      />\r\n                      <span className=\"text-sm text-slate-700\">\r\n                        {truncateAffiliation(item.label)} <span className=\"font-bold text-slate-900\">{item.value}</span> คน\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"text-sm font-bold text-slate-900 ml-2\">{percentage}%</div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// Horizontal Bar Chart Component\r\nconst HorizontalBarChart = memo(({ title, data, colors = [], maxHeight = '320px' }) => {\r\n  \r\n  const getSortOrder = (label) => {\r\n    const regionMatch = label.match(/ภาค\\s*(\\d+)/);\r\n    if (regionMatch) return parseInt(regionMatch[1]);\r\n    const customOrder = ['ศาลชั้นต้นในเขตกรุงเทพมหานคร', 'ศูนย์รักษาความปลอดภัย', 'ศาลชำนาญพิเศษ', 'ศาลสูง'];\r\n    const index = customOrder.findIndex(item => label.includes(item));\r\n    if (index !== -1) return 100 + index;\r\n    return 999;\r\n  };\r\n\r\n  const sortedData = useMemo(() => \r\n    [...data].sort((a, b) => getSortOrder(a.label) - getSortOrder(b.label)), \r\n    [data]\r\n  );\r\n  \r\n  const maxValue = useMemo(() => {\r\n    if (!sortedData || sortedData.length === 0) return 0;\r\n    return Math.max(...sortedData.map(d => d.value));\r\n  }, [sortedData]);\r\n\r\n  if (!sortedData.length || maxValue === 0) {\r\n    return (\r\n      <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\r\n        <h3 className=\"text-lg font-semibold text-slate-900 mb-4 flex items-center\"><BarChart3 className=\"w-5 h-5 mr-2 text-slate-400\" />{title}</h3>\r\n        <div className=\"text-center py-8\"><p className=\"text-slate-500\">ไม่มีข้อมูลสำหรับแสดงกราฟ</p></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-4 shadow-sm border border-slate-200\">\r\n      <h3 className=\"text-lg font-semibold text-slate-900 mb-3 flex items-center\"><BarChart3 className=\"w-5 h-5 mr-2 text-slate-400\" />{title}</h3>\r\n      <div className=\"space-y-2\" style={{ maxHeight, overflowY: 'auto', paddingRight: 8 }}>\r\n        {sortedData.map((item, index) => {\r\n          const barWidth = (item.value / maxValue) * 100;\r\n          const color = colors[index % colors.length] || '#8b5cf6';\r\n          \r\n          return (\r\n            <div key={`${item.label}-${index}`} className=\"grid grid-cols-3 gap-2 items-center\">\r\n              {/* Left Column for Full Label (CHANGED to text-left) */}\r\n              <div className=\"col-span-1 text-sm text-slate-700 font-medium text-left truncate\" title={item.label}>\r\n                {item.label}\r\n              </div>\r\n              \r\n              {/* Right Column for Bar */}\r\n              <div className=\"col-span-2 w-full bg-slate-100 rounded-full h-7 relative\">\r\n                <div\r\n                  className=\"h-7 rounded-full transition-all duration-700 flex items-center justify-end pr-3\"\r\n                  style={{\r\n                    width: `${barWidth}%`, backgroundColor: color, minWidth: '36px'\r\n                  }}\r\n                >\r\n                   <span className=\"text-white text-sm font-bold\">{item.value}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// (moved into the PersonnelPage component to avoid calling hooks at top level)\r\n\r\n// EditableCard Component (restored minimal implementation)\r\nconst EditableCard = memo(({ title, value, icon: Icon, color = \"blue\", isEditing, onEdit, onChange, isAdmin }) => {\r\n  const [localValue, setLocalValue] = useState(value);\r\n\r\n  useEffect(() => {\r\n    setLocalValue(value);\r\n  }, [value]);\r\n\r\n  const handleChange = (e) => {\r\n    const newValue = parseInt(e.target.value) || 0;\r\n    setLocalValue(newValue);\r\n    onChange(newValue);\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\r\n      <div className=\"flex items-center justify-between mb-2\">\r\n        <div className={`w-12 h-12 bg-${color}-100 rounded-xl flex items-center justify-center`}>\r\n          {Icon && <Icon className={`w-6 h-6 text-${color}-600`} />}\r\n        </div>\r\n        {isAdmin && (\r\n          <button\r\n            onClick={onEdit}\r\n            className=\"text-slate-400 hover:text-slate-600 transition-colors\"\r\n          >\r\n            {isEditing ? <Save className=\"w-5 h-5\" /> : <Edit2 className=\"w-5 h-5\" />}\r\n          </button>\r\n        )}\r\n      </div>\r\n      {isEditing ? (\r\n        <input\r\n          type=\"number\"\r\n          value={localValue}\r\n          onChange={handleChange}\r\n          className=\"w-full text-3xl font-bold text-slate-900 mb-1 bg-slate-50 border border-slate-200 rounded px-2 py-1\"\r\n          min=\"0\"\r\n        />\r\n      ) : (\r\n        <div className=\"text-3xl font-bold text-slate-900 mb-1\">{localValue}</div>\r\n      )}\r\n      <div className=\"text-sm text-slate-600\">{title}</div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// PersonnelDetailModal (minimal)\r\nconst PersonnelDetailModal = memo(({ person, isOpen, onClose }) => {\r\n  if (!isOpen || !person) return null;\r\n  return (\r\n    <div className=\"fixed inset-0 z-60 overflow-y-auto bg-black/40\">\r\n      <div className=\"flex min-h-screen items-center justify-center p-4\">\r\n        <div className=\"relative bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6\">\r\n          <div className=\"flex items-start justify-between mb-4\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              <div className=\"w-16 h-16 rounded-full bg-slate-100 flex items-center justify-center text-xl font-bold text-slate-600\">{(person.firstname||'').charAt(0)}{(person.lastname||'').charAt(0)}</div>\r\n              <div>\r\n                <div className=\"text-lg font-semibold\">{person.prefix} {person.firstname} {person.lastname}</div>\r\n                <div className=\"text-sm text-slate-500\">{person.position || '-'} • {person.affiliation || '-'}</div>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center space-x-2\">\r\n              {person.phone && (\r\n                <a href={`tel:${person.phone}`} className=\"flex items-center gap-2 px-3 py-1 bg-slate-100 rounded text-sm\" title=\"โทร\">\r\n                  <Phone className=\"w-4 h-4 text-slate-600\" />\r\n                  <span>โทร</span>\r\n                </a>\r\n              )}\r\n              {person.email && (\r\n                <a href={`mailto:${person.email}`} className=\"flex items-center gap-2 px-3 py-1 bg-slate-100 rounded text-sm\" title=\"อีเมล\">\r\n                  <Mail className=\"w-4 h-4 text-slate-600\" />\r\n                  <span>อีเมล</span>\r\n                </a>\r\n              )}\r\n              <button onClick={onClose} className=\"p-2 text-slate-400 hover:text-slate-600 rounded-lg\" aria-label=\"ปิด\">\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 gap-3\">\r\n            <div><strong>หน่วยงาน:</strong> {person.deph || '-'}</div>\r\n            <div><strong>เบอร์โทรศัพท์:</strong> {person.phone || '-'}</div>\r\n            <div><strong>อีเมล:</strong> {person.email || '-'}</div>\r\n            <div><strong>วันเกิด:</strong> {person.dob || '-'}</div>\r\n            <div><strong>Line ID:</strong> {person.lineUserId || '-'}</div>\r\n            <div><strong>บทบาท:</strong> {person.role || '-'}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// SearchModal (minimal placeholder)\r\n// Small visual card for a person used in search results (minimal + icon)\r\nconst PersonCard = memo(({ person, onView, onCall, onMail }) => {\r\n  return (\r\n    <div className=\"bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow p-3 flex items-center justify-between\">\r\n      <div className=\"flex items-center gap-3\">\r\n        <div className=\"w-12 h-12 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center font-semibold text-lg\">\r\n          {(person.firstname||'').charAt(0)}{(person.lastname||'').charAt(0)}\r\n        </div>\r\n        <div className=\"min-w-0\">\r\n          <div className=\"text-sm font-medium text-slate-900 truncate\">{person.prefix} {person.firstname} {person.lastname}</div>\r\n          <div className=\"text-xs text-slate-500 truncate flex items-center gap-2\">\r\n            <Building2 className=\"w-3 h-3 text-slate-400\" />\r\n            <span>{person.affiliation || '-'}</span>\r\n            <span className=\"mx-1\">•</span>\r\n            <span>{person.position || '-'}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex items-center gap-2\">\r\n        {person.phone && (\r\n          <button onClick={() => onCall(person.phone)} className=\"p-2 rounded-md bg-slate-50 hover:bg-slate-100 text-slate-600\" title=\"โทร\">\r\n            <Phone className=\"w-4 h-4\" />\r\n          </button>\r\n        )}\r\n        {person.email && (\r\n          <button onClick={() => onMail(person.email)} className=\"p-2 rounded-md bg-slate-50 hover:bg-slate-100 text-slate-600\" title=\"อีเมล\">\r\n            <Mail className=\"w-4 h-4\" />\r\n          </button>\r\n        )}\r\n        <button onClick={() => onView(person)} className=\"px-3 py-1 bg-indigo-600 text-white rounded-md text-sm flex items-center gap-2\">\r\n          <Eye className=\"w-4 h-4\" /> ดู\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nconst SearchModal = memo(({ isOpen, onClose, personnelData = [], stats = {}, onViewPerson = () => {}, onExport = () => {}, user }) => {\r\n  const [query, setQuery] = useState('');\r\n  const [filterAff, setFilterAff] = useState('');\r\n  const [filterPos, setFilterPos] = useState('');\r\n\r\n  const affiliations = useMemo(() => {\r\n    const setAff = new Set();\r\n    personnelData.forEach(p => setAff.add(p.affiliation || 'ไม่ระบุ'));\r\n    return Array.from(setAff).sort();\r\n  }, [personnelData]);\r\n\r\n  const positions = useMemo(() => {\r\n    const s = new Set();\r\n    personnelData.forEach(p => s.add(p.position || 'ไม่ระบุ'));\r\n    return Array.from(s).sort();\r\n  }, [personnelData]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const results = personnelData.filter(p => {\r\n    const hay = `${p.firstname} ${p.lastname} ${p.position || ''} ${p.affiliation || ''}`.toLowerCase();\r\n    if (!hay.includes(query.toLowerCase())) return false;\r\n    if (filterAff && (p.affiliation || 'ไม่ระบุ') !== filterAff) return false;\r\n    if (filterPos && (p.position || 'ไม่ระบุ') !== filterPos) return false;\r\n    return true;\r\n  });\r\n\r\n  const handleCall = (tel) => window.open(`tel:${tel}`, '_self');\r\n  const handleMail = (email) => window.open(`mailto:${email}`, '_self');\r\n\r\n  const clearFilters = () => { setFilterAff(''); setFilterPos(''); setQuery(''); };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 overflow-y-auto bg-black/60\">\r\n      <div className=\"flex min-h-screen items-start justify-center p-4 sm:p-6 md:p-10\">\r\n        <div className=\"relative bg-white rounded-3xl shadow-2xl max-w-4xl w-full p-6\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h2 className=\"text-xl font-semibold\">ค้นหาบุคลากร</h2>\r\n            <button onClick={onClose} className=\"p-2 text-slate-400 hover:text-slate-600 rounded-lg\"><X className=\"w-5 h-5\" /></button>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4\">\r\n            <input value={query} onChange={(e) => setQuery(e.target.value)} className=\"w-full p-2 border rounded\" placeholder=\"ค้นหาชื่อ, ตำแหน่ง, สังกัด...\" />\r\n            <select value={filterAff} onChange={(e) => setFilterAff(e.target.value)} className=\"p-2 border rounded\">\r\n              <option value=\"\">ทั้งหมด (สังกัด)</option>\r\n              {affiliations.map(a => <option key={a} value={a}>{a}</option>)}\r\n            </select>\r\n            <select value={filterPos} onChange={(e) => setFilterPos(e.target.value)} className=\"p-2 border rounded\">\r\n              <option value=\"\">ทั้งหมด (ตำแหน่ง)</option>\r\n              {positions.map(p => <option key={p} value={p}>{p}</option>)}\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            <div className=\"text-sm text-slate-500\">พบ {results.length} รายการ</div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <button onClick={clearFilters} className=\"text-sm text-slate-600 px-2 py-1 rounded bg-slate-50\">ล้าง</button>\r\n              <button onClick={() => onExport(results)} className=\"text-sm px-3 py-1 bg-indigo-600 text-white rounded\">ส่งออก</button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"space-y-3 max-h-72 overflow-y-auto\">\r\n            {results.map((p, i) => (\r\n              <PersonCard key={`${p.phone || i}-${i}`} person={p} onView={onViewPerson} onCall={handleCall} onMail={handleMail} />\r\n            ))}\r\n            {results.length === 0 && <div className=\"text-center text-slate-500 py-8\">ไม่พบผลลัพธ์ที่ตรงกับคำค้น</div>}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default function PersonnelPage({ user }) {\r\n  const [loading, setLoading] = useState(true);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [personnelData, setPersonnelData] = useState([]);\r\n  const [selectedPerson, setSelectedPerson] = useState(null);\r\n  const [showDetail, setShowDetail] = useState(false);\r\n  const [showSearchModal, setShowSearchModal] = useState(false);\r\n\r\n  const [quota, setQuota] = useState(100);\r\n  const [vacancy, setVacancy] = useState(20);\r\n  const [isEditingQuota, setIsEditingQuota] = useState(false);\r\n  const [isEditingVacancy, setIsEditingVacancy] = useState(false);\r\n\r\n  const [selectedChart, setSelectedChart] = useState(\"position\"); // Default chart type\r\n  const [filters, setFilters] = useState({\r\n    affiliation: \"\",\r\n    department: \"\",\r\n    ageRange: \"\",\r\n    gender: \"\",\r\n  });\r\n\r\n  const logAdminActivity = useCallback((action, details) => {\r\n    if (!user) return;\r\n    fetch(CONFIG.ADMIN_API, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        action: 'log_activity',\r\n        log_action: action,\r\n        log_details: details || null,\r\n        user_id: user.id,\r\n        username: user.username,\r\n      }),\r\n    }).catch((error) => console.error('Failed to log activity:', error));\r\n  }, [user]);\r\n\r\n  const fetchPersonnelData = useCallback(async () => {\r\n    try {\r\n      const apiUrl = CONFIG.OFFICERS_API;\r\n      const response = await fetch(apiUrl);\r\n      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\r\n      const text = await response.text();\r\n      if (!text) throw new Error('Empty response from server');\r\n      const result = JSON.parse(text);\r\n      const data = result.success && Array.isArray(result.data) ? result.data : [];\r\n      const formattedData = data.map((person) => ({\r\n        phone: person.phone || '',\r\n        prefix: person.prefix || '',\r\n        firstname: person.firstname || '',\r\n        lastname: person.lastname || '',\r\n        position: person.position || '',\r\n        affiliation: person.affiliation || '',\r\n        deph: person.department || '',\r\n        generation: person.generation || '',\r\n        email: person.email || '',\r\n        dob: person.dob || '',\r\n        lineUserId: person.lineUserId || '',\r\n        role: person.role || 'member',\r\n      }));\r\n      setPersonnelData(formattedData);\r\n      setError(\"\");\r\n    } catch (error) {\r\n      setError(`⚠️ ${error.message}`);\r\n      setPersonnelData([]);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchPersonnelData();\r\n  }, [fetchPersonnelData]);\r\n\r\n  const handleRefresh = () => {\r\n    setRefreshing(true);\r\n    fetchPersonnelData().finally(() => setRefreshing(false));\r\n  };\r\n\r\n  const handleViewPerson = (person) => {\r\n  // If user opened from search, close search modal first so detail appears on top\r\n  setShowSearchModal(false);\r\n  setSelectedPerson(person);\r\n  setShowDetail(true);\r\n  };\r\n\r\n  const exportToCSV = (data) => {\r\n    // Implement CSV export logic here\r\n  };\r\n\r\n  const affiliationAbbreviations = {\r\n    \"ศูนย์รักษาความปลอดภัย\": \"ส่วนกลาง\",\r\n    \"ศาลชั้นต้นในกรุงเทพมหานคร\": \"กทม.\",\r\n  };\r\n\r\n  const filteredAffiliationData = useMemo(() => {\r\n    return personnelData.reduce((acc, person) => {\r\n      let affiliation = (person.affiliation || '').trim();\r\n      if (!affiliation) affiliation = 'ไม่ระบุ';\r\n\r\n      const lower = affiliation.toLowerCase();\r\n\r\n      // Normalize known patterns using targeted rules\r\n      let normalized = affiliation;\r\n\r\n      // If it's the regional office pattern that contains สำนักศาลยุติธรรมประจำภาค\r\n      // we want to convert it to: 'ภาค <n>' when a number exists, otherwise 'ภาค'\r\n      if (\r\n        lower.includes('สำนักศาลยุติธรรมประจำภาค') ||\r\n        lower.includes('สำนักยุติธรรมประจำภาค') ||\r\n        lower.includes('ในสังกัดสำนักศาลยุติธรรมประจำภาค') ||\r\n        lower.includes('ศาลในสังกัดสำนักศาลยุติธรรมประจำภาค')\r\n      ) {\r\n        // Try to extract explicit 'ภาค <number>' first\r\n        const matchRegion = affiliation.match(/ภาค\\s*(\\d{1,3})/i);\r\n        if (matchRegion && matchRegion[1]) {\r\n          normalized = `ภาค ${matchRegion[1]}`;\r\n        } else {\r\n          // Fallback: find any trailing number in the string (e.g., '... ประจำภาค 4')\r\n          const trailingNum = affiliation.match(/(\\d{1,3})\\s*$/);\r\n          if (trailingNum && trailingNum[1]) {\r\n            normalized = `ภาค ${trailingNum[1]}`;\r\n          } else {\r\n            // Last-resort: any first number in the string\r\n            const anyNum = affiliation.match(/(\\d{1,3})/);\r\n            normalized = anyNum && anyNum[1] ? `ภาค ${anyNum[1]}` : 'ภาค';\r\n          }\r\n        }\r\n      } else if (lower.includes('ศูนย์รักษาความปลอดภัย')) {\r\n        normalized = 'ส่วนกลาง';\r\n      } else if (lower.includes('กรุงเทพ') || lower.includes('กรุงเทพมหานคร') || lower.includes('ศาลชั้นต้นในกรุงเทพมหานคร')) {\r\n        normalized = 'กทม.';\r\n      } else {\r\n        // fallback to any exact mapping we defined, otherwise keep original\r\n        normalized = affiliationAbbreviations[affiliation] || affiliation;\r\n      }\r\n\r\n      acc[normalized] = (acc[normalized] || 0) + 1;\r\n      return acc;\r\n    }, {});\r\n  }, [personnelData]);\r\n\r\n  const chartData = useMemo(() => {\r\n    const entries = Object.entries(filteredAffiliationData).map(([label, value]) => ({ label, value }));\r\n\r\n    const getOrderKey = (label) => {\r\n      if (!label) return 9999;\r\n      const l = String(label).trim();\r\n\r\n      // Match 'ภาค' followed by number e.g. 'ภาค 1' or 'ภาค1'\r\n      const m = l.match(/ภาค\\s*(\\d{1,3})/);\r\n      if (m && m[1]) {\r\n        // Put ภาค N in order 0.. (keep N small)\r\n        const num = parseInt(m[1], 10);\r\n        return num; // 1..9 -> 1..9 (smaller is earlier)\r\n      }\r\n\r\n      // If label is exactly 'ภาค' (no number), put after numbered ภาค\r\n      if (/^ภาค$/i.test(l)) return 999;\r\n\r\n      // Specific named orders after ภาค group\r\n      if (l === 'กทม.' || l.toLowerCase() === 'กทม.') return 1000;\r\n      if (l === 'ส่วนกลาง' || l.toLowerCase() === 'ส่วนกลาง') return 1001;\r\n      if (l.includes('ศาลสูง')) return 1002;\r\n      // handle both spellings 'ชำนาญ' and 'ชำนัญ'\r\n      if (l.includes('ชำนาญ') || l.includes('ชำนัญ') || l.includes('ชำนัญพิเศษ') || l.includes('ชำนาญพิเศษ')) return 1003;\r\n\r\n      // Default: place after known groups but preserve alphabetical order by returning a high key plus name\r\n      return 5000 + l.charCodeAt(0);\r\n    };\r\n\r\n    entries.sort((a, b) => {\r\n      const ka = getOrderKey(a.label);\r\n      const kb = getOrderKey(b.label);\r\n      if (ka === kb) {\r\n        // fallback alphabetical\r\n        return String(a.label).localeCompare(String(b.label));\r\n      }\r\n      return ka - kb;\r\n    });\r\n\r\n    return entries;\r\n  }, [filteredAffiliationData]);\r\n\r\n  const stats = useMemo(() => {\r\n    const newStats = {\r\n      total: personnelData.length,\r\n      connected: personnelData.filter((p) => p.lineUserId).length,\r\n      byPosition: {},\r\n      byAffiliation: {},\r\n      byDepartment: {},\r\n      byGeneration: {},\r\n    };\r\n    personnelData.forEach((person) => {\r\n      const position = person.position || 'ไม่ระบุ';\r\n      newStats.byPosition[position] = (newStats.byPosition[position] || 0) + 1;\r\n      const affiliation = person.affiliation || 'ไม่ระบุ';\r\n      newStats.byAffiliation[affiliation] = (newStats.byAffiliation[affiliation] || 0) + 1;\r\n      const department = person.deph || 'ไม่ระบุตำแหน่ง';\r\n      newStats.byDepartment[department] = (newStats.byDepartment[department] || 0) + 1;\r\n      const generation = person.generation ? String(person.generation).trim() : 'ไม่ระบุตำแหน่ง';\r\n      newStats.byGeneration[generation] = (newStats.byGeneration[generation] || 0) + 1;\r\n    });\r\n    return newStats;\r\n  }, [personnelData]);\r\n\r\n  useEffect(() => {\r\n    console.log(\"Personnel Data:\", personnelData);\r\n  }, [personnelData]);\r\n\r\n  useEffect(() => {\r\n    console.log(\"Stats:\", stats);\r\n    console.log(\"Chart Data:\", chartData);\r\n  }, [stats, chartData]);\r\n\r\n  const chartColors = [\r\n    \"#FF6384\", \"#36A2EB\", \"#FFCE56\", \"#4BC0C0\", \"#9966FF\", \"#FF9F40\", \"#FFCD56\", \"#C9CBCF\"\r\n  ];\r\n\r\n  // Helper: build chart data for different types (inside component)\r\n  const getChartData = useCallback((type) => {\r\n    if (type === 'affiliation') return chartData; // already normalized affiliation entries\r\n\r\n    if (type === 'position') {\r\n      // build from stats.byPosition\r\n      const entries = Object.entries(stats.byPosition || {}).map(([label, value]) => ({ label, value }));\r\n      // sort by value desc\r\n      entries.sort((a, b) => b.value - a.value);\r\n      return entries;\r\n    }\r\n\r\n    if (type === 'age') {\r\n      // derive age groups from dob (basic)\r\n      const groups = { '<30': 0, '30-39': 0, '40-49': 0, '50-59': 0, '60+': 0 };\r\n      const now = new Date();\r\n      personnelData.forEach(p => {\r\n        if (!p.dob) return;\r\n        const m = String(p.dob).match(/(\\d{4})/);\r\n        if (!m) return;\r\n        const year = parseInt(m[1], 10);\r\n        if (isNaN(year)) return;\r\n        const age = now.getFullYear() - year;\r\n        if (age < 30) groups['<30']++;\r\n        else if (age < 40) groups['30-39']++;\r\n        else if (age < 50) groups['40-49']++;\r\n        else if (age < 60) groups['50-59']++;\r\n        else groups['60+']++;\r\n      });\r\n      return Object.entries(groups).map(([label, value]) => ({ label, value }));\r\n    }\r\n\r\n    if (type === 'gender') {\r\n      // no gender field in data - return empty to show no data\r\n      const genders = (personnelData || []).reduce((acc, p) => {\r\n        const g = (p.gender || '').trim();\r\n        if (!g) return acc;\r\n        acc[g] = (acc[g] || 0) + 1;\r\n        return acc;\r\n      }, {});\r\n      return Object.entries(genders).map(([label, value]) => ({ label, value }));\r\n    }\r\n\r\n    return [];\r\n  }, [chartData, stats, personnelData]);\r\n\r\n  const renderChart = () => {\r\n    switch (selectedChart) {\r\n      case \"position\":\r\n        return (\r\n          <HorizontalBarChart\r\n            data={getChartData('position')}\r\n            colors={chartColors}\r\n            title=\"ตำแหน่ง\"\r\n            maxHeight=\"320px\"\r\n          />\r\n        );\r\n      case \"affiliation\":\r\n        return (\r\n          <HorizontalBarChart\r\n            data={getChartData('affiliation')}\r\n            colors={chartColors}\r\n            title=\"สัดส่วนแต่ละสังกัด\"\r\n            maxHeight=\"320px\"\r\n          />\r\n        );\r\n      case \"gender\":\r\n        return (\r\n          <PieChartComponent\r\n            data={getChartData('gender')}\r\n            colors={chartColors}\r\n            title=\"เพศ\"\r\n          />\r\n        );\r\n      case \"age\":\r\n        return (\r\n          <HorizontalBarChart\r\n            data={getChartData('age')}\r\n            colors={chartColors}\r\n            title=\"ช่วงอายุ\"\r\n            maxHeight=\"240px\"\r\n          />\r\n        );\r\n      default:\r\n        return <p>ไม่มีข้อมูลสำหรับแสดงผล</p>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto px-4 py-8\">\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <h1 className=\"text-2xl font-bold text-slate-800\">ข้อมูลบุคลากร</h1>\r\n        <div className=\"flex items-center space-x-3\">\r\n          <button\r\n            onClick={() => setShowSearchModal(true)}\r\n            className=\"flex items-center space-x-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow\"\r\n          >\r\n            <Search className=\"w-4 h-4\" />\r\n            <span>ค้นหาบุคลากร</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n        <EditableCard\r\n          title=\"กรอบอัตรา\"\r\n          value={quota}\r\n          icon={Briefcase}\r\n          color=\"blue\"\r\n          isEditing={isEditingQuota}\r\n          onEdit={() => setIsEditingQuota(!isEditingQuota)}\r\n          onChange={(value) => setQuota(value)}\r\n          isAdmin={user?.role === 'admin'}\r\n        />\r\n        <EditableCard\r\n          title=\"ตำแหน่งว่าง\"\r\n          value={vacancy}\r\n          icon={UserX}\r\n          color=\"red\"\r\n          isEditing={isEditingVacancy}\r\n          onEdit={() => setIsEditingVacancy(!isEditingVacancy)}\r\n          onChange={(value) => setVacancy(value)}\r\n          isAdmin={user?.role === 'admin'}\r\n        />\r\n        <StatCard\r\n          title=\"บุคลากรทั้งหมด\"\r\n          value={stats.total}\r\n          icon={Users}\r\n          color=\"green\"\r\n          subtitle=\"ทั้งหมดในระบบ\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"flex items-center space-x-4 mb-6\">\r\n        <button\r\n          onClick={() => setSelectedChart(\"position\")}\r\n          className={`px-4 py-2 rounded-lg ${selectedChart === \"position\" ? \"bg-indigo-600 text-white\" : \"bg-gray-200 text-gray-800\"}`}\r\n        >\r\n          ตำแหน่ง\r\n        </button>\r\n        <button\r\n          onClick={() => setSelectedChart(\"affiliation\")}\r\n          className={`px-4 py-2 rounded-lg ${selectedChart === \"affiliation\" ? \"bg-indigo-600 text-white\" : \"bg-gray-200 text-gray-800\"}`}\r\n        >\r\n          สังกัด\r\n        </button>\r\n        <button\r\n          onClick={() => setSelectedChart(\"gender\")}\r\n          className={`px-4 py-2 rounded-lg ${selectedChart === \"gender\" ? \"bg-indigo-600 text-white\" : \"bg-gray-200 text-gray-800\"}`}\r\n        >\r\n          เพศ\r\n        </button>\r\n        <button\r\n          onClick={() => setSelectedChart(\"age\")}\r\n          className={`px-4 py-2 rounded-lg ${selectedChart === \"age\" ? \"bg-indigo-600 text-white\" : \"bg-gray-200 text-gray-800\"}`}\r\n        >\r\n          ช่วงอายุ\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        <div className=\"bg-white rounded-2xl shadow border border-slate-200 p-6\">\r\n          <h2 className=\"text-lg font-semibold text-slate-800 mb-4\">กราฟแท่ง</h2>\r\n          <HorizontalBarChart data={getChartData('affiliation')} colors={chartColors} title=\"สัดส่วนแต่ละสังกัด\" maxHeight=\"500px\" />\r\n        </div>\r\n        <div className=\"bg-white rounded-2xl shadow border border-slate-200 p-6\">\r\n          <h2 className=\"text-lg font-semibold text-slate-800 mb-4\">กราฟวงกลม</h2>\r\n          <PieChartComponent data={getChartData('affiliation')} colors={chartColors} title=\"สัดส่วนแต่ละสังกัด\" />\r\n        </div>\r\n        <div className=\"bg-white rounded-2xl shadow border border-slate-200 p-6\">\r\n          <h2 className=\"text-lg font-semibold text-slate-800 mb-4\">กราฟโดนัท</h2>\r\n          <DonutChart data={getChartData('affiliation')} colors={chartColors} title=\"สัดส่วนแต่ละสังกัด\" />\r\n        </div>\r\n        <div className=\"bg-white rounded-2xl shadow border border-slate-200 p-6\">\r\n          <h2 className=\"text-lg font-semibold text-slate-800 mb-4\">กราฟเส้น</h2>\r\n          <LineChart data={getChartData('affiliation')} colors={chartColors} title=\"สัดส่วนแต่ละสังกัด\" />\r\n        </div>\r\n      </div>\r\n\r\n      <PersonnelDetailModal\r\n        person={selectedPerson}\r\n        isOpen={showDetail}\r\n        onClose={() => setShowDetail(false)}\r\n      />\r\n      <SearchModal\r\n        isOpen={showSearchModal}\r\n        onClose={() => setShowSearchModal(false)}\r\n        personnelData={personnelData}\r\n        stats={stats}\r\n        onViewPerson={handleViewPerson}\r\n        onExport={exportToCSV}\r\n        user={user}\r\n      />\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}