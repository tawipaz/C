{"ast":null,"code":"import _objectSpread from\"C:/Users/LENOVO/Documents/GitHub/court-marshal-connect/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState,useMemo,useCallback,memo}from\"react\";import{Search,Filter,Users,Phone,Mail,Calendar,Award,Building2,UserCheck,UserX,TrendingUp,PieChart,BarChart3,Download,RefreshCw,Eye,Grid3X3,List,X,AlertCircle,CheckCircle2,Clock,Briefcase,GraduationCap,Edit2,Save,MapPin,Building,Crown,FileText}from\"lucide-react\";import{CONFIG}from'../config';import DonutChart from'../components/DonutChart';import LineChart from'../components/LineChart';// Function to format phone number (add leading 0 if needed)\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const formatPhoneNumber=phone=>{if(!phone)return'';const cleanPhone=phone.replace(/\\D/g,'');// Remove non-digits\nif(cleanPhone.length===9){return'0'+cleanPhone;// Add leading 0 for 9-digit numbers\n}return cleanPhone;// Return as-is for other lengths\n};// StatCard Component\nconst StatCard=/*#__PURE__*/memo(_ref=>{let{title,value,icon:Icon,color=\"blue\",trend,subtitle}=_ref;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-\".concat(color,\"-100 rounded-xl flex items-center justify-center\"),children:/*#__PURE__*/_jsx(Icon,{className:\"w-6 h-6 text-\".concat(color,\"-600\")})}),trend&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-green-600 text-sm\",children:[/*#__PURE__*/_jsx(TrendingUp,{className:\"w-4 h-4 mr-1\"}),/*#__PURE__*/_jsxs(\"span\",{children:[trend,\"%\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-slate-900 mb-1\",children:value}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-slate-600\",children:title}),subtitle&&/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-slate-500 mt-1\",children:subtitle})]});});// Table Chart Component (สำหรับแสดงข้อมูลตำแหน่งแบบตาราง)\nconst TableChart=/*#__PURE__*/memo(_ref2=>{let{title,data,colors=[]}=_ref2;const total=useMemo(()=>data.reduce((sum,d)=>sum+d.value,0),[data]);return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-slate-900\",children:total}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-slate-500\",children:\"\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid gap-2\",children:data.slice(0,8).map((item,index)=>{const percentage=(item.value/total*100).toFixed(1);const color=colors[index%colors.length]||'#6366f1';return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-3 bg-slate-50 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3 flex-1 min-w-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 rounded-sm flex-shrink-0\",style:{backgroundColor:color}}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-slate-700 font-medium truncate\",title:item.label,children:item.label})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 text-right\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-bold text-slate-900\",children:item.value}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-slate-500\",children:[percentage,\"%\"]})]})]},\"\".concat(item.label,\"-\").concat(index));})})]})]});});// Function สำหรับตัดคำยาว\nconst truncatePosition=position=>{if(!position)return'';const removePatterns=['เจ้าพนักงานตำรวจศาล','ตำรวจศาล','ตำรวจ','พนักงาน'];let result=position;for(const pattern of removePatterns){result=result.replace(new RegExp(pattern,'gi'),'');}return result.trim()||position;};// Function สำหรับตัดคำ \"ศาล\" ออกจากสังกัด\nconst truncateAffiliation=affiliation=>{if(!affiliation)return'';const lower=affiliation.toLowerCase();// Only remove the leading word 'ศาล' for affiliations that describe\n// 'ในสังกัดสำนักยุติธรรมประจำภาค' (or variants). Do not strip 'ศาล'\n// from other court names like 'ศาลสูง' or 'ศาลชำนาญพิเศษ'.\nif(lower.includes('ในสังกัดสำนักยุติธรรมประจำภาค')||lower.includes('ในสังกัดสำนักยุติธรรม')){return affiliation.replace(/^ศาล\\s*/i,'').trim()||affiliation;}// Otherwise return affiliation unchanged\nreturn affiliation;};// --- NEW: Proportional Treemap Chart Component ---\n// --- NEW: Proportional Treemap Chart Component (MODIFIED FOR LOGARITHMIC SCALE) ---\nconst TreemapChart=/*#__PURE__*/memo(_ref3=>{let{title,data,colors=[]}=_ref3;// --- ส่วนที่แก้ไข: คำนวณ total จากค่าจริงก่อนแปลงสเกล ---\nconst originalTotal=useMemo(()=>data.reduce((sum,d)=>sum+d.value,0),[data]);// --- ส่วนที่แก้ไข: สร้างข้อมูลชุดใหม่ที่มีการปรับสเกลด้วย Math.log1p ---\n// Math.log1p(x) จะคำนวณ log(1+x) ช่วยให้ค่าที่น้อยๆ มีขนาดใหญ่ขึ้นเมื่อเทียบกับค่ามากๆ\nconst scaledData=useMemo(()=>data.map(item=>_objectSpread(_objectSpread({},item),{},{scaledValue:Math.log1p(item.value)})),[data]);const generateTreemapLayout=useCallback((items,width,height)=>{let rects=[];const layoutRow=(rowItems,x,y,w,h)=>{if(!rowItems.length)return;// --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\nconst totalValue=rowItems.reduce((sum,i)=>sum+i.scaledValue,0);if(totalValue===0)return;let offset=0;const isHorizontal=w>h;for(const item of rowItems){// --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\nconst percentage=item.scaledValue/totalValue;if(isHorizontal){const rectWidth=w*percentage;rects.push({x:x+offset,y,width:rectWidth,height:h,item});offset+=rectWidth;}else{const rectHeight=h*percentage;rects.push({x,y:y+offset,width:w,height:rectHeight,item});offset+=rectHeight;}}};const squarify=(items,x,y,w,h)=>{if(!items.length)return;if(items.length<=4){layoutRow(items,x,y,w,h);return;}// --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\nconst halfValue=items.reduce((sum,i)=>sum+i.scaledValue,0)/2;let runningTotal=0;let splitIndex=0;for(let i=0;i<items.length;i++){// --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\nrunningTotal+=items[i].scaledValue;if(runningTotal>=halfValue){splitIndex=i+1;break;}}splitIndex=Math.max(1,splitIndex);const groupA=items.slice(0,splitIndex);const groupB=items.slice(splitIndex);const groupATotal=groupA.reduce((sum,i)=>sum+i.scaledValue,0);const totalValue=groupATotal+groupB.reduce((sum,i)=>sum+i.scaledValue,0);if(totalValue===0)return;if(w>h){const groupAWidth=w*(groupATotal/totalValue);squarify(groupA,x,y,groupAWidth,h);squarify(groupB,x+groupAWidth,y,w-groupAWidth,h);}else{const groupAHeight=h*(groupATotal/totalValue);squarify(groupA,x,y,w,groupAHeight);squarify(groupB,x,y+groupAHeight,w,h-groupAHeight);}};squarify(items,0,0,1000,1000);// Use a relative base for layout\nreturn rects;},[]);// --- ส่วนที่แก้ไข: ส่ง scaledData เข้าไปคำนวณ layout ---\nconst layout=useMemo(()=>generateTreemapLayout(scaledData),[scaledData,generateTreemapLayout]);if(!data.length||originalTotal===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 h-full\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-500\",children:\"\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E41\\u0E2A\\u0E14\\u0E07\\u0E01\\u0E23\\u0E32\\u0E1F\"})})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 flex flex-col h-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-slate-900\",children:originalTotal}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-slate-500\",children:\"\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"relative w-full flex-1\",children:layout.map(rect=>{const itemIndex=scaledData.findIndex(d=>d.label===rect.item.label);const color=colors[itemIndex%colors.length];// --- ส่วนที่แก้ไข: คำนวณ % จากค่าจริง ---\nconst percentage=originalTotal>0?(rect.item.value/originalTotal*100).toFixed(1):0;const valueText=\"\".concat(rect.item.value,\" (\").concat(percentage,\"%)\");const fontSize=Math.min(rect.width/10,rect.height/5,16);const textShadowStyle={textShadow:'0px 1px 3px rgba(0, 0, 0, 0.6)'};return/*#__PURE__*/_jsxs(\"div\",{className:\"absolute border-2 border-white rounded-md flex flex-col items-center justify-center p-1 overflow-hidden text-center\",style:{left:\"\".concat(rect.x/10,\"%\"),top:\"\".concat(rect.y/10,\"%\"),width:\"\".concat(rect.width/10,\"%\"),height:\"\".concat(rect.height/10,\"%\"),backgroundColor:color,transition:'all 0.4s ease-in-out'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-white font-bold\",style:_objectSpread({fontSize:\"\".concat(fontSize,\"px\")},textShadowStyle),children:valueText}),/*#__PURE__*/_jsx(\"div\",{className:\"text-white opacity-90 leading-tight\",style:_objectSpread({fontSize:\"\".concat(Math.max(fontSize*0.7,10),\"px\")},textShadowStyle),children:rect.item.label})]},rect.item.label);})})]});});// Pie Chart Component - เปลี่ยนเป็น Donut Chart\nconst PieChartComponent=/*#__PURE__*/memo(_ref4=>{let{title,data,colors=[]}=_ref4;const total=useMemo(()=>data.reduce((sum,d)=>sum+d.value,0),[data]);if(!data.length||total===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(PieChart,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-500\",children:\"\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E41\\u0E2A\\u0E14\\u0E07\\u0E01\\u0E23\\u0E32\\u0E1F\"})})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 h-fit\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 flex items-center\",children:[/*#__PURE__*/_jsx(PieChart,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-right\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-lg font-bold text-slate-900\",children:[\"\\u0E08\\u0E33\\u0E19\\u0E27\\u0E19 \",total,\" \\u0E04\\u0E19\"]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"relative border border-slate-200 rounded-lg p-4 bg-slate-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"relative w-48 h-48\",children:/*#__PURE__*/_jsx(\"svg\",{width:\"192\",height:\"192\",viewBox:\"0 0 192 192\",className:\"w-full h-full\",children:data.map((item,index)=>{const percentage=item.value/total;const angle=percentage*360;const prevPercentage=data.slice(0,index).reduce((sum,d)=>sum+d.value,0)/total;const startAngle=prevPercentage*360-90;const endAngle=startAngle+angle;// Donut chart - outer radius 80, inner radius 45\nconst outerRadius=80;const innerRadius=45;const startXOuter=96+outerRadius*Math.cos(startAngle*Math.PI/180);const startYOuter=96+outerRadius*Math.sin(startAngle*Math.PI/180);const endXOuter=96+outerRadius*Math.cos(endAngle*Math.PI/180);const endYOuter=96+outerRadius*Math.sin(endAngle*Math.PI/180);const startXInner=96+innerRadius*Math.cos(endAngle*Math.PI/180);const startYInner=96+innerRadius*Math.sin(endAngle*Math.PI/180);const endXInner=96+innerRadius*Math.cos(startAngle*Math.PI/180);const endYInner=96+innerRadius*Math.sin(startAngle*Math.PI/180);const largeArcFlag=angle>180?1:0;const pathData=['M',startXOuter,startYOuter,'A',outerRadius,outerRadius,0,largeArcFlag,1,endXOuter,endYOuter,'L',startXInner,startYInner,'A',innerRadius,innerRadius,0,largeArcFlag,0,endXInner,endYInner,'Z'].join(' ');const pieColors=['#8b5cf6','#ec4899','#06b6d4','#10b981','#f59e0b','#ef4444','#84cc16','#6366f1','#f97316','#14b8a6'];const color=pieColors[index%pieColors.length];// คำนวณตำแหน่งสำหรับแสดง percentage\nconst midAngle=startAngle+angle/2;const labelRadius=90;const labelX=96+labelRadius*Math.cos(midAngle*Math.PI/180);const labelY=96+labelRadius*Math.sin(midAngle*Math.PI/180);const percentageText=\"\".concat((percentage*100).toFixed(1),\"%\");return/*#__PURE__*/_jsxs(\"g\",{children:[/*#__PURE__*/_jsx(\"path\",{d:pathData,fill:color,stroke:\"white\",strokeWidth:\"2\"}),percentage>0.05&&/*#__PURE__*/_jsx(\"text\",{x:labelX,y:labelY,textAnchor:\"middle\",dominantBaseline:\"middle\",fill:\"#1e293b\",fontSize:\"10\",fontWeight:\"bold\",stroke:\"white\",strokeWidth:\"2\",paintOrder:\"stroke\",children:percentageText})]},\"donut-\".concat(index));})})}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full mt-6\",children:/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2\",children:data.map((item,index)=>{const percentage=(item.value/total*100).toFixed(0);const pieColors=['#8b5cf6','#ec4899','#06b6d4','#10b981','#f59e0b','#ef4444','#84cc16','#6366f1','#f97316','#14b8a6'];const color=pieColors[index%pieColors.length];return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 min-w-0 flex-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-3 h-3 rounded-full flex-shrink-0\",style:{backgroundColor:color}}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-slate-700\",children:[truncateAffiliation(item.label),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-slate-900\",children:item.value}),\" \\u0E04\\u0E19\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm font-bold text-slate-900 ml-2\",children:[percentage,\"%\"]})]},\"legend-\".concat(item.label,\"-\").concat(index));})})})]})})]});});// Horizontal Bar Chart Component\nconst HorizontalBarChart=/*#__PURE__*/memo(_ref5=>{let{title,data,colors=[],maxHeight='320px'}=_ref5;const getSortOrder=label=>{const regionMatch=label.match(/ภาค\\s*(\\d+)/);if(regionMatch)return parseInt(regionMatch[1]);const customOrder=['ศาลชั้นต้นในเขตกรุงเทพมหานคร','ศูนย์รักษาความปลอดภัย','ศาลชำนาญพิเศษ','ศาลสูง'];const index=customOrder.findIndex(item=>label.includes(item));if(index!==-1)return 100+index;return 999;};const sortedData=useMemo(()=>[...data].sort((a,b)=>getSortOrder(a.label)-getSortOrder(b.label)),[data]);const maxValue=useMemo(()=>{if(!sortedData||sortedData.length===0)return 0;return Math.max(...sortedData.map(d=>d.value));},[sortedData]);if(!sortedData.length||maxValue===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-500\",children:\"\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E41\\u0E2A\\u0E14\\u0E07\\u0E01\\u0E23\\u0E32\\u0E1F\"})})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-4 shadow-sm border border-slate-200\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-slate-900 mb-3 flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 mr-2 text-slate-400\"}),title]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",style:{maxHeight,overflowY:'auto',paddingRight:8},children:sortedData.map((item,index)=>{const barWidth=item.value/maxValue*100;const color=colors[index%colors.length]||'#8b5cf6';return/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-3 gap-2 items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-span-1 text-sm text-slate-700 font-medium text-left truncate\",title:item.label,children:item.label}),/*#__PURE__*/_jsx(\"div\",{className:\"col-span-2 w-full bg-slate-100 rounded-full h-7 relative\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-7 rounded-full transition-all duration-700 flex items-center justify-end pr-3\",style:{width:\"\".concat(barWidth,\"%\"),backgroundColor:color,minWidth:'36px'},children:/*#__PURE__*/_jsx(\"span\",{className:\"text-white text-sm font-bold\",children:item.value})})})]},\"\".concat(item.label,\"-\").concat(index));})})]});});// (moved into the PersonnelPage component to avoid calling hooks at top level)\n// EditableCard Component (restored minimal implementation)\nconst EditableCard=/*#__PURE__*/memo(_ref6=>{let{title,value,icon:Icon,color=\"blue\",isEditing,onEdit,onChange,isAdmin}=_ref6;const[localValue,setLocalValue]=useState(value);useEffect(()=>{setLocalValue(value);},[value]);const handleChange=e=>{const newValue=parseInt(e.target.value)||0;setLocalValue(newValue);onChange(newValue);};return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-\".concat(color,\"-100 rounded-xl flex items-center justify-center\"),children:Icon&&/*#__PURE__*/_jsx(Icon,{className:\"w-6 h-6 text-\".concat(color,\"-600\")})}),isAdmin&&/*#__PURE__*/_jsx(\"button\",{onClick:onEdit,className:\"text-slate-400 hover:text-slate-600 transition-colors\",children:isEditing?/*#__PURE__*/_jsx(Save,{className:\"w-5 h-5\"}):/*#__PURE__*/_jsx(Edit2,{className:\"w-5 h-5\"})})]}),isEditing?/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:localValue,onChange:handleChange,className:\"w-full text-3xl font-bold text-slate-900 mb-1 bg-slate-50 border border-slate-200 rounded px-2 py-1\",min:\"0\"}):/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-slate-900 mb-1\",children:localValue}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-slate-600\",children:title})]});});// PersonnelDetailModal (minimal)\nconst PersonnelDetailModal=/*#__PURE__*/memo(_ref7=>{let{person,isOpen,onClose}=_ref7;if(!isOpen||!person)return null;// Calculate age from birth date\nconst calculateAge=dob=>{if(!dob)return'ไม่ระบุ';try{const birthDate=new Date(dob);const today=new Date();let age=today.getFullYear()-birthDate.getFullYear();const monthDiff=today.getMonth()-birthDate.getMonth();if(monthDiff<0||monthDiff===0&&today.getDate()<birthDate.getDate()){age--;}return\"\".concat(age,\" \\u0E1B\\u0E35\");}catch(error){return'ไม่ระบุ';}};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-50 overflow-y-auto bg-black/60 hide-scrollbar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex min-h-screen items-start justify-center p-3 sm:p-6 md:p-10\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative bg-gradient-to-br from-white via-slate-50 to-indigo-50 rounded-2xl sm:rounded-3xl shadow-2xl max-w-3xl w-full p-4 sm:p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between mb-6 pb-4 border-b border-slate-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 sm:w-16 sm:h-16 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-lg sm:text-xl font-bold shadow-lg\",children:(person.firstname||'N')[0]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-lg sm:text-xl font-bold text-slate-900\",children:[person.prefix,\" \",person.firstname,\" \",person.lastname]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-slate-600\",children:person.position||'ไม่ระบุตำแหน่ง'})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"p-2 text-slate-400 hover:text-slate-600 hover:bg-white/80 rounded-lg transition-all duration-200\",children:/*#__PURE__*/_jsx(X,{className:\"w-5 h-5\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-br from-white to-blue-50 rounded-xl p-4 sm:p-5 shadow-lg border border-slate-200/50\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-base sm:text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Phone,{className:\"w-5 h-5 text-blue-600\"}),\"\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E15\\u0E34\\u0E14\\u0E15\\u0E48\\u0E2D\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\",children:[/*#__PURE__*/_jsx(Phone,{className:\"w-4 h-4 text-slate-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-slate-700\",children:formatPhoneNumber(person.phone)||'ไม่ระบุ'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\",children:[/*#__PURE__*/_jsx(Mail,{className:\"w-4 h-4 text-slate-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-slate-700\",children:person.email||'ไม่ระบุ'})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-br from-white to-green-50 rounded-xl p-4 sm:p-5 shadow-lg border border-slate-200/50\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-base sm:text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Building,{className:\"w-5 h-5 text-green-600\"}),\"\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E01\\u0E32\\u0E23\\u0E17\\u0E33\\u0E07\\u0E32\\u0E19\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\",children:[/*#__PURE__*/_jsx(Building2,{className:\"w-4 h-4 text-slate-500\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-slate-700\",children:\"\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-slate-600\",children:person.affiliation||'ไม่ระบุ'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-4 h-4 text-slate-500\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-slate-700\",children:\"\\u0E2B\\u0E19\\u0E48\\u0E27\\u0E22\\u0E07\\u0E32\\u0E19\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-slate-600\",children:person.deph||'ไม่ระบุ'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\",children:[/*#__PURE__*/_jsx(Crown,{className:\"w-4 h-4 text-slate-500\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-slate-700\",children:\"\\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-slate-600\",children:person.position||'ไม่ระบุ'})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-2 bg-gradient-to-br from-white to-purple-50 rounded-xl p-4 sm:p-5 shadow-lg border border-slate-200/50\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-base sm:text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(FileText,{className:\"w-5 h-5 text-purple-600\"}),\"\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E40\\u0E1E\\u0E34\\u0E48\\u0E21\\u0E40\\u0E15\\u0E34\\u0E21\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 gap-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-slate-700\",children:\"\\u0E2D\\u0E32\\u0E22\\u0E38\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-slate-600 p-2 bg-white/70 rounded-lg\",children:calculateAge(person.dob)})]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t border-slate-200\",children:[person.phone&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>window.open(\"tel:\".concat(formatPhoneNumber(person.phone)),'_self'),className:\"flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5\",children:[/*#__PURE__*/_jsx(Phone,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium\",children:\"\\u0E42\\u0E17\\u0E23\\u0E2B\\u0E32\"})]}),person.email&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>window.open(\"mailto:\".concat(person.email),'_self'),className:\"flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5\",children:[/*#__PURE__*/_jsx(Mail,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium\",children:\"\\u0E2A\\u0E48\\u0E07\\u0E2D\\u0E35\\u0E40\\u0E21\\u0E25\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-slate-500 to-slate-600 text-white rounded-lg hover:from-slate-600 hover:to-slate-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 sm:ml-auto\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium\",children:\"\\u0E1B\\u0E34\\u0E14\"})})]})]})})});});// SearchModal (enhanced with department filtering and game-card style)\n// Small visual card for a person used in search results (game-card style)\nconst PersonCard=/*#__PURE__*/memo(_ref8=>{let{person,onView,onCall,onMail}=_ref8;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-br from-white via-blue-50 to-indigo-100 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 p-4 sm:p-6 border border-indigo-200 hover:border-indigo-300 transform hover:scale-105\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm sm:text-base font-bold text-slate-900 mb-1\",children:[person.prefix,\" \",person.firstname,\" \",person.lastname]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs sm:text-sm text-indigo-600 font-medium\",children:person.position||'ไม่ระบุตำแหน่ง'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-xs sm:text-sm text-slate-600\",children:[/*#__PURE__*/_jsx(Building2,{className:\"w-4 h-4 text-indigo-500 flex-shrink-0\"}),/*#__PURE__*/_jsx(\"span\",{className:\"truncate\",children:person.affiliation||'ไม่ระบุสังกัด'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-xs sm:text-sm text-slate-600\",children:[/*#__PURE__*/_jsx(Briefcase,{className:\"w-4 h-4 text-purple-500 flex-shrink-0\"}),/*#__PURE__*/_jsx(\"span\",{className:\"truncate\",children:person.deph||'ไม่ระบุหน่วยงาน'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onView(person),className:\"w-full px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-xl text-sm font-medium flex items-center justify-center gap-2 transition-all duration-200 shadow-md hover:shadow-lg\",children:[/*#__PURE__*/_jsx(Eye,{className:\"w-4 h-4\"}),\"\\u0E14\\u0E39\\u0E23\\u0E32\\u0E22\\u0E25\\u0E30\\u0E40\\u0E2D\\u0E35\\u0E22\\u0E14\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[person.phone&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onCall(formatPhoneNumber(person.phone)),className:\"flex-1 p-2 rounded-xl bg-green-100 hover:bg-green-200 text-green-600 transition-colors shadow-sm flex items-center justify-center gap-1\",title:\"\\u0E42\\u0E17\\u0E23\",children:[/*#__PURE__*/_jsx(Phone,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"\\u0E42\\u0E17\\u0E23\"})]}),person.email&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onMail(person.email),className:\"flex-1 p-2 rounded-xl bg-blue-100 hover:bg-blue-200 text-blue-600 transition-colors shadow-sm flex items-center justify-center gap-1\",title:\"\\u0E2D\\u0E35\\u0E40\\u0E21\\u0E25\",children:[/*#__PURE__*/_jsx(Mail,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"\\u0E2D\\u0E35\\u0E40\\u0E21\\u0E25\"})]})]})]})]});});const SearchModal=/*#__PURE__*/memo(_ref9=>{let{isOpen,onClose,personnelData=[],stats={},onViewPerson=()=>{},onExport=()=>{},user}=_ref9;const[query,setQuery]=useState('');const[filterAff,setFilterAff]=useState('');const[filterDept,setFilterDept]=useState('');const[filterPos,setFilterPos]=useState('');// Get unique affiliations\nconst affiliations=useMemo(()=>{const setAff=new Set();personnelData.forEach(p=>setAff.add(p.affiliation||'ไม่ระบุ'));return Array.from(setAff).sort();},[personnelData]);// Get departments based on selected affiliation\nconst departments=useMemo(()=>{const relevantPersonnel=filterAff?personnelData.filter(p=>(p.affiliation||'ไม่ระบุ')===filterAff):personnelData;const setDept=new Set();relevantPersonnel.forEach(p=>setDept.add(p.deph||'ไม่ระบุ'));return Array.from(setDept).sort();},[personnelData,filterAff]);// Get positions\nconst positions=useMemo(()=>{const s=new Set();personnelData.forEach(p=>s.add(p.position||'ไม่ระบุ'));return Array.from(s).sort();},[personnelData]);// Reset department when affiliation changes\nuseEffect(()=>{if(filterAff){setFilterDept('');}},[filterAff]);if(!isOpen)return null;const results=personnelData.filter(p=>{const hay=\"\".concat(p.firstname,\" \").concat(p.lastname,\" \").concat(p.position||'',\" \").concat(p.affiliation||'',\" \").concat(p.deph||'').toLowerCase();if(query&&!hay.includes(query.toLowerCase()))return false;if(filterAff&&(p.affiliation||'ไม่ระบุ')!==filterAff)return false;if(filterDept&&(p.deph||'ไม่ระบุ')!==filterDept)return false;if(filterPos&&(p.position||'ไม่ระบุ')!==filterPos)return false;return true;});const handleCall=tel=>window.open(\"tel:\".concat(tel),'_self');const handleMail=email=>window.open(\"mailto:\".concat(email),'_self');const clearFilters=()=>{setFilterAff('');setFilterDept('');setFilterPos('');setQuery('');};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-50 overflow-y-auto bg-black/60 hide-scrollbar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex min-h-screen items-start justify-center p-3 sm:p-6 md:p-10\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative bg-white rounded-2xl sm:rounded-3xl shadow-2xl max-w-6xl w-full p-4 sm:p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4 sm:mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg sm:text-xl font-bold text-slate-900\",children:\"\\uD83D\\uDD0D \\u0E04\\u0E49\\u0E19\\u0E2B\\u0E32\\u0E1A\\u0E38\\u0E04\\u0E25\\u0E32\\u0E01\\u0E23\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors\",children:/*#__PURE__*/_jsx(X,{className:\"w-5 h-5\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6\",children:[/*#__PURE__*/_jsx(\"input\",{value:query,onChange:e=>setQuery(e.target.value),className:\"w-full p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm\",placeholder:\"\\uD83D\\uDD0D \\u0E04\\u0E49\\u0E19\\u0E2B\\u0E32\\u0E0A\\u0E37\\u0E48\\u0E2D, \\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07...\"}),/*#__PURE__*/_jsxs(\"select\",{value:filterAff,onChange:e=>setFilterAff(e.target.value),className:\"p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\uD83C\\uDFE2 \\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14 (\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14)\"}),affiliations.map(a=>/*#__PURE__*/_jsx(\"option\",{value:a,children:a},a))]}),/*#__PURE__*/_jsxs(\"select\",{value:filterDept,onChange:e=>setFilterDept(e.target.value),className:\"p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm\",disabled:!filterAff,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\uD83C\\uDFDB\\uFE0F \\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14 (\\u0E2B\\u0E19\\u0E48\\u0E27\\u0E22\\u0E07\\u0E32\\u0E19)\"}),departments.map(d=>/*#__PURE__*/_jsx(\"option\",{value:d,children:d},d))]}),/*#__PURE__*/_jsxs(\"select\",{value:filterPos,onChange:e=>setFilterPos(e.target.value),className:\"p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\uD83D\\uDC64 \\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14 (\\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07)\"}),positions.map(p=>/*#__PURE__*/_jsx(\"option\",{value:p,children:p},p))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-slate-600 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-4 h-4 text-indigo-500\"}),\"\\u0E1E\\u0E1A \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-indigo-600\",children:results.length}),\" \\u0E23\\u0E32\\u0E22\\u0E01\\u0E32\\u0E23\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:clearFilters,className:\"text-sm text-slate-600 px-3 py-1 rounded-lg bg-slate-100 hover:bg-slate-200 transition-colors\",children:\"\\uD83D\\uDDD1\\uFE0F \\u0E25\\u0E49\\u0E32\\u0E07\\u0E15\\u0E31\\u0E27\\u0E01\\u0E23\\u0E2D\\u0E07\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onExport(results),className:\"text-sm px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Download,{className:\"w-4 h-4\"}),\"\\u0E2A\\u0E48\\u0E07\\u0E2D\\u0E2D\\u0E01\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 max-h-[60vh] overflow-y-auto hide-scrollbar\",children:[results.map((p,i)=>/*#__PURE__*/_jsx(PersonCard,{person:p,onView:onViewPerson,onCall:handleCall,onMail:handleMail},\"\".concat(p.phone||i,\"-\").concat(i))),results.length===0&&/*#__PURE__*/_jsxs(\"div\",{className:\"col-span-full text-center text-slate-500 py-12\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-16 h-16 text-slate-300 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-slate-600 mb-2\",children:\"\\u0E44\\u0E21\\u0E48\\u0E1E\\u0E1A\\u0E1C\\u0E25\\u0E25\\u0E31\\u0E1E\\u0E18\\u0E4C\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:\"\\u0E25\\u0E2D\\u0E07\\u0E40\\u0E1B\\u0E25\\u0E35\\u0E48\\u0E22\\u0E19\\u0E04\\u0E33\\u0E04\\u0E49\\u0E19\\u0E2B\\u0E32\\u0E2B\\u0E23\\u0E37\\u0E2D\\u0E15\\u0E31\\u0E27\\u0E01\\u0E23\\u0E2D\\u0E07\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\"})]})]})]})})});});export default function PersonnelPage(_ref0){let{user}=_ref0;const[loading,setLoading]=useState(true);const[refreshing,setRefreshing]=useState(false);const[error,setError]=useState(\"\");const[personnelData,setPersonnelData]=useState([]);const[selectedPerson,setSelectedPerson]=useState(null);const[showDetail,setShowDetail]=useState(false);const[showSearchModal,setShowSearchModal]=useState(false);const[quota,setQuota]=useState(100);const[vacancy,setVacancy]=useState(20);const[isEditingQuota,setIsEditingQuota]=useState(false);const[isEditingVacancy,setIsEditingVacancy]=useState(false);const[selectedChart,setSelectedChart]=useState(\"position\");// Default chart type\nconst[selectedAffiliation,setSelectedAffiliation]=useState(\"\");// For department filtering\nconst[filters,setFilters]=useState({affiliation:\"\",department:\"\",ageRange:\"\",gender:\"\"});const logAdminActivity=useCallback((action,details)=>{if(!user)return;fetch(CONFIG.ADMIN_API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'log_activity',log_action:action,log_details:details||null,user_id:user.id,username:user.username})}).catch(error=>console.error('Failed to log activity:',error));},[user]);const fetchPersonnelData=useCallback(async()=>{try{const apiUrl=CONFIG.OFFICERS_API;const response=await fetch(apiUrl);if(!response.ok)throw new Error(\"HTTP error! status: \".concat(response.status));const text=await response.text();if(!text)throw new Error('Empty response from server');const result=JSON.parse(text);const data=result.success&&Array.isArray(result.data)?result.data:[];const formattedData=data.map(person=>({phone:person.phone||'',prefix:person.prefix||'',firstname:person.firstname||'',lastname:person.lastname||'',position:person.position||'',affiliation:person.affiliation||'',deph:person.department||'',generation:person.generation||'',email:person.email||'',dob:person.dob||'',lineUserId:person.lineUserId||'',role:person.role||'member'}));setPersonnelData(formattedData);setError(\"\");}catch(error){setError(\"\\u26A0\\uFE0F \".concat(error.message));setPersonnelData([]);}},[]);useEffect(()=>{fetchPersonnelData();},[fetchPersonnelData]);const handleRefresh=()=>{setRefreshing(true);fetchPersonnelData().finally(()=>setRefreshing(false));};const handleViewPerson=person=>{// If user opened from search, close search modal first so detail appears on top\nsetShowSearchModal(false);setSelectedPerson(person);setShowDetail(true);};const exportToCSV=data=>{// Implement CSV export logic here\n};const affiliationAbbreviations={\"ศูนย์รักษาความปลอดภัย\":\"ส่วนกลาง\",\"ศาลชั้นต้นในกรุงเทพมหานคร\":\"กทม.\"};const filteredAffiliationData=useMemo(()=>{return personnelData.reduce((acc,person)=>{let affiliation=(person.affiliation||'').trim();if(!affiliation)affiliation='ไม่ระบุ';const lower=affiliation.toLowerCase();// Normalize known patterns using targeted rules\nlet normalized=affiliation;// If it's the regional office pattern that contains สำนักศาลยุติธรรมประจำภาค\n// we want to convert it to: 'ภาค <n>' when a number exists, otherwise 'ภาค'\nif(lower.includes('สำนักศาลยุติธรรมประจำภาค')||lower.includes('สำนักยุติธรรมประจำภาค')||lower.includes('ในสังกัดสำนักศาลยุติธรรมประจำภาค')||lower.includes('ศาลในสังกัดสำนักศาลยุติธรรมประจำภาค')){// Try to extract explicit 'ภาค <number>' first\nconst matchRegion=affiliation.match(/ภาค\\s*(\\d{1,3})/i);if(matchRegion&&matchRegion[1]){normalized=\"\\u0E20\\u0E32\\u0E04 \".concat(matchRegion[1]);}else{// Fallback: find any trailing number in the string (e.g., '... ประจำภาค 4')\nconst trailingNum=affiliation.match(/(\\d{1,3})\\s*$/);if(trailingNum&&trailingNum[1]){normalized=\"\\u0E20\\u0E32\\u0E04 \".concat(trailingNum[1]);}else{// Last-resort: any first number in the string\nconst anyNum=affiliation.match(/(\\d{1,3})/);normalized=anyNum&&anyNum[1]?\"\\u0E20\\u0E32\\u0E04 \".concat(anyNum[1]):'ภาค';}}}else if(lower.includes('ศูนย์รักษาความปลอดภัย')){normalized='ส่วนกลาง';}else if(lower.includes('กรุงเทพ')||lower.includes('กรุงเทพมหานคร')||lower.includes('ศาลชั้นต้นในกรุงเทพมหานคร')){normalized='กทม.';}else{// fallback to any exact mapping we defined, otherwise keep original\nnormalized=affiliationAbbreviations[affiliation]||affiliation;}acc[normalized]=(acc[normalized]||0)+1;return acc;},{});},[personnelData]);const chartData=useMemo(()=>{const entries=Object.entries(filteredAffiliationData).map(_ref1=>{let[label,value]=_ref1;return{label,value};});const getOrderKey=label=>{if(!label)return 9999;const l=String(label).trim();// Match 'ภาค' followed by number e.g. 'ภาค 1' or 'ภาค1'\nconst m=l.match(/ภาค\\s*(\\d{1,3})/);if(m&&m[1]){// Put ภาค N in order 0.. (keep N small)\nconst num=parseInt(m[1],10);return num;// 1..9 -> 1..9 (smaller is earlier)\n}// If label is exactly 'ภาค' (no number), put after numbered ภาค\nif(/^ภาค$/i.test(l))return 999;// Specific named orders after ภาค group\nif(l==='กทม.'||l.toLowerCase()==='กทม.')return 1000;if(l==='ส่วนกลาง'||l.toLowerCase()==='ส่วนกลาง')return 1001;if(l.includes('ศาลสูง'))return 1002;// handle both spellings 'ชำนาญ' and 'ชำนัญ'\nif(l.includes('ชำนาญ')||l.includes('ชำนัญ')||l.includes('ชำนัญพิเศษ')||l.includes('ชำนาญพิเศษ'))return 1003;// Default: place after known groups but preserve alphabetical order by returning a high key plus name\nreturn 5000+l.charCodeAt(0);};entries.sort((a,b)=>{const ka=getOrderKey(a.label);const kb=getOrderKey(b.label);if(ka===kb){// fallback alphabetical\nreturn String(a.label).localeCompare(String(b.label));}return ka-kb;});return entries;},[filteredAffiliationData]);const stats=useMemo(()=>{const newStats={total:personnelData.length,connected:personnelData.filter(p=>p.lineUserId).length,byPosition:{},byAffiliation:{},byDepartment:{},byGeneration:{}};personnelData.forEach(person=>{const position=person.position||'ไม่ระบุ';newStats.byPosition[position]=(newStats.byPosition[position]||0)+1;const affiliation=person.affiliation||'ไม่ระบุ';newStats.byAffiliation[affiliation]=(newStats.byAffiliation[affiliation]||0)+1;const department=person.deph||'ไม่ระบุตำแหน่ง';newStats.byDepartment[department]=(newStats.byDepartment[department]||0)+1;const generation=person.generation?String(person.generation).trim():'ไม่ระบุตำแหน่ง';newStats.byGeneration[generation]=(newStats.byGeneration[generation]||0)+1;});return newStats;},[personnelData]);useEffect(()=>{console.log(\"Personnel Data:\",personnelData);},[personnelData]);useEffect(()=>{console.log(\"Stats:\",stats);console.log(\"Chart Data:\",chartData);},[stats,chartData]);const chartColors=[\"#FF6384\",\"#36A2EB\",\"#FFCE56\",\"#4BC0C0\",\"#9966FF\",\"#FF9F40\",\"#FFCD56\",\"#C9CBCF\"];// Helper: build chart data for different types (inside component)\nconst getChartData=useCallback(type=>{if(type==='affiliation')return chartData;// already normalized affiliation entries\nif(type==='position'){// build from stats.byPosition\nconst entries=Object.entries(stats.byPosition||{}).map(_ref10=>{let[label,value]=_ref10;return{label,value};});// sort by value desc\nentries.sort((a,b)=>b.value-a.value);return entries;}if(type==='department'){// build from deph field - filter by selected affiliation if any\nconst groups={};const filteredData=selectedAffiliation?personnelData.filter(p=>(p.affiliation||'ไม่ระบุ')===selectedAffiliation):personnelData;filteredData.forEach(p=>{const dept=p.deph||'ไม่ระบุ';groups[dept]=(groups[dept]||0)+1;});return Object.entries(groups).map(_ref11=>{let[label,value]=_ref11;return{label,value};}).sort((a,b)=>b.value-a.value);}if(type==='age'){// derive age groups from dob (basic)\nconst groups={'<30':0,'30-39':0,'40-49':0,'50-59':0,'60+':0};const now=new Date();personnelData.forEach(p=>{if(!p.dob)return;const m=String(p.dob).match(/(\\d{4})/);if(!m)return;const year=parseInt(m[1],10);if(isNaN(year))return;const age=now.getFullYear()-year;if(age<30)groups['<30']++;else if(age<40)groups['30-39']++;else if(age<50)groups['40-49']++;else if(age<60)groups['50-59']++;else groups['60+']++;});return Object.entries(groups).map(_ref12=>{let[label,value]=_ref12;return{label,value};});}if(type==='gender'){// no gender field in data - return empty to show no data\nconst genders=(personnelData||[]).reduce((acc,p)=>{const g=(p.gender||'').trim();if(!g)return acc;acc[g]=(acc[g]||0)+1;return acc;},{});return Object.entries(genders).map(_ref13=>{let[label,value]=_ref13;return{label,value};});}return[];},[chartData,stats,personnelData,selectedAffiliation]);// Add selectedAffiliation dependency\n// Helper function to get chart title\nconst getChartTitle=chartType=>{switch(chartType){case\"position\":return\"ตำแหน่ง\";case\"affiliation\":return\"สัดส่วนแต่ละสังกัด\";case\"department\":return selectedAffiliation?\"\\u0E2B\\u0E19\\u0E48\\u0E27\\u0E22\\u0E07\\u0E32\\u0E19\\u0E43\\u0E19\".concat(selectedAffiliation):\"หน่วยงาน (เลือกสังกัดก่อน)\";case\"gender\":return\"เพศ\";case\"age\":return\"ช่วงอายุ\";default:return\"ข้อมูลบุคลากร\";}};const renderChart=()=>{switch(selectedChart){case\"position\":return/*#__PURE__*/_jsx(HorizontalBarChart,{data:getChartData('position'),colors:chartColors,title:\"\\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07\",maxHeight:\"320px\"});case\"affiliation\":return/*#__PURE__*/_jsx(HorizontalBarChart,{data:getChartData('affiliation'),colors:chartColors,title:\"\\u0E2A\\u0E31\\u0E14\\u0E2A\\u0E48\\u0E27\\u0E19\\u0E41\\u0E15\\u0E48\\u0E25\\u0E30\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\",maxHeight:\"320px\"});case\"department\":return/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:!selectedAffiliation?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(Building2,{className:\"w-16 h-16 text-slate-300 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-slate-600 mb-2\",children:\"\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\\u0E01\\u0E48\\u0E2D\\u0E19\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-slate-500 mb-4\",children:\"\\u0E01\\u0E23\\u0E38\\u0E13\\u0E32\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\\u0E40\\u0E1E\\u0E37\\u0E48\\u0E2D\\u0E14\\u0E39\\u0E2B\\u0E19\\u0E48\\u0E27\\u0E22\\u0E07\\u0E32\\u0E19\\u0E43\\u0E19\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\\u0E19\\u0E31\\u0E49\\u0E19\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedAffiliation,onChange:e=>setSelectedAffiliation(e.target.value),className:\"p-2 border border-slate-300 rounded-lg\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\"}),Array.from(new Set(personnelData.map(p=>p.affiliation||'ไม่ระบุ'))).sort().map(aff=>/*#__PURE__*/_jsx(\"option\",{value:aff,children:aff},aff))]})]}):/*#__PURE__*/_jsx(HorizontalBarChart,{data:getChartData('department'),colors:chartColors,title:\"\\u0E2B\\u0E19\\u0E48\\u0E27\\u0E22\\u0E07\\u0E32\\u0E19\\u0E43\\u0E19\".concat(selectedAffiliation),maxHeight:\"320px\"})});case\"gender\":return/*#__PURE__*/_jsx(PieChartComponent,{data:getChartData('gender'),colors:chartColors,title:\"\\u0E40\\u0E1E\\u0E28\"});case\"age\":return/*#__PURE__*/_jsx(HorizontalBarChart,{data:getChartData('age'),colors:chartColors,title:\"\\u0E0A\\u0E48\\u0E27\\u0E07\\u0E2D\\u0E32\\u0E22\\u0E38\",maxHeight:\"240px\"});default:return/*#__PURE__*/_jsx(\"p\",{children:\"\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E41\\u0E2A\\u0E14\\u0E07\\u0E1C\\u0E25\"});}};return/*#__PURE__*/_jsxs(\"div\",{className:\"w-full min-h-full p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-xl sm:text-2xl font-bold text-slate-800\",children:\"\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E1A\\u0E38\\u0E04\\u0E25\\u0E32\\u0E01\\u0E23\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-3\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowSearchModal(true),className:\"flex items-center space-x-2 px-3 sm:px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow text-sm transition-colors\",children:[/*#__PURE__*/_jsx(Search,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0E04\\u0E49\\u0E19\\u0E2B\\u0E32\\u0E1A\\u0E38\\u0E04\\u0E25\\u0E32\\u0E01\\u0E23\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8\",children:[/*#__PURE__*/_jsx(EditableCard,{title:\"\\u0E01\\u0E23\\u0E2D\\u0E1A\\u0E2D\\u0E31\\u0E15\\u0E23\\u0E32\",value:quota,icon:Briefcase,color:\"blue\",isEditing:isEditingQuota,onEdit:()=>setIsEditingQuota(!isEditingQuota),onChange:value=>setQuota(value),isAdmin:(user===null||user===void 0?void 0:user.role)==='admin'}),/*#__PURE__*/_jsx(EditableCard,{title:\"\\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07\\u0E27\\u0E48\\u0E32\\u0E07\",value:vacancy,icon:UserX,color:\"red\",isEditing:isEditingVacancy,onEdit:()=>setIsEditingVacancy(!isEditingVacancy),onChange:value=>setVacancy(value),isAdmin:(user===null||user===void 0?void 0:user.role)==='admin'}),/*#__PURE__*/_jsx(StatCard,{title:\"\\u0E1A\\u0E38\\u0E04\\u0E25\\u0E32\\u0E01\\u0E23\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\",value:stats.total,icon:Users,color:\"green\",subtitle:\"\\u0E17\\u0E31\\u0E49\\u0E07\\u0E2B\\u0E21\\u0E14\\u0E43\\u0E19\\u0E23\\u0E30\\u0E1A\\u0E1A\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap items-center gap-2 sm:gap-4 mb-4 sm:mb-6\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedChart(\"position\"),className:\"px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors \".concat(selectedChart===\"position\"?\"bg-indigo-600 text-white\":\"bg-gray-200 text-gray-800 hover:bg-gray-300\"),children:\"\\u0E15\\u0E33\\u0E41\\u0E2B\\u0E19\\u0E48\\u0E07\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedChart(\"affiliation\"),className:\"px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors \".concat(selectedChart===\"affiliation\"?\"bg-indigo-600 text-white\":\"bg-gray-200 text-gray-800 hover:bg-gray-300\"),children:\"\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setSelectedChart(\"department\");if(!selectedAffiliation){// Auto-select first affiliation if none selected\nconst affiliations=Array.from(new Set(personnelData.map(p=>p.affiliation||'ไม่ระบุ'))).sort();if(affiliations.length>0){setSelectedAffiliation(affiliations[0]);}}},className:\"px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors \".concat(selectedChart===\"department\"?\"bg-indigo-600 text-white\":\"bg-gray-200 text-gray-800 hover:bg-gray-300\"),children:\"\\u0E2B\\u0E19\\u0E48\\u0E27\\u0E22\\u0E07\\u0E32\\u0E19\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedChart(\"gender\"),className:\"px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors \".concat(selectedChart===\"gender\"?\"bg-indigo-600 text-white\":\"bg-gray-200 text-gray-800 hover:bg-gray-300\"),children:\"\\u0E40\\u0E1E\\u0E28\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedChart(\"age\"),className:\"px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors \".concat(selectedChart===\"age\"?\"bg-indigo-600 text-white\":\"bg-gray-200 text-gray-800 hover:bg-gray-300\"),children:\"\\u0E0A\\u0E48\\u0E27\\u0E07\\u0E2D\\u0E32\\u0E22\\u0E38\"}),selectedChart===\"department\"&&/*#__PURE__*/_jsxs(\"select\",{value:selectedAffiliation,onChange:e=>setSelectedAffiliation(e.target.value),className:\"ml-2 p-2 border border-slate-300 rounded-lg text-sm bg-white\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2A\\u0E31\\u0E07\\u0E01\\u0E31\\u0E14\"}),Array.from(new Set(personnelData.map(p=>p.affiliation||'ไม่ระบุ'))).sort().map(aff=>/*#__PURE__*/_jsx(\"option\",{value:aff,children:aff},aff))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 min-h-[600px]\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-base sm:text-lg font-semibold text-slate-800 mb-4\",children:\"\\u0E01\\u0E23\\u0E32\\u0E1F\\u0E41\\u0E17\\u0E48\\u0E07\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-[520px] overflow-y-auto\",children:renderChart()})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 min-h-[600px]\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-base sm:text-lg font-semibold text-slate-800 mb-4\",children:\"\\u0E01\\u0E23\\u0E32\\u0E1F\\u0E27\\u0E07\\u0E01\\u0E25\\u0E21\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-[520px] overflow-y-auto\",children:/*#__PURE__*/_jsx(PieChartComponent,{data:getChartData(selectedChart),colors:chartColors,title:getChartTitle(selectedChart)})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 min-h-[600px]\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-base sm:text-lg font-semibold text-slate-800 mb-4\",children:\"\\u0E01\\u0E23\\u0E32\\u0E1F\\u0E42\\u0E14\\u0E19\\u0E31\\u0E17\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-[520px] overflow-y-auto\",children:/*#__PURE__*/_jsx(DonutChart,{data:getChartData(selectedChart),colors:chartColors,title:getChartTitle(selectedChart)})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 min-h-[600px]\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-base sm:text-lg font-semibold text-slate-800 mb-4\",children:\"\\u0E01\\u0E23\\u0E32\\u0E1F\\u0E40\\u0E2A\\u0E49\\u0E19\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-[520px] overflow-y-auto\",children:/*#__PURE__*/_jsx(LineChart,{data:getChartData(selectedChart),colors:chartColors,title:getChartTitle(selectedChart)})})]})]}),/*#__PURE__*/_jsx(PersonnelDetailModal,{person:selectedPerson,isOpen:showDetail,onClose:()=>setShowDetail(false)}),/*#__PURE__*/_jsx(SearchModal,{isOpen:showSearchModal,onClose:()=>setShowSearchModal(false),personnelData:personnelData,stats:stats,onViewPerson:handleViewPerson,onExport:exportToCSV,user:user})]});}","map":{"version":3,"names":["React","useEffect","useState","useMemo","useCallback","memo","Search","Filter","Users","Phone","Mail","Calendar","Award","Building2","UserCheck","UserX","TrendingUp","PieChart","BarChart3","Download","RefreshCw","Eye","Grid3X3","List","X","AlertCircle","CheckCircle2","Clock","Briefcase","GraduationCap","Edit2","Save","MapPin","Building","Crown","FileText","CONFIG","DonutChart","LineChart","jsx","_jsx","jsxs","_jsxs","formatPhoneNumber","phone","cleanPhone","replace","length","StatCard","_ref","title","value","icon","Icon","color","trend","subtitle","className","children","concat","TableChart","_ref2","data","colors","total","reduce","sum","d","slice","map","item","index","percentage","toFixed","style","backgroundColor","label","truncatePosition","position","removePatterns","result","pattern","RegExp","trim","truncateAffiliation","affiliation","lower","toLowerCase","includes","TreemapChart","_ref3","originalTotal","scaledData","_objectSpread","scaledValue","Math","log1p","generateTreemapLayout","items","width","height","rects","layoutRow","rowItems","x","y","w","h","totalValue","i","offset","isHorizontal","rectWidth","push","rectHeight","squarify","halfValue","runningTotal","splitIndex","max","groupA","groupB","groupATotal","groupAWidth","groupAHeight","layout","rect","itemIndex","findIndex","valueText","fontSize","min","textShadowStyle","textShadow","left","top","transition","PieChartComponent","_ref4","viewBox","angle","prevPercentage","startAngle","endAngle","outerRadius","innerRadius","startXOuter","cos","PI","startYOuter","sin","endXOuter","endYOuter","startXInner","startYInner","endXInner","endYInner","largeArcFlag","pathData","join","pieColors","midAngle","labelRadius","labelX","labelY","percentageText","fill","stroke","strokeWidth","textAnchor","dominantBaseline","fontWeight","paintOrder","HorizontalBarChart","_ref5","maxHeight","getSortOrder","regionMatch","match","parseInt","customOrder","sortedData","sort","a","b","maxValue","overflowY","paddingRight","barWidth","minWidth","EditableCard","_ref6","isEditing","onEdit","onChange","isAdmin","localValue","setLocalValue","handleChange","e","newValue","target","onClick","type","PersonnelDetailModal","_ref7","person","isOpen","onClose","calculateAge","dob","birthDate","Date","today","age","getFullYear","monthDiff","getMonth","getDate","error","firstname","prefix","lastname","email","deph","window","open","PersonCard","_ref8","onView","onCall","onMail","SearchModal","_ref9","personnelData","stats","onViewPerson","onExport","user","query","setQuery","filterAff","setFilterAff","filterDept","setFilterDept","filterPos","setFilterPos","affiliations","setAff","Set","forEach","p","add","Array","from","departments","relevantPersonnel","filter","setDept","positions","s","results","hay","handleCall","tel","handleMail","clearFilters","placeholder","disabled","PersonnelPage","_ref0","loading","setLoading","refreshing","setRefreshing","setError","setPersonnelData","selectedPerson","setSelectedPerson","showDetail","setShowDetail","showSearchModal","setShowSearchModal","quota","setQuota","vacancy","setVacancy","isEditingQuota","setIsEditingQuota","isEditingVacancy","setIsEditingVacancy","selectedChart","setSelectedChart","selectedAffiliation","setSelectedAffiliation","filters","setFilters","department","ageRange","gender","logAdminActivity","action","details","fetch","ADMIN_API","method","headers","body","JSON","stringify","log_action","log_details","user_id","id","username","catch","console","fetchPersonnelData","apiUrl","OFFICERS_API","response","ok","Error","status","text","parse","success","isArray","formattedData","generation","lineUserId","role","message","handleRefresh","finally","handleViewPerson","exportToCSV","affiliationAbbreviations","filteredAffiliationData","acc","normalized","matchRegion","trailingNum","anyNum","chartData","entries","Object","_ref1","getOrderKey","l","String","m","num","test","charCodeAt","ka","kb","localeCompare","newStats","connected","byPosition","byAffiliation","byDepartment","byGeneration","log","chartColors","getChartData","_ref10","groups","filteredData","dept","_ref11","now","year","isNaN","_ref12","genders","g","_ref13","getChartTitle","chartType","renderChart","aff"],"sources":["C:/Users/LENOVO/Documents/GitHub/court-marshal-connect/src/pages/PersonnelPage.js"],"sourcesContent":["import React, { useEffect, useState, useMemo, useCallback, memo } from \"react\";\r\nimport { \r\n  Search, \r\n  Filter, \r\n  Users, \r\n  Phone, \r\n  Mail, \r\n  Calendar,\r\n  Award,\r\n  Building2,\r\n  UserCheck,\r\n  UserX,\r\n  TrendingUp,\r\n  PieChart,\r\n  BarChart3,\r\n  Download,\r\n  RefreshCw,\r\n  Eye,\r\n  Grid3X3,\r\n  List,\r\n  X,\r\n  AlertCircle,\r\n  CheckCircle2,\r\n  Clock,\r\n  Briefcase,\r\n  GraduationCap,\r\n  Edit2,\r\n  Save,\r\n  MapPin,\r\n  Building,\r\n  Crown,\r\n  FileText\r\n} from \"lucide-react\";\r\nimport { CONFIG } from '../config';\r\nimport DonutChart from '../components/DonutChart';\r\nimport LineChart from '../components/LineChart';\r\n\r\n// Function to format phone number (add leading 0 if needed)\r\nconst formatPhoneNumber = (phone) => {\r\n  if (!phone) return '';\r\n  const cleanPhone = phone.replace(/\\D/g, ''); // Remove non-digits\r\n  if (cleanPhone.length === 9) {\r\n    return '0' + cleanPhone; // Add leading 0 for 9-digit numbers\r\n  }\r\n  return cleanPhone; // Return as-is for other lengths\r\n};\r\n\r\n\r\n\r\n// StatCard Component\r\nconst StatCard = memo(({ title, value, icon: Icon, color = \"blue\", trend, subtitle }) => (\r\n  <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\r\n    <div className=\"flex items-center justify-between mb-2\">\r\n      <div className={`w-12 h-12 bg-${color}-100 rounded-xl flex items-center justify-center`}>\r\n        <Icon className={`w-6 h-6 text-${color}-600`} />\r\n      </div>\r\n      {trend && (\r\n        <div className=\"flex items-center text-green-600 text-sm\">\r\n          <TrendingUp className=\"w-4 h-4 mr-1\" />\r\n          <span>{trend}%</span>\r\n        </div>\r\n      )}\r\n    </div>\r\n    <div className=\"text-3xl font-bold text-slate-900 mb-1\">{value}</div>\r\n    <div className=\"text-sm text-slate-600\">{title}</div>\r\n    {subtitle && (\r\n      <div className=\"text-xs text-slate-500 mt-1\">{subtitle}</div>\r\n    )}\r\n  </div>\r\n));\r\n\r\n// Table Chart Component (สำหรับแสดงข้อมูลตำแหน่งแบบตาราง)\r\nconst TableChart = memo(({ title, data, colors = [] }) => {\r\n  const total = useMemo(() => data.reduce((sum, d) => sum + d.value, 0), [data]);\r\n  \r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\r\n      <h3 className=\"text-lg font-semibold text-slate-900 mb-4 flex items-center\">\r\n        <BarChart3 className=\"w-5 h-5 mr-2 text-slate-400\" />\r\n        {title}\r\n      </h3>\r\n      <div className=\"space-y-3\">\r\n        <div className=\"text-center mb-4\">\r\n          <div className=\"text-2xl font-bold text-slate-900\">{total}</div>\r\n          <div className=\"text-sm text-slate-500\">ทั้งหมด</div>\r\n        </div>\r\n        \r\n        <div className=\"grid gap-2\">\r\n          {data.slice(0, 8).map((item, index) => {\r\n            const percentage = ((item.value / total) * 100).toFixed(1);\r\n            const color = colors[index % colors.length] || '#6366f1';\r\n            \r\n            return (\r\n              <div key={`${item.label}-${index}`} className=\"flex items-center justify-between p-3 bg-slate-50 rounded-lg\">\r\n                <div className=\"flex items-center space-x-3 flex-1 min-w-0\">\r\n                  <div \r\n                    className=\"w-4 h-4 rounded-sm flex-shrink-0\"\r\n                    style={{ backgroundColor: color }}\r\n                  />\r\n                  <span className=\"text-sm text-slate-700 font-medium truncate\" title={item.label}>\r\n                    {item.label}\r\n                  </span>\r\n                </div>\r\n                <div className=\"flex items-center space-x-2 text-right\">\r\n                  <div className=\"text-sm font-bold text-slate-900\">{item.value}</div>\r\n                  <div className=\"text-xs text-slate-500\">{percentage}%</div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// Function สำหรับตัดคำยาว\r\nconst truncatePosition = (position) => {\r\n  if (!position) return '';\r\n  \r\n  const removePatterns = [\r\n    'เจ้าพนักงานตำรวจศาล',\r\n    'ตำรวจศาล',\r\n    'ตำรวจ',\r\n    'พนักงาน'\r\n  ];\r\n  \r\n  let result = position;\r\n  for (const pattern of removePatterns) {\r\n    result = result.replace(new RegExp(pattern, 'gi'), '');\r\n  }\r\n  \r\n  return result.trim() || position;\r\n};\r\n\r\n// Function สำหรับตัดคำ \"ศาล\" ออกจากสังกัด\r\nconst truncateAffiliation = (affiliation) => {\r\n  if (!affiliation) return '';\r\n  const lower = affiliation.toLowerCase();\r\n\r\n  // Only remove the leading word 'ศาล' for affiliations that describe\r\n  // 'ในสังกัดสำนักยุติธรรมประจำภาค' (or variants). Do not strip 'ศาล'\r\n  // from other court names like 'ศาลสูง' or 'ศาลชำนาญพิเศษ'.\r\n  if (lower.includes('ในสังกัดสำนักยุติธรรมประจำภาค') || lower.includes('ในสังกัดสำนักยุติธรรม')) {\r\n    return affiliation.replace(/^ศาล\\s*/i, '').trim() || affiliation;\r\n  }\r\n\r\n  // Otherwise return affiliation unchanged\r\n  return affiliation;\r\n};\r\n\r\n// --- NEW: Proportional Treemap Chart Component ---\r\n// --- NEW: Proportional Treemap Chart Component (MODIFIED FOR LOGARITHMIC SCALE) ---\r\nconst TreemapChart = memo(({ title, data, colors = [] }) => {\r\n  // --- ส่วนที่แก้ไข: คำนวณ total จากค่าจริงก่อนแปลงสเกล ---\r\n  const originalTotal = useMemo(() => data.reduce((sum, d) => sum + d.value, 0), [data]);\r\n\r\n  // --- ส่วนที่แก้ไข: สร้างข้อมูลชุดใหม่ที่มีการปรับสเกลด้วย Math.log1p ---\r\n  // Math.log1p(x) จะคำนวณ log(1+x) ช่วยให้ค่าที่น้อยๆ มีขนาดใหญ่ขึ้นเมื่อเทียบกับค่ามากๆ\r\n  const scaledData = useMemo(() => data.map(item => ({\r\n    ...item,\r\n    scaledValue: Math.log1p(item.value) \r\n  })), [data]);\r\n\r\n  const generateTreemapLayout = useCallback((items, width, height) => {\r\n    let rects = [];\r\n    const layoutRow = (rowItems, x, y, w, h) => {\r\n      if (!rowItems.length) return;\r\n      // --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\r\n      const totalValue = rowItems.reduce((sum, i) => sum + i.scaledValue, 0);\r\n      if (totalValue === 0) return;\r\n      let offset = 0;\r\n      const isHorizontal = w > h;\r\n      for (const item of rowItems) {\r\n        // --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\r\n        const percentage = item.scaledValue / totalValue;\r\n        if (isHorizontal) {\r\n          const rectWidth = w * percentage;\r\n          rects.push({ x: x + offset, y, width: rectWidth, height: h, item });\r\n          offset += rectWidth;\r\n        } else {\r\n          const rectHeight = h * percentage;\r\n          rects.push({ x, y: y + offset, width: w, height: rectHeight, item });\r\n          offset += rectHeight;\r\n        }\r\n      }\r\n    };\r\n    const squarify = (items, x, y, w, h) => {\r\n      if (!items.length) return;\r\n      if (items.length <= 4) {\r\n        layoutRow(items, x, y, w, h);\r\n        return;\r\n      }\r\n      // --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\r\n      const halfValue = items.reduce((sum, i) => sum + i.scaledValue, 0) / 2;\r\n      let runningTotal = 0;\r\n      let splitIndex = 0;\r\n      for (let i = 0; i < items.length; i++) {\r\n        // --- ส่วนที่แก้ไข: ใช้ scaledValue ในการคำนวณสัดส่วน ---\r\n        runningTotal += items[i].scaledValue;\r\n        if (runningTotal >= halfValue) {\r\n          splitIndex = i + 1;\r\n          break;\r\n        }\r\n      }\r\n      splitIndex = Math.max(1, splitIndex);\r\n      const groupA = items.slice(0, splitIndex);\r\n      const groupB = items.slice(splitIndex);\r\n      const groupATotal = groupA.reduce((sum, i) => sum + i.scaledValue, 0);\r\n      const totalValue = groupATotal + (groupB.reduce((sum, i) => sum + i.scaledValue, 0));\r\n\r\n      if (totalValue === 0) return;\r\n      if (w > h) {\r\n        const groupAWidth = w * (groupATotal / totalValue);\r\n        squarify(groupA, x, y, groupAWidth, h);\r\n        squarify(groupB, x + groupAWidth, y, w - groupAWidth, h);\r\n      } else {\r\n        const groupAHeight = h * (groupATotal / totalValue);\r\n        squarify(groupA, x, y, w, groupAHeight);\r\n        squarify(groupB, x, y + groupAHeight, w, h - groupAHeight);\r\n      }\r\n    };\r\n    squarify(items, 0, 0, 1000, 1000); // Use a relative base for layout\r\n    return rects;\r\n  }, []);\r\n\r\n  // --- ส่วนที่แก้ไข: ส่ง scaledData เข้าไปคำนวณ layout ---\r\n  const layout = useMemo(() => generateTreemapLayout(scaledData), [scaledData, generateTreemapLayout]);\r\n\r\n  if (!data.length || originalTotal === 0) {\r\n    return (\r\n      <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 h-full\">\r\n        <h3 className=\"text-lg font-semibold text-slate-900 mb-4 flex items-center\"><BarChart3 className=\"w-5 h-5 mr-2 text-slate-400\" />{title}</h3>\r\n        <div className=\"text-center py-8\"><p className=\"text-slate-500\">ไม่มีข้อมูลสำหรับแสดงกราฟ</p></div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 flex flex-col h-full\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h3 className=\"text-lg font-semibold text-slate-900 flex items-center\">\r\n          <BarChart3 className=\"w-5 h-5 mr-2 text-slate-400\" />{title}\r\n        </h3>\r\n        <div className=\"text-right\">\r\n          {/* --- ส่วนที่แก้ไข: แสดงผลรวมจากค่าจริง --- */}\r\n          <div className=\"text-lg font-bold text-slate-900\">{originalTotal}</div>\r\n          <div className=\"text-xs text-slate-500\">ทั้งหมด</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"relative w-full flex-1\">\r\n        {layout.map((rect) => {\r\n          const itemIndex = scaledData.findIndex(d => d.label === rect.item.label);\r\n          const color = colors[itemIndex % colors.length];\r\n          \r\n          // --- ส่วนที่แก้ไข: คำนวณ % จากค่าจริง ---\r\n          const percentage = originalTotal > 0 ? ((rect.item.value / originalTotal) * 100).toFixed(1) : 0;\r\n          const valueText = `${rect.item.value} (${percentage}%)`;\r\n          const fontSize = Math.min(rect.width / 10, rect.height / 5, 16);\r\n          const textShadowStyle = { textShadow: '0px 1px 3px rgba(0, 0, 0, 0.6)' };\r\n\r\n          return (\r\n            <div\r\n              key={rect.item.label}\r\n              className=\"absolute border-2 border-white rounded-md flex flex-col items-center justify-center p-1 overflow-hidden text-center\"\r\n              style={{\r\n                left: `${rect.x / 10}%`, top: `${rect.y / 10}%`, width: `${rect.width / 10}%`, height: `${rect.height / 10}%`,\r\n                backgroundColor: color, transition: 'all 0.4s ease-in-out'\r\n              }}\r\n            >\r\n              <div className=\"text-white font-bold\" style={{ fontSize: `${fontSize}px`, ...textShadowStyle }}>\r\n                {valueText}\r\n              </div>\r\n              <div className=\"text-white opacity-90 leading-tight\" style={{ fontSize: `${Math.max(fontSize * 0.7, 10)}px`, ...textShadowStyle }}>\r\n                {rect.item.label}\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// Pie Chart Component - เปลี่ยนเป็น Donut Chart\r\nconst PieChartComponent = memo(({ title, data, colors = [] }) => {\r\n  const total = useMemo(() => data.reduce((sum, d) => sum + d.value, 0), [data]);\r\n  \r\n  if (!data.length || total === 0) {\r\n    return (\r\n      <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\r\n        <h3 className=\"text-lg font-semibold text-slate-900 mb-4 flex items-center\">\r\n          <PieChart className=\"w-5 h-5 mr-2 text-slate-400\" />\r\n          {title}\r\n        </h3>\r\n        <div className=\"text-center py-8\">\r\n          <p className=\"text-slate-500\">ไม่มีข้อมูลสำหรับแสดงกราฟ</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 h-fit\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h3 className=\"text-lg font-semibold text-slate-900 flex items-center\">\r\n          <PieChart className=\"w-5 h-5 mr-2 text-slate-400\" />\r\n          {title}\r\n        </h3>\r\n        <div className=\"text-right\">\r\n          <div className=\"text-lg font-bold text-slate-900\">จำนวน {total} คน</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"relative border border-slate-200 rounded-lg p-4 bg-slate-50\">\r\n        <div className=\"flex flex-col items-center\">\r\n          {/* Donut Chart */}\r\n          <div className=\"relative w-48 h-48\">\r\n            <svg width=\"192\" height=\"192\" viewBox=\"0 0 192 192\" className=\"w-full h-full\">\r\n              {data.map((item, index) => {\r\n                const percentage = item.value / total;\r\n                const angle = percentage * 360;\r\n                \r\n                const prevPercentage = data.slice(0, index).reduce((sum, d) => sum + d.value, 0) / total;\r\n                const startAngle = prevPercentage * 360 - 90;\r\n                const endAngle = startAngle + angle;\r\n                \r\n                // Donut chart - outer radius 80, inner radius 45\r\n                const outerRadius = 80;\r\n                const innerRadius = 45;\r\n                \r\n                const startXOuter = 96 + outerRadius * Math.cos((startAngle * Math.PI) / 180);\r\n                const startYOuter = 96 + outerRadius * Math.sin((startAngle * Math.PI) / 180);\r\n                const endXOuter = 96 + outerRadius * Math.cos((endAngle * Math.PI) / 180);\r\n                const endYOuter = 96 + outerRadius * Math.sin((endAngle * Math.PI) / 180);\r\n                \r\n                const startXInner = 96 + innerRadius * Math.cos((endAngle * Math.PI) / 180);\r\n                const startYInner = 96 + innerRadius * Math.sin((endAngle * Math.PI) / 180);\r\n                const endXInner = 96 + innerRadius * Math.cos((startAngle * Math.PI) / 180);\r\n                const endYInner = 96 + innerRadius * Math.sin((startAngle * Math.PI) / 180);\r\n                \r\n                const largeArcFlag = angle > 180 ? 1 : 0;\r\n                \r\n                const pathData = [\r\n                  'M', startXOuter, startYOuter,\r\n                  'A', outerRadius, outerRadius, 0, largeArcFlag, 1, endXOuter, endYOuter,\r\n                  'L', startXInner, startYInner,\r\n                  'A', innerRadius, innerRadius, 0, largeArcFlag, 0, endXInner, endYInner,\r\n                  'Z'\r\n                ].join(' ');\r\n                \r\n                const pieColors = [\r\n                  '#8b5cf6', '#ec4899', '#06b6d4', '#10b981', '#f59e0b', \r\n                  '#ef4444', '#84cc16', '#6366f1', '#f97316', '#14b8a6'\r\n                ];\r\n                const color = pieColors[index % pieColors.length];\r\n                \r\n                // คำนวณตำแหน่งสำหรับแสดง percentage\r\n                const midAngle = startAngle + (angle / 2);\r\n                const labelRadius = 90;\r\n                const labelX = 96 + labelRadius * Math.cos((midAngle * Math.PI) / 180);\r\n                const labelY = 96 + labelRadius * Math.sin((midAngle * Math.PI) / 180);\r\n                const percentageText = `${(percentage * 100).toFixed(1)}%`;\r\n                \r\n                return (\r\n                  <g key={`donut-${index}`}>\r\n                    <path\r\n                      d={pathData}\r\n                      fill={color}\r\n                      stroke=\"white\"\r\n                      strokeWidth=\"2\"\r\n                    />\r\n                    {/* แสดง percentage ที่ขอบวงกลม */}\r\n                    {percentage > 0.05 && (\r\n                      <text\r\n                        x={labelX}\r\n                        y={labelY}\r\n                        textAnchor=\"middle\"\r\n                        dominantBaseline=\"middle\"\r\n                        fill=\"#1e293b\"\r\n                        fontSize=\"10\"\r\n                        fontWeight=\"bold\"\r\n                        stroke=\"white\"\r\n                        strokeWidth=\"2\"\r\n                        paintOrder=\"stroke\"\r\n                      >\r\n                        {percentageText}\r\n                      </text>\r\n                    )}\r\n                  </g>\r\n                );\r\n              })}\r\n            </svg>\r\n          </div>\r\n          \r\n          {/* Legend */}\r\n          <div className=\"w-full mt-6\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2\">\r\n              {data.map((item, index) => {\r\n                const percentage = ((item.value / total) * 100).toFixed(0);\r\n                const pieColors = [\r\n                  '#8b5cf6', '#ec4899', '#06b6d4', '#10b981', '#f59e0b', \r\n                  '#ef4444', '#84cc16', '#6366f1', '#f97316', '#14b8a6'\r\n                ];\r\n                const color = pieColors[index % pieColors.length];\r\n                \r\n                return (\r\n                  <div key={`legend-${item.label}-${index}`} className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center space-x-2 min-w-0 flex-1\">\r\n                      <div \r\n                        className=\"w-3 h-3 rounded-full flex-shrink-0\"\r\n                        style={{ backgroundColor: color }}\r\n                      />\r\n                      <span className=\"text-sm text-slate-700\">\r\n                        {truncateAffiliation(item.label)} <span className=\"font-bold text-slate-900\">{item.value}</span> คน\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"text-sm font-bold text-slate-900 ml-2\">{percentage}%</div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// Horizontal Bar Chart Component\r\nconst HorizontalBarChart = memo(({ title, data, colors = [], maxHeight = '320px' }) => {\r\n  \r\n  const getSortOrder = (label) => {\r\n    const regionMatch = label.match(/ภาค\\s*(\\d+)/);\r\n    if (regionMatch) return parseInt(regionMatch[1]);\r\n    const customOrder = ['ศาลชั้นต้นในเขตกรุงเทพมหานคร', 'ศูนย์รักษาความปลอดภัย', 'ศาลชำนาญพิเศษ', 'ศาลสูง'];\r\n    const index = customOrder.findIndex(item => label.includes(item));\r\n    if (index !== -1) return 100 + index;\r\n    return 999;\r\n  };\r\n\r\n  const sortedData = useMemo(() => \r\n    [...data].sort((a, b) => getSortOrder(a.label) - getSortOrder(b.label)), \r\n    [data]\r\n  );\r\n  \r\n  const maxValue = useMemo(() => {\r\n    if (!sortedData || sortedData.length === 0) return 0;\r\n    return Math.max(...sortedData.map(d => d.value));\r\n  }, [sortedData]);\r\n\r\n  if (!sortedData.length || maxValue === 0) {\r\n    return (\r\n      <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\r\n        <h3 className=\"text-lg font-semibold text-slate-900 mb-4 flex items-center\"><BarChart3 className=\"w-5 h-5 mr-2 text-slate-400\" />{title}</h3>\r\n        <div className=\"text-center py-8\"><p className=\"text-slate-500\">ไม่มีข้อมูลสำหรับแสดงกราฟ</p></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-4 shadow-sm border border-slate-200\">\r\n      <h3 className=\"text-lg font-semibold text-slate-900 mb-3 flex items-center\"><BarChart3 className=\"w-5 h-5 mr-2 text-slate-400\" />{title}</h3>\r\n      <div className=\"space-y-2\" style={{ maxHeight, overflowY: 'auto', paddingRight: 8 }}>\r\n        {sortedData.map((item, index) => {\r\n          const barWidth = (item.value / maxValue) * 100;\r\n          const color = colors[index % colors.length] || '#8b5cf6';\r\n          \r\n          return (\r\n            <div key={`${item.label}-${index}`} className=\"grid grid-cols-3 gap-2 items-center\">\r\n              {/* Left Column for Full Label (CHANGED to text-left) */}\r\n              <div className=\"col-span-1 text-sm text-slate-700 font-medium text-left truncate\" title={item.label}>\r\n                {item.label}\r\n              </div>\r\n              \r\n              {/* Right Column for Bar */}\r\n              <div className=\"col-span-2 w-full bg-slate-100 rounded-full h-7 relative\">\r\n                <div\r\n                  className=\"h-7 rounded-full transition-all duration-700 flex items-center justify-end pr-3\"\r\n                  style={{\r\n                    width: `${barWidth}%`, backgroundColor: color, minWidth: '36px'\r\n                  }}\r\n                >\r\n                   <span className=\"text-white text-sm font-bold\">{item.value}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// (moved into the PersonnelPage component to avoid calling hooks at top level)\r\n\r\n// EditableCard Component (restored minimal implementation)\r\nconst EditableCard = memo(({ title, value, icon: Icon, color = \"blue\", isEditing, onEdit, onChange, isAdmin }) => {\r\n  const [localValue, setLocalValue] = useState(value);\r\n\r\n  useEffect(() => {\r\n    setLocalValue(value);\r\n  }, [value]);\r\n\r\n  const handleChange = (e) => {\r\n    const newValue = parseInt(e.target.value) || 0;\r\n    setLocalValue(newValue);\r\n    onChange(newValue);\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\r\n      <div className=\"flex items-center justify-between mb-2\">\r\n        <div className={`w-12 h-12 bg-${color}-100 rounded-xl flex items-center justify-center`}>\r\n          {Icon && <Icon className={`w-6 h-6 text-${color}-600`} />}\r\n        </div>\r\n        {isAdmin && (\r\n          <button\r\n            onClick={onEdit}\r\n            className=\"text-slate-400 hover:text-slate-600 transition-colors\"\r\n          >\r\n            {isEditing ? <Save className=\"w-5 h-5\" /> : <Edit2 className=\"w-5 h-5\" />}\r\n          </button>\r\n        )}\r\n      </div>\r\n      {isEditing ? (\r\n        <input\r\n          type=\"number\"\r\n          value={localValue}\r\n          onChange={handleChange}\r\n          className=\"w-full text-3xl font-bold text-slate-900 mb-1 bg-slate-50 border border-slate-200 rounded px-2 py-1\"\r\n          min=\"0\"\r\n        />\r\n      ) : (\r\n        <div className=\"text-3xl font-bold text-slate-900 mb-1\">{localValue}</div>\r\n      )}\r\n      <div className=\"text-sm text-slate-600\">{title}</div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// PersonnelDetailModal (minimal)\r\nconst PersonnelDetailModal = memo(({ person, isOpen, onClose }) => {\r\n  if (!isOpen || !person) return null;\r\n\r\n  // Calculate age from birth date\r\n  const calculateAge = (dob) => {\r\n    if (!dob) return 'ไม่ระบุ';\r\n    try {\r\n      const birthDate = new Date(dob);\r\n      const today = new Date();\r\n      let age = today.getFullYear() - birthDate.getFullYear();\r\n      const monthDiff = today.getMonth() - birthDate.getMonth();\r\n      \r\n      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {\r\n        age--;\r\n      }\r\n      \r\n      return `${age} ปี`;\r\n    } catch (error) {\r\n      return 'ไม่ระบุ';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 overflow-y-auto bg-black/60 hide-scrollbar\">\r\n      <div className=\"flex min-h-screen items-start justify-center p-3 sm:p-6 md:p-10\">\r\n        <div className=\"relative bg-gradient-to-br from-white via-slate-50 to-indigo-50 rounded-2xl sm:rounded-3xl shadow-2xl max-w-3xl w-full p-4 sm:p-6\">\r\n          {/* Header with game-card style */}\r\n          <div className=\"flex items-start justify-between mb-6 pb-4 border-b border-slate-200\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"w-12 h-12 sm:w-16 sm:h-16 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-lg sm:text-xl font-bold shadow-lg\">\r\n                {(person.firstname || 'N')[0]}\r\n              </div>\r\n              <div>\r\n                <h2 className=\"text-lg sm:text-xl font-bold text-slate-900\">\r\n                  {person.prefix} {person.firstname} {person.lastname}\r\n                </h2>\r\n                <p className=\"text-sm text-slate-600\">{person.position || 'ไม่ระบุตำแหน่ง'}</p>\r\n              </div>\r\n            </div>\r\n            <button \r\n              onClick={onClose} \r\n              className=\"p-2 text-slate-400 hover:text-slate-600 hover:bg-white/80 rounded-lg transition-all duration-200\"\r\n            >\r\n              <X className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Content Cards */}\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6\">\r\n            {/* Contact Information Card */}\r\n            <div className=\"bg-gradient-to-br from-white to-blue-50 rounded-xl p-4 sm:p-5 shadow-lg border border-slate-200/50\">\r\n              <h3 className=\"text-base sm:text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2\">\r\n                <Phone className=\"w-5 h-5 text-blue-600\" />\r\n                ข้อมูลติดต่อ\r\n              </h3>\r\n              <div className=\"space-y-3\">\r\n                <div className=\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\">\r\n                  <Phone className=\"w-4 h-4 text-slate-500\" />\r\n                  <span className=\"text-sm text-slate-700\">{formatPhoneNumber(person.phone) || 'ไม่ระบุ'}</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\">\r\n                  <Mail className=\"w-4 h-4 text-slate-500\" />\r\n                  <span className=\"text-sm text-slate-700\">{person.email || 'ไม่ระบุ'}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Work Information Card */}\r\n            <div className=\"bg-gradient-to-br from-white to-green-50 rounded-xl p-4 sm:p-5 shadow-lg border border-slate-200/50\">\r\n              <h3 className=\"text-base sm:text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2\">\r\n                <Building className=\"w-5 h-5 text-green-600\" />\r\n                ข้อมูลการทำงาน\r\n              </h3>\r\n              <div className=\"space-y-3\">\r\n                <div className=\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\">\r\n                  <Building2 className=\"w-4 h-4 text-slate-500\" />\r\n                  <div className=\"text-sm\">\r\n                    <div className=\"font-medium text-slate-700\">สังกัด</div>\r\n                    <div className=\"text-slate-600\">{person.affiliation || 'ไม่ระบุ'}</div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\">\r\n                  <Users className=\"w-4 h-4 text-slate-500\" />\r\n                  <div className=\"text-sm\">\r\n                    <div className=\"font-medium text-slate-700\">หน่วยงาน</div>\r\n                    <div className=\"text-slate-600\">{person.deph || 'ไม่ระบุ'}</div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-3 p-2 rounded-lg bg-white/70 hover:bg-white transition-colors\">\r\n                  <Crown className=\"w-4 h-4 text-slate-500\" />\r\n                  <div className=\"text-sm\">\r\n                    <div className=\"font-medium text-slate-700\">ตำแหน่ง</div>\r\n                    <div className=\"text-slate-600\">{person.position || 'ไม่ระบุ'}</div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Additional Information Card */}\r\n            <div className=\"lg:col-span-2 bg-gradient-to-br from-white to-purple-50 rounded-xl p-4 sm:p-5 shadow-lg border border-slate-200/50\">\r\n              <h3 className=\"text-base sm:text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2\">\r\n                <FileText className=\"w-5 h-5 text-purple-600\" />\r\n                ข้อมูลเพิ่มเติม\r\n              </h3>\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"text-sm font-medium text-slate-700\">อายุ</div>\r\n                  <div className=\"text-sm text-slate-600 p-2 bg-white/70 rounded-lg\">\r\n                    {calculateAge(person.dob)}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Action Buttons */}\r\n          <div className=\"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t border-slate-200\">\r\n            {person.phone && (\r\n              <button \r\n                onClick={() => window.open(`tel:${formatPhoneNumber(person.phone)}`, '_self')} \r\n                className=\"flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5\"\r\n              >\r\n                <Phone className=\"w-4 h-4\" />\r\n                <span className=\"text-sm font-medium\">โทรหา</span>\r\n              </button>\r\n            )}\r\n            {person.email && (\r\n              <button \r\n                onClick={() => window.open(`mailto:${person.email}`, '_self')} \r\n                className=\"flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5\"\r\n              >\r\n                <Mail className=\"w-4 h-4\" />\r\n                <span className=\"text-sm font-medium\">ส่งอีเมล</span>\r\n              </button>\r\n            )}\r\n            <button \r\n              onClick={onClose} \r\n              className=\"flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-slate-500 to-slate-600 text-white rounded-lg hover:from-slate-600 hover:to-slate-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 sm:ml-auto\"\r\n            >\r\n              <span className=\"text-sm font-medium\">ปิด</span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n// SearchModal (enhanced with department filtering and game-card style)\r\n// Small visual card for a person used in search results (game-card style)\r\nconst PersonCard = memo(({ person, onView, onCall, onMail }) => {\r\n  return (\r\n    <div className=\"bg-gradient-to-br from-white via-blue-50 to-indigo-100 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 p-4 sm:p-6 border border-indigo-200 hover:border-indigo-300 transform hover:scale-105\">\r\n      {/* Header with name and position */}\r\n      <div className=\"mb-4\">\r\n        <div className=\"text-sm sm:text-base font-bold text-slate-900 mb-1\">\r\n          {person.prefix} {person.firstname} {person.lastname}\r\n        </div>\r\n        <div className=\"text-xs sm:text-sm text-indigo-600 font-medium\">\r\n          {person.position || 'ไม่ระบุตำแหน่ง'}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Info section */}\r\n      <div className=\"space-y-2 mb-4\">\r\n        <div className=\"flex items-center gap-2 text-xs sm:text-sm text-slate-600\">\r\n          <Building2 className=\"w-4 h-4 text-indigo-500 flex-shrink-0\" />\r\n          <span className=\"truncate\">{person.affiliation || 'ไม่ระบุสังกัด'}</span>\r\n        </div>\r\n        <div className=\"flex items-center gap-2 text-xs sm:text-sm text-slate-600\">\r\n          <Briefcase className=\"w-4 h-4 text-purple-500 flex-shrink-0\" />\r\n          <span className=\"truncate\">{person.deph || 'ไม่ระบุหน่วยงาน'}</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Action buttons */}\r\n      <div className=\"space-y-2\">\r\n        <button \r\n          onClick={() => onView(person)} \r\n          className=\"w-full px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-xl text-sm font-medium flex items-center justify-center gap-2 transition-all duration-200 shadow-md hover:shadow-lg\"\r\n        >\r\n          <Eye className=\"w-4 h-4\" /> \r\n          ดูรายละเอียด\r\n        </button>\r\n        \r\n        {/* Contact buttons */}\r\n        <div className=\"flex items-center gap-2\">\r\n          {person.phone && (\r\n            <button \r\n              onClick={() => onCall(formatPhoneNumber(person.phone))} \r\n              className=\"flex-1 p-2 rounded-xl bg-green-100 hover:bg-green-200 text-green-600 transition-colors shadow-sm flex items-center justify-center gap-1\" \r\n              title=\"โทร\"\r\n            >\r\n              <Phone className=\"w-4 h-4\" />\r\n              <span className=\"text-xs\">โทร</span>\r\n            </button>\r\n          )}\r\n          {person.email && (\r\n            <button \r\n              onClick={() => onMail(person.email)} \r\n              className=\"flex-1 p-2 rounded-xl bg-blue-100 hover:bg-blue-200 text-blue-600 transition-colors shadow-sm flex items-center justify-center gap-1\" \r\n              title=\"อีเมล\"\r\n            >\r\n              <Mail className=\"w-4 h-4\" />\r\n              <span className=\"text-xs\">อีเมล</span>\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nconst SearchModal = memo(({ isOpen, onClose, personnelData = [], stats = {}, onViewPerson = () => {}, onExport = () => {}, user }) => {\r\n  const [query, setQuery] = useState('');\r\n  const [filterAff, setFilterAff] = useState('');\r\n  const [filterDept, setFilterDept] = useState('');\r\n  const [filterPos, setFilterPos] = useState('');\r\n\r\n  // Get unique affiliations\r\n  const affiliations = useMemo(() => {\r\n    const setAff = new Set();\r\n    personnelData.forEach(p => setAff.add(p.affiliation || 'ไม่ระบุ'));\r\n    return Array.from(setAff).sort();\r\n  }, [personnelData]);\r\n\r\n  // Get departments based on selected affiliation\r\n  const departments = useMemo(() => {\r\n    const relevantPersonnel = filterAff \r\n      ? personnelData.filter(p => (p.affiliation || 'ไม่ระบุ') === filterAff)\r\n      : personnelData;\r\n    \r\n    const setDept = new Set();\r\n    relevantPersonnel.forEach(p => setDept.add(p.deph || 'ไม่ระบุ'));\r\n    return Array.from(setDept).sort();\r\n  }, [personnelData, filterAff]);\r\n\r\n  // Get positions\r\n  const positions = useMemo(() => {\r\n    const s = new Set();\r\n    personnelData.forEach(p => s.add(p.position || 'ไม่ระบุ'));\r\n    return Array.from(s).sort();\r\n  }, [personnelData]);\r\n\r\n  // Reset department when affiliation changes\r\n  useEffect(() => {\r\n    if (filterAff) {\r\n      setFilterDept('');\r\n    }\r\n  }, [filterAff]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const results = personnelData.filter(p => {\r\n    const hay = `${p.firstname} ${p.lastname} ${p.position || ''} ${p.affiliation || ''} ${p.deph || ''}`.toLowerCase();\r\n    if (query && !hay.includes(query.toLowerCase())) return false;\r\n    if (filterAff && (p.affiliation || 'ไม่ระบุ') !== filterAff) return false;\r\n    if (filterDept && (p.deph || 'ไม่ระบุ') !== filterDept) return false;\r\n    if (filterPos && (p.position || 'ไม่ระบุ') !== filterPos) return false;\r\n    return true;\r\n  });\r\n\r\n  const handleCall = (tel) => window.open(`tel:${tel}`, '_self');\r\n  const handleMail = (email) => window.open(`mailto:${email}`, '_self');\r\n\r\n  const clearFilters = () => { \r\n    setFilterAff(''); \r\n    setFilterDept(''); \r\n    setFilterPos(''); \r\n    setQuery(''); \r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 overflow-y-auto bg-black/60 hide-scrollbar\">\r\n      <div className=\"flex min-h-screen items-start justify-center p-3 sm:p-6 md:p-10\">\r\n        <div className=\"relative bg-white rounded-2xl sm:rounded-3xl shadow-2xl max-w-6xl w-full p-4 sm:p-6\">\r\n          <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\r\n            <h2 className=\"text-lg sm:text-xl font-bold text-slate-900\">🔍 ค้นหาบุคลากร</h2>\r\n            <button \r\n              onClick={onClose} \r\n              className=\"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors\"\r\n            >\r\n              <X className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Enhanced Search Filters */}\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6\">\r\n            <input \r\n              value={query} \r\n              onChange={(e) => setQuery(e.target.value)} \r\n              className=\"w-full p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm\" \r\n              placeholder=\"🔍 ค้นหาชื่อ, ตำแหน่ง...\" \r\n            />\r\n            \r\n            <select \r\n              value={filterAff} \r\n              onChange={(e) => setFilterAff(e.target.value)} \r\n              className=\"p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm\"\r\n            >\r\n              <option value=\"\">🏢 ทั้งหมด (สังกัด)</option>\r\n              {affiliations.map(a => <option key={a} value={a}>{a}</option>)}\r\n            </select>\r\n            \r\n            <select \r\n              value={filterDept} \r\n              onChange={(e) => setFilterDept(e.target.value)} \r\n              className=\"p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm\"\r\n              disabled={!filterAff}\r\n            >\r\n              <option value=\"\">🏛️ ทั้งหมด (หน่วยงาน)</option>\r\n              {departments.map(d => <option key={d} value={d}>{d}</option>)}\r\n            </select>\r\n            \r\n            <select \r\n              value={filterPos} \r\n              onChange={(e) => setFilterPos(e.target.value)} \r\n              className=\"p-2 sm:p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm\"\r\n            >\r\n              <option value=\"\">👤 ทั้งหมด (ตำแหน่ง)</option>\r\n              {positions.map(p => <option key={p} value={p}>{p}</option>)}\r\n            </select>\r\n          </div>\r\n\r\n          {/* Results header and actions */}\r\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-3\">\r\n            <div className=\"text-sm text-slate-600 flex items-center gap-2\">\r\n              <Users className=\"w-4 h-4 text-indigo-500\" />\r\n              พบ <span className=\"font-bold text-indigo-600\">{results.length}</span> รายการ\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <button \r\n                onClick={clearFilters} \r\n                className=\"text-sm text-slate-600 px-3 py-1 rounded-lg bg-slate-100 hover:bg-slate-200 transition-colors\"\r\n              >\r\n                🗑️ ล้างตัวกรอง\r\n              </button>\r\n              <button \r\n                onClick={() => onExport(results)} \r\n                className=\"text-sm px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-1\"\r\n              >\r\n                <Download className=\"w-4 h-4\" />\r\n                ส่งออก\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Results grid */}\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 max-h-[60vh] overflow-y-auto hide-scrollbar\">\r\n            {results.map((p, i) => (\r\n              <PersonCard \r\n                key={`${p.phone || i}-${i}`} \r\n                person={p} \r\n                onView={onViewPerson} \r\n                onCall={handleCall} \r\n                onMail={handleMail} \r\n              />\r\n            ))}\r\n            {results.length === 0 && (\r\n              <div className=\"col-span-full text-center text-slate-500 py-12\">\r\n                <Users className=\"w-16 h-16 text-slate-300 mx-auto mb-4\" />\r\n                <h3 className=\"text-lg font-semibold text-slate-600 mb-2\">ไม่พบผลลัพธ์</h3>\r\n                <p className=\"text-sm\">ลองเปลี่ยนคำค้นหาหรือตัวกรองข้อมูล</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default function PersonnelPage({ user }) {\r\n  const [loading, setLoading] = useState(true);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [personnelData, setPersonnelData] = useState([]);\r\n  const [selectedPerson, setSelectedPerson] = useState(null);\r\n  const [showDetail, setShowDetail] = useState(false);\r\n  const [showSearchModal, setShowSearchModal] = useState(false);\r\n\r\n  const [quota, setQuota] = useState(100);\r\n  const [vacancy, setVacancy] = useState(20);\r\n  const [isEditingQuota, setIsEditingQuota] = useState(false);\r\n  const [isEditingVacancy, setIsEditingVacancy] = useState(false);\r\n\r\n  const [selectedChart, setSelectedChart] = useState(\"position\"); // Default chart type\r\n  const [selectedAffiliation, setSelectedAffiliation] = useState(\"\"); // For department filtering\r\n  const [filters, setFilters] = useState({\r\n    affiliation: \"\",\r\n    department: \"\",\r\n    ageRange: \"\",\r\n    gender: \"\",\r\n  });\r\n\r\n  const logAdminActivity = useCallback((action, details) => {\r\n    if (!user) return;\r\n    fetch(CONFIG.ADMIN_API, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        action: 'log_activity',\r\n        log_action: action,\r\n        log_details: details || null,\r\n        user_id: user.id,\r\n        username: user.username,\r\n      }),\r\n    }).catch((error) => console.error('Failed to log activity:', error));\r\n  }, [user]);\r\n\r\n  const fetchPersonnelData = useCallback(async () => {\r\n    try {\r\n      const apiUrl = CONFIG.OFFICERS_API;\r\n      const response = await fetch(apiUrl);\r\n      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\r\n      const text = await response.text();\r\n      if (!text) throw new Error('Empty response from server');\r\n      const result = JSON.parse(text);\r\n      const data = result.success && Array.isArray(result.data) ? result.data : [];\r\n      const formattedData = data.map((person) => ({\r\n        phone: person.phone || '',\r\n        prefix: person.prefix || '',\r\n        firstname: person.firstname || '',\r\n        lastname: person.lastname || '',\r\n        position: person.position || '',\r\n        affiliation: person.affiliation || '',\r\n        deph: person.department || '',\r\n        generation: person.generation || '',\r\n        email: person.email || '',\r\n        dob: person.dob || '',\r\n        lineUserId: person.lineUserId || '',\r\n        role: person.role || 'member',\r\n      }));\r\n      setPersonnelData(formattedData);\r\n      setError(\"\");\r\n    } catch (error) {\r\n      setError(`⚠️ ${error.message}`);\r\n      setPersonnelData([]);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchPersonnelData();\r\n  }, [fetchPersonnelData]);\r\n\r\n  const handleRefresh = () => {\r\n    setRefreshing(true);\r\n    fetchPersonnelData().finally(() => setRefreshing(false));\r\n  };\r\n\r\n  const handleViewPerson = (person) => {\r\n  // If user opened from search, close search modal first so detail appears on top\r\n  setShowSearchModal(false);\r\n  setSelectedPerson(person);\r\n  setShowDetail(true);\r\n  };\r\n\r\n  const exportToCSV = (data) => {\r\n    // Implement CSV export logic here\r\n  };\r\n\r\n  const affiliationAbbreviations = {\r\n    \"ศูนย์รักษาความปลอดภัย\": \"ส่วนกลาง\",\r\n    \"ศาลชั้นต้นในกรุงเทพมหานคร\": \"กทม.\",\r\n  };\r\n\r\n  const filteredAffiliationData = useMemo(() => {\r\n    return personnelData.reduce((acc, person) => {\r\n      let affiliation = (person.affiliation || '').trim();\r\n      if (!affiliation) affiliation = 'ไม่ระบุ';\r\n\r\n      const lower = affiliation.toLowerCase();\r\n\r\n      // Normalize known patterns using targeted rules\r\n      let normalized = affiliation;\r\n\r\n      // If it's the regional office pattern that contains สำนักศาลยุติธรรมประจำภาค\r\n      // we want to convert it to: 'ภาค <n>' when a number exists, otherwise 'ภาค'\r\n      if (\r\n        lower.includes('สำนักศาลยุติธรรมประจำภาค') ||\r\n        lower.includes('สำนักยุติธรรมประจำภาค') ||\r\n        lower.includes('ในสังกัดสำนักศาลยุติธรรมประจำภาค') ||\r\n        lower.includes('ศาลในสังกัดสำนักศาลยุติธรรมประจำภาค')\r\n      ) {\r\n        // Try to extract explicit 'ภาค <number>' first\r\n        const matchRegion = affiliation.match(/ภาค\\s*(\\d{1,3})/i);\r\n        if (matchRegion && matchRegion[1]) {\r\n          normalized = `ภาค ${matchRegion[1]}`;\r\n        } else {\r\n          // Fallback: find any trailing number in the string (e.g., '... ประจำภาค 4')\r\n          const trailingNum = affiliation.match(/(\\d{1,3})\\s*$/);\r\n          if (trailingNum && trailingNum[1]) {\r\n            normalized = `ภาค ${trailingNum[1]}`;\r\n          } else {\r\n            // Last-resort: any first number in the string\r\n            const anyNum = affiliation.match(/(\\d{1,3})/);\r\n            normalized = anyNum && anyNum[1] ? `ภาค ${anyNum[1]}` : 'ภาค';\r\n          }\r\n        }\r\n      } else if (lower.includes('ศูนย์รักษาความปลอดภัย')) {\r\n        normalized = 'ส่วนกลาง';\r\n      } else if (lower.includes('กรุงเทพ') || lower.includes('กรุงเทพมหานคร') || lower.includes('ศาลชั้นต้นในกรุงเทพมหานคร')) {\r\n        normalized = 'กทม.';\r\n      } else {\r\n        // fallback to any exact mapping we defined, otherwise keep original\r\n        normalized = affiliationAbbreviations[affiliation] || affiliation;\r\n      }\r\n\r\n      acc[normalized] = (acc[normalized] || 0) + 1;\r\n      return acc;\r\n    }, {});\r\n  }, [personnelData]);\r\n\r\n  const chartData = useMemo(() => {\r\n    const entries = Object.entries(filteredAffiliationData).map(([label, value]) => ({ label, value }));\r\n\r\n    const getOrderKey = (label) => {\r\n      if (!label) return 9999;\r\n      const l = String(label).trim();\r\n\r\n      // Match 'ภาค' followed by number e.g. 'ภาค 1' or 'ภาค1'\r\n      const m = l.match(/ภาค\\s*(\\d{1,3})/);\r\n      if (m && m[1]) {\r\n        // Put ภาค N in order 0.. (keep N small)\r\n        const num = parseInt(m[1], 10);\r\n        return num; // 1..9 -> 1..9 (smaller is earlier)\r\n      }\r\n\r\n      // If label is exactly 'ภาค' (no number), put after numbered ภาค\r\n      if (/^ภาค$/i.test(l)) return 999;\r\n\r\n      // Specific named orders after ภาค group\r\n      if (l === 'กทม.' || l.toLowerCase() === 'กทม.') return 1000;\r\n      if (l === 'ส่วนกลาง' || l.toLowerCase() === 'ส่วนกลาง') return 1001;\r\n      if (l.includes('ศาลสูง')) return 1002;\r\n      // handle both spellings 'ชำนาญ' and 'ชำนัญ'\r\n      if (l.includes('ชำนาญ') || l.includes('ชำนัญ') || l.includes('ชำนัญพิเศษ') || l.includes('ชำนาญพิเศษ')) return 1003;\r\n\r\n      // Default: place after known groups but preserve alphabetical order by returning a high key plus name\r\n      return 5000 + l.charCodeAt(0);\r\n    };\r\n\r\n    entries.sort((a, b) => {\r\n      const ka = getOrderKey(a.label);\r\n      const kb = getOrderKey(b.label);\r\n      if (ka === kb) {\r\n        // fallback alphabetical\r\n        return String(a.label).localeCompare(String(b.label));\r\n      }\r\n      return ka - kb;\r\n    });\r\n\r\n    return entries;\r\n  }, [filteredAffiliationData]);\r\n\r\n  const stats = useMemo(() => {\r\n    const newStats = {\r\n      total: personnelData.length,\r\n      connected: personnelData.filter((p) => p.lineUserId).length,\r\n      byPosition: {},\r\n      byAffiliation: {},\r\n      byDepartment: {},\r\n      byGeneration: {},\r\n    };\r\n    personnelData.forEach((person) => {\r\n      const position = person.position || 'ไม่ระบุ';\r\n      newStats.byPosition[position] = (newStats.byPosition[position] || 0) + 1;\r\n      const affiliation = person.affiliation || 'ไม่ระบุ';\r\n      newStats.byAffiliation[affiliation] = (newStats.byAffiliation[affiliation] || 0) + 1;\r\n      const department = person.deph || 'ไม่ระบุตำแหน่ง';\r\n      newStats.byDepartment[department] = (newStats.byDepartment[department] || 0) + 1;\r\n      const generation = person.generation ? String(person.generation).trim() : 'ไม่ระบุตำแหน่ง';\r\n      newStats.byGeneration[generation] = (newStats.byGeneration[generation] || 0) + 1;\r\n    });\r\n    return newStats;\r\n  }, [personnelData]);\r\n\r\n  useEffect(() => {\r\n    console.log(\"Personnel Data:\", personnelData);\r\n  }, [personnelData]);\r\n\r\n  useEffect(() => {\r\n    console.log(\"Stats:\", stats);\r\n    console.log(\"Chart Data:\", chartData);\r\n  }, [stats, chartData]);\r\n\r\n  const chartColors = [\r\n    \"#FF6384\", \"#36A2EB\", \"#FFCE56\", \"#4BC0C0\", \"#9966FF\", \"#FF9F40\", \"#FFCD56\", \"#C9CBCF\"\r\n  ];\r\n\r\n  // Helper: build chart data for different types (inside component)\r\n  const getChartData = useCallback((type) => {\r\n    if (type === 'affiliation') return chartData; // already normalized affiliation entries\r\n\r\n    if (type === 'position') {\r\n      // build from stats.byPosition\r\n      const entries = Object.entries(stats.byPosition || {}).map(([label, value]) => ({ label, value }));\r\n      // sort by value desc\r\n      entries.sort((a, b) => b.value - a.value);\r\n      return entries;\r\n    }\r\n\r\n    if (type === 'department') {\r\n      // build from deph field - filter by selected affiliation if any\r\n      const groups = {};\r\n      const filteredData = selectedAffiliation \r\n        ? personnelData.filter(p => (p.affiliation || 'ไม่ระบุ') === selectedAffiliation)\r\n        : personnelData;\r\n        \r\n      filteredData.forEach(p => {\r\n        const dept = p.deph || 'ไม่ระบุ';\r\n        groups[dept] = (groups[dept] || 0) + 1;\r\n      });\r\n      return Object.entries(groups).map(([label, value]) => ({ label, value })).sort((a, b) => b.value - a.value);\r\n    }\r\n\r\n    if (type === 'age') {\r\n      // derive age groups from dob (basic)\r\n      const groups = { '<30': 0, '30-39': 0, '40-49': 0, '50-59': 0, '60+': 0 };\r\n      const now = new Date();\r\n      personnelData.forEach(p => {\r\n        if (!p.dob) return;\r\n        const m = String(p.dob).match(/(\\d{4})/);\r\n        if (!m) return;\r\n        const year = parseInt(m[1], 10);\r\n        if (isNaN(year)) return;\r\n        const age = now.getFullYear() - year;\r\n        if (age < 30) groups['<30']++;\r\n        else if (age < 40) groups['30-39']++;\r\n        else if (age < 50) groups['40-49']++;\r\n        else if (age < 60) groups['50-59']++;\r\n        else groups['60+']++;\r\n      });\r\n      return Object.entries(groups).map(([label, value]) => ({ label, value }));\r\n    }\r\n\r\n    if (type === 'gender') {\r\n      // no gender field in data - return empty to show no data\r\n      const genders = (personnelData || []).reduce((acc, p) => {\r\n        const g = (p.gender || '').trim();\r\n        if (!g) return acc;\r\n        acc[g] = (acc[g] || 0) + 1;\r\n        return acc;\r\n      }, {});\r\n      return Object.entries(genders).map(([label, value]) => ({ label, value }));\r\n    }\r\n\r\n    return [];\r\n  }, [chartData, stats, personnelData, selectedAffiliation]); // Add selectedAffiliation dependency\r\n\r\n  // Helper function to get chart title\r\n  const getChartTitle = (chartType) => {\r\n    switch (chartType) {\r\n      case \"position\":\r\n        return \"ตำแหน่ง\";\r\n      case \"affiliation\":\r\n        return \"สัดส่วนแต่ละสังกัด\";\r\n      case \"department\":\r\n        return selectedAffiliation \r\n          ? `หน่วยงานใน${selectedAffiliation}`\r\n          : \"หน่วยงาน (เลือกสังกัดก่อน)\";\r\n      case \"gender\":\r\n        return \"เพศ\";\r\n      case \"age\":\r\n        return \"ช่วงอายุ\";\r\n      default:\r\n        return \"ข้อมูลบุคลากร\";\r\n    }\r\n  };\r\n\r\n  const renderChart = () => {\r\n    switch (selectedChart) {\r\n      case \"position\":\r\n        return (\r\n          <HorizontalBarChart\r\n            data={getChartData('position')}\r\n            colors={chartColors}\r\n            title=\"ตำแหน่ง\"\r\n            maxHeight=\"320px\"\r\n          />\r\n        );\r\n      case \"affiliation\":\r\n        return (\r\n          <HorizontalBarChart\r\n            data={getChartData('affiliation')}\r\n            colors={chartColors}\r\n            title=\"สัดส่วนแต่ละสังกัด\"\r\n            maxHeight=\"320px\"\r\n          />\r\n        );\r\n      case \"department\":\r\n        return (\r\n          <div className=\"space-y-4\">\r\n            {!selectedAffiliation ? (\r\n              <div className=\"text-center py-8\">\r\n                <Building2 className=\"w-16 h-16 text-slate-300 mx-auto mb-4\" />\r\n                <h3 className=\"text-lg font-semibold text-slate-600 mb-2\">เลือกสังกัดก่อน</h3>\r\n                <p className=\"text-sm text-slate-500 mb-4\">กรุณาเลือกสังกัดเพื่อดูหน่วยงานในสังกัดนั้น</p>\r\n                <select \r\n                  value={selectedAffiliation}\r\n                  onChange={(e) => setSelectedAffiliation(e.target.value)}\r\n                  className=\"p-2 border border-slate-300 rounded-lg\"\r\n                >\r\n                  <option value=\"\">เลือกสังกัด</option>\r\n                  {Array.from(new Set(personnelData.map(p => p.affiliation || 'ไม่ระบุ'))).sort().map(aff => (\r\n                    <option key={aff} value={aff}>{aff}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n            ) : (\r\n              <HorizontalBarChart\r\n                data={getChartData('department')}\r\n                colors={chartColors}\r\n                title={`หน่วยงานใน${selectedAffiliation}`}\r\n                maxHeight=\"320px\"\r\n              />\r\n            )}\r\n          </div>\r\n        );\r\n      case \"gender\":\r\n        return (\r\n          <PieChartComponent\r\n            data={getChartData('gender')}\r\n            colors={chartColors}\r\n            title=\"เพศ\"\r\n          />\r\n        );\r\n      case \"age\":\r\n        return (\r\n          <HorizontalBarChart\r\n            data={getChartData('age')}\r\n            colors={chartColors}\r\n            title=\"ช่วงอายุ\"\r\n            maxHeight=\"240px\"\r\n          />\r\n        );\r\n      default:\r\n        return <p>ไม่มีข้อมูลสำหรับแสดงผล</p>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full min-h-full p-6\">\r\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3\">\r\n        <h1 className=\"text-xl sm:text-2xl font-bold text-slate-800\">ข้อมูลบุคลากร</h1>\r\n        <div className=\"flex items-center space-x-3\">\r\n          <button\r\n            onClick={() => setShowSearchModal(true)}\r\n            className=\"flex items-center space-x-2 px-3 sm:px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow text-sm transition-colors\"\r\n          >\r\n            <Search className=\"w-4 h-4\" />\r\n            <span>ค้นหาบุคลากร</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8\">\r\n        <EditableCard\r\n          title=\"กรอบอัตรา\"\r\n          value={quota}\r\n          icon={Briefcase}\r\n          color=\"blue\"\r\n          isEditing={isEditingQuota}\r\n          onEdit={() => setIsEditingQuota(!isEditingQuota)}\r\n          onChange={(value) => setQuota(value)}\r\n          isAdmin={user?.role === 'admin'}\r\n        />\r\n        <EditableCard\r\n          title=\"ตำแหน่งว่าง\"\r\n          value={vacancy}\r\n          icon={UserX}\r\n          color=\"red\"\r\n          isEditing={isEditingVacancy}\r\n          onEdit={() => setIsEditingVacancy(!isEditingVacancy)}\r\n          onChange={(value) => setVacancy(value)}\r\n          isAdmin={user?.role === 'admin'}\r\n        />\r\n        <StatCard\r\n          title=\"บุคลากรทั้งหมด\"\r\n          value={stats.total}\r\n          icon={Users}\r\n          color=\"green\"\r\n          subtitle=\"ทั้งหมดในระบบ\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"flex flex-wrap items-center gap-2 sm:gap-4 mb-4 sm:mb-6\">\r\n        <button\r\n          onClick={() => setSelectedChart(\"position\")}\r\n          className={`px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors ${selectedChart === \"position\" ? \"bg-indigo-600 text-white\" : \"bg-gray-200 text-gray-800 hover:bg-gray-300\"}`}\r\n        >\r\n          ตำแหน่ง\r\n        </button>\r\n        <button\r\n          onClick={() => setSelectedChart(\"affiliation\")}\r\n          className={`px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors ${selectedChart === \"affiliation\" ? \"bg-indigo-600 text-white\" : \"bg-gray-200 text-gray-800 hover:bg-gray-300\"}`}\r\n        >\r\n          สังกัด\r\n        </button>\r\n        <button\r\n          onClick={() => {\r\n            setSelectedChart(\"department\");\r\n            if (!selectedAffiliation) {\r\n              // Auto-select first affiliation if none selected\r\n              const affiliations = Array.from(new Set(personnelData.map(p => p.affiliation || 'ไม่ระบุ'))).sort();\r\n              if (affiliations.length > 0) {\r\n                setSelectedAffiliation(affiliations[0]);\r\n              }\r\n            }\r\n          }}\r\n          className={`px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors ${selectedChart === \"department\" ? \"bg-indigo-600 text-white\" : \"bg-gray-200 text-gray-800 hover:bg-gray-300\"}`}\r\n        >\r\n          หน่วยงาน\r\n        </button>\r\n        <button\r\n          onClick={() => setSelectedChart(\"gender\")}\r\n          className={`px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors ${selectedChart === \"gender\" ? \"bg-indigo-600 text-white\" : \"bg-gray-200 text-gray-800 hover:bg-gray-300\"}`}\r\n        >\r\n          เพศ\r\n        </button>\r\n        <button\r\n          onClick={() => setSelectedChart(\"age\")}\r\n          className={`px-3 sm:px-4 py-2 rounded-lg text-sm transition-colors ${selectedChart === \"age\" ? \"bg-indigo-600 text-white\" : \"bg-gray-200 text-gray-800 hover:bg-gray-300\"}`}\r\n        >\r\n          ช่วงอายุ\r\n        </button>\r\n        \r\n        {selectedChart === \"department\" && (\r\n          <select \r\n            value={selectedAffiliation}\r\n            onChange={(e) => setSelectedAffiliation(e.target.value)}\r\n            className=\"ml-2 p-2 border border-slate-300 rounded-lg text-sm bg-white\"\r\n          >\r\n            <option value=\"\">เลือกสังกัด</option>\r\n            {Array.from(new Set(personnelData.map(p => p.affiliation || 'ไม่ระบุ'))).sort().map(aff => (\r\n              <option key={aff} value={aff}>{aff}</option>\r\n            ))}\r\n          </select>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6\">\r\n        <div className=\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 min-h-[600px]\">\r\n          <h2 className=\"text-base sm:text-lg font-semibold text-slate-800 mb-4\">กราฟแท่ง</h2>\r\n          <div className=\"h-[520px] overflow-y-auto\">\r\n            {renderChart()}\r\n          </div>\r\n        </div>\r\n        <div className=\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 min-h-[600px]\">\r\n          <h2 className=\"text-base sm:text-lg font-semibold text-slate-800 mb-4\">กราฟวงกลม</h2>\r\n          <div className=\"h-[520px] overflow-y-auto\">\r\n            <PieChartComponent data={getChartData(selectedChart)} colors={chartColors} title={getChartTitle(selectedChart)} />\r\n          </div>\r\n        </div>\r\n        <div className=\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 min-h-[600px]\">\r\n          <h2 className=\"text-base sm:text-lg font-semibold text-slate-800 mb-4\">กราฟโดนัท</h2>\r\n          <div className=\"h-[520px] overflow-y-auto\">\r\n            <DonutChart data={getChartData(selectedChart)} colors={chartColors} title={getChartTitle(selectedChart)} />\r\n          </div>\r\n        </div>\r\n        <div className=\"bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6 min-h-[600px]\">\r\n          <h2 className=\"text-base sm:text-lg font-semibold text-slate-800 mb-4\">กราฟเส้น</h2>\r\n          <div className=\"h-[520px] overflow-y-auto\">\r\n            <LineChart data={getChartData(selectedChart)} colors={chartColors} title={getChartTitle(selectedChart)} />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <PersonnelDetailModal\r\n        person={selectedPerson}\r\n        isOpen={showDetail}\r\n        onClose={() => setShowDetail(false)}\r\n      />\r\n      <SearchModal\r\n        isOpen={showSearchModal}\r\n        onClose={() => setShowSearchModal(false)}\r\n        personnelData={personnelData}\r\n        stats={stats}\r\n        onViewPerson={handleViewPerson}\r\n        onExport={exportToCSV}\r\n        user={user}\r\n      />\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}